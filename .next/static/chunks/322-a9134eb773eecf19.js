"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[322],{7322:function(e,a,t){t.d(a,{Z:function(){return S}});var l=t(7437),s=t(2265);t(7835);var r=t(8239),o=t(8614),n=t(1994),i=t(3335);function c(){for(var e=arguments.length,a=Array(e),t=0;t<e;t++)a[t]=arguments[t];return(0,i.m6)((0,n.W)(a))}let d={default:"bg-aloa-black text-aloa-cream hover:bg-opacity-90 shadow-lg hover:shadow-xl transition-all duration-300 uppercase tracking-wider font-medium",destructive:"bg-red-600 text-white hover:bg-red-700 transition-all duration-300",outline:"border-2 border-aloa-black bg-transparent text-aloa-black hover:bg-aloa-black hover:text-aloa-cream transition-all duration-300 uppercase tracking-wider font-medium",secondary:"bg-aloa-sand text-aloa-black hover:bg-aloa-gray hover:text-aloa-cream transition-all duration-300",ghost:"hover:bg-aloa-sand transition-all duration-300",link:"text-aloa-black underline-offset-4 hover:underline"},m={default:"h-12 px-6 py-3",sm:"h-10 px-4 py-2 text-sm",lg:"h-14 px-8 py-4 text-lg",icon:"h-12 w-12"},u=s.forwardRef((e,a)=>{let{className:t,variant:s="default",size:r="default",...o}=e;return(0,l.jsx)("button",{className:c("inline-flex items-center justify-center font-medium transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-aloa-black focus-visible:ring-offset-2 focus-visible:ring-offset-aloa-cream disabled:opacity-50 disabled:pointer-events-none transform hover:-translate-y-0.5",d[s],m[r],t),ref:a,...o})});u.displayName="Button";let f=s.forwardRef((e,a)=>{let{className:t,type:s,...r}=e;return(0,l.jsx)("input",{type:s,className:c("flex h-12 w-full bg-aloa-white border-2 border-aloa-black px-4 py-3 text-base transition-all duration-200","placeholder:text-aloa-gray","focus:outline-none focus:ring-2 focus:ring-aloa-black focus:ring-offset-2 focus:ring-offset-aloa-cream","hover:shadow-md","disabled:cursor-not-allowed disabled:opacity-50",t),ref:a,...r})});f.displayName="Input";let x=s.forwardRef((e,a)=>{let{className:t,...s}=e;return(0,l.jsx)("textarea",{className:c("flex min-h-[120px] w-full bg-aloa-white border-2 border-aloa-black px-4 py-3 text-base transition-all duration-200","placeholder:text-aloa-gray","focus:outline-none focus:ring-2 focus:ring-aloa-black focus:ring-offset-2 focus:ring-offset-aloa-cream","hover:shadow-md","disabled:cursor-not-allowed disabled:opacity-50","resize-y",t),ref:a,...s})});x.displayName="Textarea";var h=t(6394);let p=s.forwardRef((e,a)=>{let{className:t,...s}=e;return(0,l.jsx)(h.f,{ref:a,className:c("text-sm font-medium text-aloa-black uppercase tracking-wider leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",t),...s})});p.displayName=h.f.displayName;var b=t(6595),g=t(407),y=t(1671),j=t(2451),v=t(4743),N=t(9270),k=t(2095),w=t(3672);function S(e){let{form:a,isModal:t=!1,onComplete:n,initialData:i,initialSection:c,onProgressChange:d,isViewOnly:m=!1}=e,h="formProgress_".concat(a._id||a.urlId),[S,C]=(0,s.useState)(()=>{if(t&&void 0!==c)return c;if(!t){let e=localStorage.getItem("".concat(h,"_section"));return e?parseInt(e):0}return 0}),[E,I]=(0,s.useState)(()=>{if(t&&i)return i;if(!t){let e=localStorage.getItem("".concat(h,"_data"));return e?JSON.parse(e):{}}return{}}),[_,A]=(0,s.useState)(!1),[Z,O]=(0,s.useState)(!1),[F,z]=(0,s.useState)({}),[T,M]=(0,s.useState)(!1);if((0,s.useEffect)(()=>{{let e=localStorage.getItem("".concat(h,"_data"));e&&Object.keys(JSON.parse(e)).length>0&&(M(!0),setTimeout(()=>M(!1),5e3))}},[h]),(0,s.useEffect)(()=>{t||_||localStorage.setItem("".concat(h,"_data"),JSON.stringify(E))},[E,h,_,t]),(0,s.useEffect)(()=>{t||_||localStorage.setItem("".concat(h,"_section"),S.toString())},[S,h,_,t]),(0,s.useEffect)(()=>{t&&d&&!_&&d(E,S)},[E,S,t,d,_]),(0,s.useEffect)(()=>{_&&(localStorage.removeItem("".concat(h,"_data")),localStorage.removeItem("".concat(h,"_section")))},[_,h]),!a||!a.fields||!Array.isArray(a.fields))return console.error("Form fields are missing or invalid:",a),(0,l.jsx)("div",{children:"Error: Form fields not properly loaded"});let R=a.fields.reduce((e,a)=>{let t=a.section||"General Information";return e[t]||(e[t]=[]),e[t].push(a),e},{}),V=Object.keys(R).filter(e=>R[e].length>0),q=R[V[S]]||[],D=()=>{let e={},a=!0;return q.forEach(t=>{t.required&&!E[t.name]&&(e[t.name]="This field is required",a=!1)}),z(e),a},J=e=>{if(null==e||e.preventDefault(),console.log("handleNext called - currentSection:",S,"sectionNames:",V),!D()){console.log("Validation failed");return}S<V.length-1?(console.log("Moving to next section:",S+1),C(S+1),z({})):console.log("Already at last section")},Y=async e=>{if(e.preventDefault(),D()){if(O(!0),console.log("Submitting form data:",E),console.log("Form ID:",a._id),t&&n){try{await n(E),A(!0)}catch(e){console.error("Submit error:",e)}finally{O(!1)}return}try{var l;let e=null===(l=document.cookie.split("; ").find(e=>e.startsWith("csrf-token=")))||void 0===l?void 0:l.split("=")[1],t=await fetch("/api/aloa-responses",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":e||""},credentials:"same-origin",body:JSON.stringify({formId:a._id,data:E})});if(t.ok){let e=await t.json();console.log("Response saved successfully:",e),A(!0)}else{let e=await t.text();console.error("Failed to save response:",e)}}catch(e){console.error("Submit error:",e)}finally{O(!1)}}},B=e=>{var a,t,s,r,o;if(m){let t=E[e.name];if(!t||Array.isArray(t)&&0===t.length)return(0,l.jsx)("div",{className:"text-gray-500 italic",children:"No response provided"});let s=t;if(Array.isArray(t))s=t.join(", ");else if("rating"===e.type){let s=(null===(a=e.validation)||void 0===a?void 0:a.max)||5;return(0,l.jsxs)("div",{className:"flex gap-1",children:[[...Array(s)].map((e,a)=>(0,l.jsx)(b.Z,{className:"h-5 w-5 ".concat(a<parseInt(t)?"fill-yellow-500 text-yellow-500":"text-gray-300")},a)),(0,l.jsxs)("span",{className:"ml-2 text-sm text-gray-600",children:["(",t,"/",s,")"]})]})}return(0,l.jsx)("div",{className:"p-3 bg-gray-50 rounded-lg border border-gray-200",children:(0,l.jsx)("p",{className:"text-gray-800",children:s})})}let n={id:e.name,name:e.name,placeholder:e.placeholder,required:e.required,onChange:a=>I({...E,[e.name]:a.target.value}),value:E[e.name]||"",className:F[e.name]?"border-red-500":""};switch(e.type){case"text":case"email":case"tel":case"url":case"number":case"date":return(0,l.jsx)(f,{type:e.type,...n});case"textarea":return(0,l.jsx)(x,{...n});case"select":return(0,l.jsxs)(w.fC,{value:E[e.name]||"",onValueChange:a=>I({...E,[e.name]:a}),children:[(0,l.jsxs)(w.xz,{className:"flex h-12 w-full items-center justify-between bg-aloa-white border-2 border-aloa-black px-4 py-3 text-base hover:shadow-md focus:outline-none focus:ring-2 focus:ring-aloa-black focus:ring-offset-2 focus:ring-offset-aloa-cream transition-all duration-200",children:[(0,l.jsx)(w.B4,{placeholder:e.placeholder||"Select an option"}),(0,l.jsx)(w.JO,{className:"ml-2",children:(0,l.jsx)(g.Z,{className:"h-4 w-4 rotate-90"})})]}),(0,l.jsx)(w.h_,{children:(0,l.jsx)(w.VY,{className:"overflow-hidden bg-aloa-white border-2 border-aloa-black shadow-xl",style:{zIndex:1e4},position:"popper",sideOffset:5,children:(0,l.jsx)(w.l_,{className:"p-1",children:null===(t=e.options)||void 0===t?void 0:t.map(e=>(0,l.jsx)(w.ck,{value:e,className:"relative flex cursor-pointer select-none items-center px-8 py-2 text-base hover:bg-aloa-sand focus:bg-aloa-sand focus:outline-none transition-colors duration-200",children:(0,l.jsx)(w.eT,{children:e})},e))})})})]});case"radio":return(0,l.jsx)(k.fC,{value:E[e.name]||"",onValueChange:a=>I({...E,[e.name]:a}),className:"space-y-2",children:null===(s=e.options)||void 0===s?void 0:s.map(a=>(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)(k.ck,{value:a,id:"".concat(e.name,"-").concat(a),className:"h-5 w-5 rounded-full border-2 border-aloa-black hover:shadow-md focus:outline-none focus:ring-2 focus:ring-aloa-black focus:ring-offset-2 focus:ring-offset-aloa-cream transition-all duration-200",children:(0,l.jsx)(k.z$,{className:"relative flex h-full w-full items-center justify-center after:block after:h-2.5 after:w-2.5 after:rounded-full after:bg-aloa-black"})}),(0,l.jsx)("label",{htmlFor:"".concat(e.name,"-").concat(a),className:"text-sm font-medium text-aloa-black cursor-pointer",children:a})]},a))});case"checkbox":case"multiselect":if(!e.options||0===e.options.length)return(0,l.jsxs)("div",{className:"text-gray-500 italic",children:["No options available for ",e.label||e.name]});return(0,l.jsx)("div",{className:"space-y-2",children:e.options.map(a=>{let t=Array.isArray(E[e.name])?E[e.name]:[],s=t.includes(a);return(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)(N.fC,{id:"".concat(e.name,"-").concat(a),checked:s,onCheckedChange:l=>{let s=l?[...t,a]:t.filter(e=>e!==a);I({...E,[e.name]:s})},className:"h-5 w-5 border-2 border-aloa-black bg-aloa-white data-[state=checked]:bg-aloa-black hover:shadow-md focus:outline-none focus:ring-2 focus:ring-aloa-black focus:ring-offset-2 focus:ring-offset-aloa-cream transition-all duration-200",children:(0,l.jsx)(N.z$,{className:"flex items-center justify-center text-aloa-cream",children:(0,l.jsx)(y.Z,{className:"h-4 w-4"})})}),(0,l.jsx)("label",{htmlFor:"".concat(e.name,"-").concat(a),className:"text-sm font-medium text-aloa-black cursor-pointer select-none",onClick:t=>{t.preventDefault();let l=document.getElementById("".concat(e.name,"-").concat(a));if(l){let e=new MouseEvent("click",{bubbles:!0});l.dispatchEvent(e)}},children:a})]},a)})});case"rating":let i=(null===(r=e.validation)||void 0===r?void 0:r.max)||5,c=parseInt(E[e.name])||0;return(0,l.jsx)("div",{className:"flex gap-2",children:[...Array(i)].map((a,t)=>(0,l.jsx)("button",{type:"button",onClick:()=>I({...E,[e.name]:String(t+1)}),className:"p-1 transition-all duration-200 hover:scale-110 focus:outline-none focus:ring-2 focus:ring-aloa-black focus:ring-offset-2 focus:ring-offset-aloa-cream","aria-label":"Rate ".concat(t+1," out of ").concat(i),children:(0,l.jsx)(b.Z,{className:"h-8 w-8 ".concat(t<c?"fill-aloa-black text-aloa-black":"text-aloa-gray hover:text-aloa-black")})},t+1))});case"multiselect":let d=E[e.name]||[];return(0,l.jsx)("div",{className:"space-y-2 max-h-48 overflow-y-auto border-2 border-aloa-black p-3",children:null===(o=e.options)||void 0===o?void 0:o.map(a=>(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)(N.fC,{id:"".concat(e.name,"-").concat(a),checked:d.includes(a),onCheckedChange:t=>{let l=t?[...d,a]:d.filter(e=>e!==a);I({...E,[e.name]:l})},className:"h-5 w-5 border-2 border-aloa-black hover:shadow-md focus:outline-none focus:ring-2 focus:ring-aloa-black focus:ring-offset-2 focus:ring-offset-aloa-cream transition-all duration-200",children:(0,l.jsx)(N.z$,{className:"flex items-center justify-center text-aloa-black",children:(0,l.jsx)(y.Z,{className:"h-4 w-4"})})}),(0,l.jsx)("label",{htmlFor:"".concat(e.name,"-").concat(a),className:"text-sm font-medium text-aloa-black cursor-pointer",children:a})]},a))});case"phone":return(0,l.jsx)(f,{type:"tel",...n});default:return(0,l.jsx)(f,{type:"text",...n})}};return _?(0,l.jsxs)(r.E.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"flex flex-col items-center justify-center min-h-[400px] text-center p-8",children:[(0,l.jsx)("div",{className:"bg-aloa-black text-aloa-cream p-4 rounded-full mb-6",children:(0,l.jsx)(y.Z,{className:"h-16 w-16"})}),(0,l.jsx)("h2",{className:"text-3xl font-display font-bold text-aloa-black mb-3 uppercase tracking-wider",children:"Thank You!"}),(0,l.jsx)("p",{className:"text-lg text-aloa-gray font-body",children:"Your response has been successfully submitted."})]}):(0,l.jsxs)("div",{className:"max-w-3xl mx-auto p-6",children:[T&&(0,l.jsx)(r.E.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"mb-6 p-4 bg-aloa-sand border-2 border-aloa-black",children:(0,l.jsx)("p",{className:"text-aloa-black font-body",children:"✨ Your previous progress has been restored. You can continue where you left off."})}),(0,l.jsxs)("div",{className:"mb-8",children:[(0,l.jsxs)("div",{className:"flex justify-between mb-3",children:[(0,l.jsxs)("span",{className:"text-sm font-display uppercase tracking-wider text-aloa-gray",children:["Step ",S+1," of ",V.length]}),(0,l.jsxs)("span",{className:"text-sm font-display uppercase tracking-wider text-aloa-gray",children:[V.length>0?Math.round((S+1)/V.length*100):0,"% Complete"]})]}),(0,l.jsx)("div",{className:"w-full bg-aloa-sand h-3 border-2 border-aloa-black",children:(0,l.jsx)(r.E.div,{className:"bg-aloa-black h-full",initial:{width:0},animate:{width:V.length>0?"".concat((S+1)/V.length*100,"%"):"0%"},transition:{duration:.5}})})]}),(0,l.jsxs)("div",{className:"mb-8",children:[m&&(0,l.jsxs)("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg flex items-center gap-2",children:[(0,l.jsxs)("svg",{className:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),(0,l.jsx)("span",{className:"text-sm font-medium text-blue-800",children:"Viewing your submitted response (read-only)"})]}),(0,l.jsx)("h1",{className:"text-3xl font-display font-bold text-aloa-black mb-2 uppercase tracking-tight",children:a.title}),a.description&&(0,l.jsx)("p",{className:"text-aloa-gray font-body",children:a.description})]}),(0,l.jsxs)(r.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},className:"mb-6",children:[(0,l.jsx)("h2",{className:"text-xl font-display font-bold text-aloa-black mb-2 uppercase tracking-wider",children:V[S]}),(0,l.jsx)("div",{className:"h-1 w-24 bg-aloa-black"})]},S),(0,l.jsxs)("form",{onSubmit:e=>{e.preventDefault(),S===V.length-1?Y(e):J(e)},children:[(0,l.jsx)(o.M,{mode:"wait",children:(0,l.jsx)(r.E.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.3},className:"space-y-6",children:q.map(e=>(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)(p,{htmlFor:e.name,children:[e.label,e.required&&(0,l.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]}),B(e),F[e.name]&&(0,l.jsx)("p",{className:"text-sm text-red-600 mt-1 font-body",children:F[e.name]})]},e.name))},S)}),(0,l.jsxs)("div",{className:"flex justify-between mt-8",children:[(0,l.jsxs)(u,{type:"button",variant:"outline",onClick:()=>{S>0&&(C(S-1),z({}))},disabled:0===S,className:"flex items-center gap-2",children:[(0,l.jsx)(j.Z,{className:"h-4 w-4"}),"Previous"]}),m?S<V.length-1?(0,l.jsxs)(u,{type:"button",onClick:J,className:"flex items-center gap-2",children:["Next",(0,l.jsx)(g.Z,{className:"h-4 w-4"})]}):(0,l.jsx)("div",{className:"flex items-center gap-2 text-gray-600",children:(0,l.jsx)("span",{className:"text-sm font-medium",children:"View Only Mode"})}):S===V.length-1?(0,l.jsxs)(u,{type:"submit",disabled:Z,className:"flex items-center gap-2",children:[Z?"Submitting...":"Submit",(0,l.jsx)(v.Z,{className:"h-4 w-4"})]}):(0,l.jsxs)(u,{type:"submit",className:"flex items-center gap-2",children:["Next",(0,l.jsx)(g.Z,{className:"h-4 w-4"})]})]})]})]})}}}]);