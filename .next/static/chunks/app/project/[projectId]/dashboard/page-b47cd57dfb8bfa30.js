(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[241],{5013:function(e,t,s){Promise.resolve().then(s.bind(s,2744))},2744:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return N}});var l=s(7437),r=s(2265),o=s(9376),a=s(8736),n=s(7689),i=s(2208),d=s(2805),c=s(3417),u=s(1671),p=s(1723),m=s(6337),f=s(9474),h=s(8893),x=s(2489),g=s(6362),y=s(2735),v=s(9658),j=s(166),b=s(7322);let w=(0,j.default)(()=>s.e(842).then(s.bind(s,3842)),{loadableGenerated:{webpack:()=>[3842]},ssr:!1});function N(){var e,t,s,j,b,N,_,S;let Z;let C=(0,o.useParams)();(0,o.useRouter)();let[M,D]=(0,r.useState)(null),[P,I]=(0,r.useState)([]),[O,T]=(0,r.useState)(!0),[E,F]=(0,r.useState)(null),[z,q]=(0,r.useState)(!1),[A,L]=(0,r.useState)(null),[H,R]=(0,r.useState)(!1),[B,J]=(0,r.useState)(new Set),[V,U]=(0,r.useState)({totalApplets:0,completedApplets:0,progressPercentage:0}),[W,G]=(0,r.useState)({}),[Y,K]=(0,r.useState)(null),[X,Q]=(0,r.useState)({}),[$,ee]=(0,r.useState)(!1),[et,es]=(0,r.useState)(!1),[el,er]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let e=localStorage.getItem("client_user_id");if(e)K(e);else{let e="client_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9));localStorage.setItem("client_user_id",e),K(e)}},[]),(0,r.useEffect)(()=>{Y&&eo()},[C.projectId,Y]);let eo=async()=>{try{var e,t;let s=await fetch("/api/aloa-projects/".concat(C.projectId,"/client-view?userId=").concat(Y)),l=await s.json();D(l.project),I(l.projectlets||[]),U(l.stats||{totalApplets:0,completedApplets:0,progressPercentage:0});let r=new Set;null===(e=l.projectlets)||void 0===e||e.forEach(e=>{var t;null===(t=e.applets)||void 0===t||t.forEach(e=>{let t=e.user_status||e.status;("completed"===t||"approved"===t)&&r.add(e.id),e.form_progress&&e.form_id&&G(t=>({...t,[e.form_id]:e.form_progress}))})}),J(r);try{let e=new Set;null===(t=l.projectlets)||void 0===t||t.forEach(t=>{var s;null===(s=t.applets)||void 0===s||s.forEach(t=>{var s,l;"form"===t.type&&(t.form_id||(null===(s=t.config)||void 0===s?void 0:s.form_id))&&e.add(t.form_id||(null===(l=t.config)||void 0===l?void 0:l.form_id))})});let s={};for(let t of e){let e=await fetch("/api/aloa-responses?form_id=".concat(t,"&user_id=").concat(Y));if(e.ok){let l=await e.json();l.responses&&l.responses.length>0&&(s[t]=l.responses[0])}}Q(s),console.log("User form responses loaded:",s)}catch(e){console.error("Error fetching form responses:",e)}}catch(e){console.error("Error fetching project:",e)}finally{T(!1)}},ea=async function(e,t){var s,l,r,o,a,n,i;let d=arguments.length>2&&void 0!==arguments[2]&&arguments[2],c="form"===e.type,u="link_submission"===e.type,p="upload"===e.type||"file_upload"===e.type,m=e.form_id||(null===(s=e.config)||void 0===s?void 0:s.form_id),f=c&&(null===(l=e.form)||void 0===l?void 0:l.status)==="closed",h=c&&m?X[m]:B.has(e.id);if((c||u||p||!h)&&(!c||!f||h)){if(await fetch("/api/aloa-projects/".concat(C.projectId,"/client-view"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({appletId:e.id,status:"in_progress",interactionType:"view",userId:Y})}),"form"===e.type){let s=e.form_id||(null===(r=e.config)||void 0===r?void 0:r.form_id);if(!s){console.error("No form_id found for applet:",e),alert("This form is not properly configured. Please contact support.");return}ee(d);let l=null;if(h&&X[s]&&console.log("Loaded previous responses for",d?"viewing":"editing",":",l=X[s].response_data),e.form){let r=e.form,i=(null===(o=r.aloa_form_fields)||void 0===o?void 0:o.sort((e,t)=>(e.field_order||0)-(t.field_order||0)))||[],d={...r,_id:r.id,urlId:r.url_id,fields:i.map(e=>{var t;return{_id:e.id,label:e.field_label,name:e.field_name,type:e.field_type,position:e.field_order,section:(null===(t=e.validation)||void 0===t?void 0:t.section)||"General Information",required:e.required,placeholder:e.placeholder,options:Array.isArray(e.options)?e.options:"string"==typeof e.options?JSON.parse(e.options):e.options,validation:e.validation}})};console.log("Transformed preloaded form:",d),console.log("Form fields count:",null===(a=d.fields)||void 0===a?void 0:a.length),console.log("Form fields:",d.fields),L(d),F({...e,projectlet:t,form_id:e.form_id||(null===(n=e.config)||void 0===n?void 0:n.form_id)}),l&&G(e=>({...e,[s]:{data:l}})),q(!0)}else try{let r=await fetch("/api/aloa-forms/".concat(s));if(!r.ok)throw Error("Failed to fetch form: ".concat(r.status));let o=await r.json();console.log("Fetched form:",o);let a=(null===(i=o.aloa_form_fields)||void 0===i?void 0:i.sort((e,t)=>(e.field_order||0)-(t.field_order||0)))||[],n={...o,_id:o.id,urlId:o.url_id,fields:a.map(e=>{var t;return{_id:e.id,label:e.field_label,name:e.field_name,type:e.field_type,position:e.field_order,section:(null===(t=e.validation)||void 0===t?void 0:t.section)||"General Information",required:e.required,placeholder:e.placeholder,options:Array.isArray(e.options)?e.options:"string"==typeof e.options?JSON.parse(e.options):e.options,validation:e.validation}})};console.log("Transformed form:",n),L(n),F({...e,projectlet:t,form_id:s}),l&&G(e=>({...e,[s]:{data:l}})),q(!0)}catch(e){console.error("Error fetching form:",e),alert("Unable to load the form. Please try again later.")}}else"link_submission"===e.type?(F({...e,projectlet:t}),es(!0)):p&&(F({...e,projectlet:t}),er(!0))}},en=async e=>{try{var t,s;let l=Math.random().toString(36).substring(2);document.cookie="csrf-token=".concat(l,"; path=/");let r=await fetch("/api/aloa-responses",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":l},body:JSON.stringify({formId:E.form_id||(null===(t=E.form)||void 0===t?void 0:t.id),projectId:C.projectId,userId:Y,data:e})});r.ok||console.error("Failed to submit form response:",await r.text());let o=await fetch("/api/aloa-projects/".concat(C.projectId,"/client-view"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({appletId:E.id,status:"completed",interactionType:"submission",userId:Y,data:{form_responses:e}})});if(!o.ok)throw console.error("Failed to update applet status:",await o.text()),Error("Failed to mark form as completed");let a=new Set(B);a.add(E.id),J(a);let n=E.form_id||(null===(s=E.form)||void 0===s?void 0:s.id);n&&(Q(t=>({...t,[n]:{response_data:e,submitted_at:new Date().toISOString()}})),G(e=>{let t={...e};return delete t[n],t})),q(!1),R(!0),setTimeout(()=>R(!1),7e3),eo()}catch(e){console.error("Error submitting form:",e),alert("There was an error submitting the form. Please try again.")}},ei=e=>({form:a.Z,upload:n.Z,review:i.Z,moodboard:d.Z,content_gather:c.Z})[e]||a.Z;if(O)return(0,l.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 to-blue-50 flex items-center justify-center",children:(0,l.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600"})});let ed=V.progressPercentage||0;return(0,l.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 to-blue-50",children:[(0,l.jsx)(w,{show:H,duration:6e3}),(0,l.jsx)("div",{className:"bg-white shadow-sm border-b",children:(0,l.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:(null==M?void 0:M.project_name)||(null==M?void 0:M.name)||"Project Dashboard"}),(0,l.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Welcome to your project workspace"})]}),(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsxs)("svg",{className:"w-20 h-20 transform -rotate-90",children:[(0,l.jsx)("circle",{cx:"40",cy:"40",r:"36",stroke:"currentColor",strokeWidth:"8",fill:"none",className:"text-gray-200"}),(0,l.jsx)("circle",{cx:"40",cy:"40",r:"36",stroke:"currentColor",strokeWidth:"8",fill:"none",strokeDasharray:"".concat(2.26*ed," 226"),className:"text-purple-600 transition-all duration-500"})]}),(0,l.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,l.jsxs)("span",{className:"text-xl font-bold",children:[ed,"%"]})})]})]})})}),(0,l.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[(0,l.jsx)("div",{className:"bg-white rounded-xl p-6 shadow-sm",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm text-gray-600",children:"Tasks Complete"}),(0,l.jsx)("p",{className:"text-2xl font-bold",children:V.completedApplets||0})]}),(0,l.jsx)(u.Z,{className:"w-8 h-8 text-green-500"})]})}),(0,l.jsx)("div",{className:"bg-white rounded-xl p-6 shadow-sm",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm text-gray-600",children:"In Progress"}),(0,l.jsx)("p",{className:"text-2xl font-bold",children:(Z=0,P.forEach(e=>{var t;null===(t=e.applets)||void 0===t||t.forEach(e=>{let t=e.user_status||e.status;("in_progress"===t||"started"===t)&&Z++})}),Z)})]}),(0,l.jsx)(p.Z,{className:"w-8 h-8 text-yellow-500"})]})}),(0,l.jsx)("div",{className:"bg-white rounded-xl p-6 shadow-sm",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm text-gray-600",children:"Locked"}),(0,l.jsx)("p",{className:"text-2xl font-bold",children:P.filter(e=>"locked"===e.status).length})]}),(0,l.jsx)(m.Z,{className:"w-8 h-8 text-gray-500"})]})}),(0,l.jsx)("div",{className:"bg-white rounded-xl p-6 shadow-sm",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm text-gray-600",children:"Achievement"}),(0,l.jsx)("p",{className:"text-2xl font-bold",children:"\uD83C\uDFC6"})]}),(0,l.jsx)(f.Z,{className:"w-8 h-8 text-purple-500"})]})})]}),(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Your Project Journey"}),P.map((e,t)=>{let s="locked"===e.status,r="completed"===e.status,o=e.applets||[],a=o.some(e=>{let t=e.user_status||e.status;return"in_progress"===t||"started"===t||"completed"===t||"approved"===t}),n=o.length>0&&o.every(e=>{let t=e.user_status||e.status;return"completed"===t||"approved"===t}),d=a&&!n;return(0,l.jsxs)("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden ".concat(s?"opacity-60":""),children:[(0,l.jsx)("div",{className:"p-6 border-b ".concat(r?"bg-green-50":d?"bg-yellow-50":s?"bg-gray-50":"bg-white"),children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,l.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center ".concat(r?"bg-green-100 text-green-600":d?"bg-yellow-100 text-yellow-600":s?"bg-gray-100 text-gray-400":"bg-purple-100 text-purple-600"),children:r?(0,l.jsx)(u.Z,{className:"w-6 h-6"}):d?(0,l.jsx)(p.Z,{className:"w-6 h-6"}):s?(0,l.jsx)(m.Z,{className:"w-6 h-6"}):(0,l.jsx)("span",{className:"font-bold",children:t+1})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"font-bold text-lg",children:e.name}),e.description&&(0,l.jsx)("p",{className:"text-sm text-gray-600",children:e.description})]})]}),e.deadline&&(0,l.jsxs)("div",{className:"text-sm text-gray-500",children:["Due: ",new Date(e.deadline).toLocaleDateString()]})]})}),!s&&o.length>0&&(0,l.jsx)("div",{className:"p-6 ".concat(d?"bg-yellow-50/50":""),children:(0,l.jsx)("div",{className:"space-y-3",children:o.map(t=>{var s,r,o,a,n;let d=ei(t.type),c=B.has(t.id),p="form"===t.type,f=t.form_id||(null===(s=t.config)||void 0===s?void 0:s.form_id),x=p&&(null===(r=t.form)||void 0===r?void 0:r.status)==="closed",g=p&&f&&X[f],y="available",v=null;return p?g&&x?(y="completed-locked",v="Form completed & locked. No longer accepting responses."):g&&!x?(y="user-complete-editable",v="Form completed! We are still awaiting other responses. Want to make a change? Click the pencil icon."):x&&(y="locked",v="Form closed to new responses"):"link_submission"===t.type&&c?(y="link-completed",v="Links reviewed - click to view again"):("upload"===t.type||"file_upload"===t.type)&&c?(y="file-completed",v="Files reviewed - click to view again"):c&&(y="completed"),(0,l.jsx)("button",{onClick:()=>ea(t,e,"completed-locked"===y),disabled:"locked"===y||"completed"===y&&"link_submission"!==t.type&&"upload"!==t.type&&"file_upload"!==t.type,className:"w-full p-4 rounded-lg border-2 transition-all ".concat("completed-locked"===y?"bg-green-50 border-green-300 hover:border-green-400 hover:shadow-md cursor-pointer":"user-complete-editable"===y?"bg-green-50 border-green-300 hover:border-green-400 hover:shadow-md cursor-pointer":"link-completed"===y?"bg-green-50 border-green-300 hover:border-green-400 hover:shadow-md cursor-pointer":"file-completed"===y?"bg-purple-50 border-purple-300 hover:border-purple-400 hover:shadow-md cursor-pointer":"locked"===y?"bg-gray-50 border-gray-300 cursor-default opacity-75":"completed"===y?"bg-green-50 border-green-300 cursor-default":"bg-white border-gray-200 hover:border-purple-300 hover:shadow-md cursor-pointer"),children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,l.jsx)("div",{className:"p-2 rounded-lg ".concat("completed-locked"===y||"user-complete-editable"===y||"link-completed"===y?"bg-green-100":"file-completed"===y?"bg-purple-100":"locked"===y?"bg-gray-100":"completed"===y?"bg-green-100":"bg-purple-100"),children:"completed-locked"===y||"user-complete-editable"===y||"completed"===y||"link-completed"===y||"file-completed"===y?(0,l.jsx)(u.Z,{className:"w-5 h-5 text-green-600"}):"locked"===y?(0,l.jsx)(m.Z,{className:"w-5 h-5 text-gray-600"}):(0,l.jsx)(d,{className:"w-5 h-5 text-purple-600"})}),(0,l.jsxs)("div",{className:"text-left",children:[(0,l.jsx)("p",{className:"font-medium",children:"form"===t.type&&(null===(o=t.form)||void 0===o?void 0:o.title)?t.form.title:"link_submission"===t.type&&(null===(a=t.config)||void 0===a?void 0:a.heading)?t.config.heading:("upload"===t.type||"file_upload"===t.type)&&(null===(n=t.config)||void 0===n?void 0:n.heading)?t.config.heading:t.name}),v?(0,l.jsx)("p",{className:"text-sm text-gray-600 italic",children:v}):t.client_instructions?(0,l.jsx)("p",{className:"text-sm text-gray-600",children:t.client_instructions}):null]})]}),"locked"===y?(0,l.jsx)(m.Z,{className:"w-5 h-5 text-gray-500"}):"user-complete-editable"===y?(0,l.jsx)(h.Z,{className:"w-5 h-5 text-green-600"}):"completed-locked"===y?(0,l.jsx)(i.Z,{className:"w-5 h-5 text-green-600"}):"link-completed"===y?(0,l.jsx)(i.Z,{className:"w-5 h-5 text-green-600"}):"completed"===y?(0,l.jsx)(u.Z,{className:"w-6 h-6 text-green-600"}):(0,l.jsx)("div",{className:"text-purple-600",children:"Start →"})]})},t.id)})})})]},e.id)})]})]}),z&&A&&(0,l.jsx)(k,{form:A,onSubmit:en,onClose:()=>{null==E||E.form_id,q(!1),ee(!1)},savedProgress:W[null==E?void 0:E.form_id],onProgressUpdate:null,isViewOnly:$}),et&&E&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:(0,l.jsxs)("div",{className:"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[(0,l.jsxs)("div",{className:"p-6 border-b",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsx)("h2",{className:"text-2xl font-bold",children:(null===(e=E.config)||void 0===e?void 0:e.heading)||"Links & Resources"}),(0,l.jsx)("button",{onClick:()=>es(!1),className:"p-2 hover:bg-gray-100 rounded-lg",children:(0,l.jsx)(x.Z,{className:"w-6 h-6"})})]}),(null===(t=E.config)||void 0===t?void 0:t.description)&&(0,l.jsx)("p",{className:"mt-2 text-gray-600",children:E.config.description})]}),(0,l.jsxs)("div",{className:"p-6",children:[(null===(s=E.config)||void 0===s?void 0:s.links)&&E.config.links.length>0?(0,l.jsx)("div",{className:"space-y-4",children:E.config.links.map((e,t)=>(0,l.jsx)("div",{className:"border rounded-lg p-4 hover:bg-gray-50 transition-colors",children:(0,l.jsxs)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-start space-x-3 group",children:[(0,l.jsx)(g.Z,{className:"w-5 h-5 text-blue-600 mt-1 flex-shrink-0 group-hover:text-blue-700"}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("p",{className:"font-medium text-blue-600 group-hover:text-blue-700 group-hover:underline",children:e.text||"View Link"}),e.description&&(0,l.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.description})]})]})},t))}):(0,l.jsx)("p",{className:"text-gray-500 text-center py-8",children:"No links available yet."}),(null===(j=E.config)||void 0===j?void 0:j.allow_client_acknowledgment)&&(0,l.jsx)("div",{className:"mt-6 pt-6 border-t",children:B.has(E.id)||"completed"===E.user_status?(0,l.jsxs)("div",{className:"w-full py-3 bg-green-100 text-green-700 rounded-lg text-center font-medium border border-green-300",children:["✓ Marked as Reviewed on ",E.user_completed_at?new Date(E.user_completed_at).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"}):"Recently"]}):(0,l.jsx)("button",{onClick:async()=>{await fetch("/api/aloa-projects/".concat(C.projectId,"/client-view"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({appletId:E.id,status:"completed",interactionType:"completion",userId:Y,data:{acknowledged:!0,acknowledgedAt:new Date().toISOString()}})}),J(e=>new Set([...e,E.id])),es(!1),R(!0),setTimeout(()=>R(!1),7e3),eo()},className:"w-full py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium",children:"Mark as Reviewed"})})]})]})}),el&&E&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:(0,l.jsxs)("div",{className:"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[(0,l.jsxs)("div",{className:"p-6 border-b",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsx)("h2",{className:"text-2xl font-bold",children:(null===(b=E.config)||void 0===b?void 0:b.heading)||"File Downloads"}),(0,l.jsx)("button",{onClick:()=>er(!1),className:"p-2 hover:bg-gray-100 rounded-lg",children:(0,l.jsx)(x.Z,{className:"w-6 h-6"})})]}),(null===(N=E.config)||void 0===N?void 0:N.description)&&(0,l.jsx)("p",{className:"mt-2 text-gray-600",children:E.config.description})]}),(0,l.jsxs)("div",{className:"p-6",children:[(null===(_=E.config)||void 0===_?void 0:_.files)&&E.config.files.length>0?(0,l.jsxs)("div",{className:"space-y-3",children:[E.config.files.map((e,t)=>(0,l.jsx)("div",{className:"border rounded-lg p-4 hover:bg-gray-50 transition-colors",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,l.jsx)("span",{className:"text-2xl",children:(e=>{let t=e.split(".").pop().toLowerCase();return["jpg","jpeg","png","gif","svg"].includes(t)?"\uD83D\uDDBC️":["pdf","doc","docx","txt"].includes(t)?"\uD83D\uDCC4":"zip"===t||"rar"===t?"\uD83D\uDCE6":"\uD83D\uDCCE"})(e.name)}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("p",{className:"font-medium text-gray-900",children:[e.name,"final-deliverables"===e.category&&(0,l.jsx)("span",{className:"ml-2 text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded",children:"Final"})]}),(0,l.jsxs)("p",{className:"text-sm text-gray-500",children:[(e=>{if(!e||0===e)return"0 Bytes";let t=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,t)*100)/100+" "+["Bytes","KB","MB","GB"][t]})(e.size)," • Uploaded ",new Date(e.uploaded_at).toLocaleDateString(),"supabase"===e.storage_type&&(0,l.jsx)("span",{className:"ml-2 text-blue-600",children:"☁️ Cloud"})]})]})]}),(0,l.jsxs)("button",{onClick:async()=>{if(e.id)try{await fetch("/api/project-files",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e.id,increment_download:!0})})}catch(e){console.log("Download tracking failed:",e)}if("supabase"===e.storage_type&&e.url)window.open(e.url,"_blank");else if(e.url&&!e.data)window.open(e.url,"_blank");else if(e.data){let t=document.createElement("a");t.href=e.data,t.download=e.name,t.click()}},className:"flex items-center space-x-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:[(0,l.jsx)(y.Z,{className:"w-4 h-4"}),(0,l.jsx)("span",{children:"Download"})]})]})},t)),!B.has(E.id)&&(0,l.jsx)("button",{onClick:async()=>{await fetch("/api/aloa-projects/".concat(C.projectId,"/client-view"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"update_applet_progress",appletId:E.id,userId:Y,projectletId:E.projectlet.id,progressData:{status:"completed",completedAt:new Date().toISOString()}})}),J(e=>new Set([...e,E.id])),er(!1),R(!0),setTimeout(()=>R(!1),7e3),eo()},className:"w-full py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium mt-4",children:"Mark Files as Reviewed"}),B.has(E.id)&&(0,l.jsxs)("div",{className:"text-center py-3 bg-green-50 text-green-700 rounded-lg font-medium",children:["✓ Files reviewed on ",new Date().toLocaleDateString()]})]}):(0,l.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,l.jsx)(v.Z,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),(0,l.jsx)("p",{children:"No files available yet"}),(0,l.jsx)("p",{className:"text-sm mt-1",children:"Check back later for project files"})]}),(null===(S=E.config)||void 0===S?void 0:S.allow_client_upload)&&(0,l.jsxs)("div",{className:"mt-6 pt-6 border-t",children:[(0,l.jsx)("p",{className:"text-sm text-gray-600 mb-3",children:"You can upload files too:"}),(0,l.jsxs)("label",{className:"relative",children:[(0,l.jsx)("input",{type:"file",className:"hidden",onChange:async e=>{e.target.files[0]&&alert("Client file upload coming soon!")}}),(0,l.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center cursor-pointer hover:border-purple-400 transition-colors",children:[(0,l.jsx)(n.Z,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),(0,l.jsx)("p",{className:"text-sm text-gray-600",children:"Click to upload file"}),(0,l.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Max ",E.config.max_file_size||10,"MB"]})]})]})]})]})]})})]})}function k(e){let{form:t,onSubmit:s,onClose:r,savedProgress:o,onProgressUpdate:a,isViewOnly:n=!1}=e,i=async e=>{let t={};Object.keys(e).forEach(s=>{t[s]=e[s]}),await s(t),r()};return(0,l.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:(0,l.jsx)("div",{className:"bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)("button",{onClick:r,className:"absolute right-4 top-4 p-2 hover:bg-gray-100 rounded-lg z-10",children:(0,l.jsx)(x.Z,{className:"w-5 h-5"})}),(0,l.jsx)("div",{className:"p-6",children:(0,l.jsx)(b.Z,{form:t,isModal:!0,onComplete:i,initialData:null==o?void 0:o.data,initialSection:null==o?void 0:o.section,onProgressChange:a,isViewOnly:n})})]})})})}},1723:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});let l=(0,s(9205).Z)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]])},2735:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});let l=(0,s(9205).Z)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]])},6362:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});let l=(0,s(9205).Z)("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]])},2208:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});let l=(0,s(9205).Z)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},8736:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});let l=(0,s(9205).Z)("file-text",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]])},9658:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});let l=(0,s(9205).Z)("file",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]])},3417:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});let l=(0,s(9205).Z)("message-square",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]])},2805:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});let l=(0,s(9205).Z)("palette",[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]])},8893:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});let l=(0,s(9205).Z)("pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]])},9474:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});let l=(0,s(9205).Z)("trophy",[["path",{d:"M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978",key:"1n3hpd"}],["path",{d:"M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978",key:"rfe1zi"}],["path",{d:"M18 9h1.5a1 1 0 0 0 0-5H18",key:"7xy6bh"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z",key:"1mhfuq"}],["path",{d:"M6 9H4.5a1 1 0 0 1 0-5H6",key:"tex48p"}]])},7689:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});let l=(0,s(9205).Z)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]])},2489:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});let l=(0,s(9205).Z)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},166:function(e,t,s){"use strict";s.d(t,{default:function(){return r.a}});var l=s(5775),r=s.n(l)},5775:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return o}});let l=s(7043);s(7437),s(2265);let r=l._(s(5602));function o(e,t){var s;let l={loading:e=>{let{error:t,isLoading:s,pastDelay:l}=e;return null}};"function"==typeof e&&(l.loader=e);let o={...l,...t};return(0,r.default)({...o,modules:null==(s=o.loadableGenerated)?void 0:s.modules})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},1523:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return r}});let l=s(8993);function r(e){let{reason:t,children:s}=e;if("undefined"==typeof window)throw new l.BailoutToCSRError(t);return s}},5602:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return d}});let l=s(7437),r=s(2265),o=s(1523),a=s(49);function n(e){return{default:e&&"default"in e?e.default:e}}let i={loader:()=>Promise.resolve(n(()=>null)),loading:null,ssr:!0},d=function(e){let t={...i,...e},s=(0,r.lazy)(()=>t.loader().then(n)),d=t.loading;function c(e){let n=d?(0,l.jsx)(d,{isLoading:!0,pastDelay:!0,error:null}):null,i=t.ssr?(0,l.jsxs)(l.Fragment,{children:["undefined"==typeof window?(0,l.jsx)(a.PreloadCss,{moduleIds:t.modules}):null,(0,l.jsx)(s,{...e})]}):(0,l.jsx)(o.BailoutToCSR,{reason:"next/dynamic",children:(0,l.jsx)(s,{...e})});return(0,l.jsx)(r.Suspense,{fallback:n,children:i})}return c.displayName="LoadableComponent",c}},49:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadCss",{enumerable:!0,get:function(){return o}});let l=s(7437),r=s(544);function o(e){let{moduleIds:t}=e;if("undefined"!=typeof window)return null;let s=(0,r.getExpectedRequestStore)("next/dynamic css"),o=[];if(s.reactLoadableManifest&&t){let e=s.reactLoadableManifest;for(let s of t){if(!e[s])continue;let t=e[s].files.filter(e=>e.endsWith(".css"));o.push(...t)}}return 0===o.length?null:(0,l.jsx)(l.Fragment,{children:o.map(e=>(0,l.jsx)("link",{precedence:"dynamic",rel:"stylesheet",href:s.assetPrefix+"/_next/"+encodeURI(e),as:"style"},e))})}}},function(e){e.O(0,[846,155,322,971,117,744],function(){return e(e.s=5013)}),_N_E=e.O()}]);