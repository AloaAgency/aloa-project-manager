(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{9810:function(e,r,t){Promise.resolve().then(t.t.bind(t,7960,23)),Promise.resolve().then(t.bind(t,3089)),Promise.resolve().then(t.bind(t,4789)),Promise.resolve().then(t.bind(t,9064))},3089:function(e,r,t){"use strict";t.d(r,{default:function(){return g}});var s=t(7437),a=t(4789),n=t(7648),i=t(9376),l=t(9205);let o=(0,l.Z)("chart-column",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);var c=t(9397),u=t(8736),d=t(2023),h=t(5805),f=t(2369),m=t(8728);let p=(0,l.Z)("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]]);var x=t(2265);function g(){var e;let{user:r,profile:t,signOut:l,isSuperAdmin:g,isProjectAdmin:y,isTeamMember:v}=(0,a.a)(),b=(0,i.usePathname)(),[w,k]=(0,x.useState)(!1);if(b.startsWith("/auth/")||!r)return null;let j=[{href:"/dashboard",label:"Dashboard",icon:o},{href:"/create",label:"Create Form",icon:c.Z,show:v},{href:"/responses",label:"Responses",icon:u.Z,show:v},{href:"/ai-analysis",label:"AI Analysis",icon:d.Z,show:v},{href:"/admin",label:"Admin",icon:h.Z,show:g}].filter(e=>!1!==e.show);return(0,s.jsxs)("nav",{className:"bg-aloa-dark border-b-2 border-aloa-dark",children:[(0,s.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"flex justify-between h-16",children:[(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)(n.default,{href:"/dashboard",className:"flex items-center px-2 py-2 text-aloa-cream font-bold text-xl",children:"Aloa\xae"}),(0,s.jsx)("div",{className:"hidden sm:ml-6 sm:flex sm:space-x-4",children:j.map(e=>{let r=e.icon,t=b===e.href;return(0,s.jsxs)(n.default,{href:e.href,className:"inline-flex items-center px-3 py-2 text-sm font-medium transition-colors ".concat(t?"text-aloa-cream border-b-2 border-aloa-cream":"text-gray-300 hover:text-aloa-cream"),children:[(0,s.jsx)(r,{className:"w-4 h-4 mr-2"}),e.label]},e.href)})})]}),(0,s.jsx)("div",{className:"flex items-center",children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("button",{onClick:()=>k(!w),className:"flex items-center text-sm rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-aloa-dark focus:ring-aloa-cream",children:(0,s.jsxs)("div",{className:"flex items-center space-x-3 px-3 py-2 rounded-lg hover:bg-gray-800 transition-colors",children:[(0,s.jsxs)("div",{className:"text-right hidden sm:block",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-aloa-cream",children:(null==t?void 0:t.full_name)||r.email}),(0,s.jsx)("p",{className:"text-xs text-gray-400",children:null==t?void 0:null===(e=t.role)||void 0===e?void 0:e.replace("_"," ").replace(/\b\w/g,e=>e.toUpperCase())})]}),(0,s.jsx)("div",{className:"h-8 w-8 rounded-full bg-aloa-cream flex items-center justify-center",children:(0,s.jsx)(f.Z,{className:"h-5 w-5 text-aloa-dark"})})]})}),w&&(0,s.jsx)("div",{className:"origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 z-50",children:(0,s.jsxs)("div",{className:"py-1",role:"menu",children:[(0,s.jsxs)(n.default,{href:"/profile",className:"flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",onClick:()=>k(!1),children:[(0,s.jsx)(f.Z,{className:"w-4 h-4 mr-2"}),"Profile"]}),(0,s.jsxs)(n.default,{href:"/settings",className:"flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",onClick:()=>k(!1),children:[(0,s.jsx)(m.Z,{className:"w-4 h-4 mr-2"}),"Settings"]}),(0,s.jsx)("hr",{className:"my-1"}),(0,s.jsxs)("button",{onClick:()=>{k(!1),l()},className:"flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 text-left",children:[(0,s.jsx)(p,{className:"w-4 h-4 mr-2"}),"Sign Out"]})]})})]})})]})}),(0,s.jsx)("div",{className:"sm:hidden border-t border-gray-700",children:(0,s.jsx)("div",{className:"px-2 pt-2 pb-3 space-y-1",children:j.map(e=>{let r=e.icon,t=b===e.href;return(0,s.jsxs)(n.default,{href:e.href,className:"flex items-center px-3 py-2 rounded-md text-base font-medium transition-colors ".concat(t?"bg-gray-900 text-aloa-cream":"text-gray-300 hover:bg-gray-700 hover:text-aloa-cream"),children:[(0,s.jsx)(r,{className:"w-5 h-5 mr-3"}),e.label]},e.href)})})})]})}},4789:function(e,r,t){"use strict";t.d(r,{UserProvider:function(){return o},a:function(){return c}});var s=t(7437),a=t(2265),n=t(9376),i=t(3059);let l=(0,a.createContext)({});function o(e){let{children:r}=e,[t,o]=(0,a.useState)(null),[c,u]=(0,a.useState)(null),[d,h]=(0,a.useState)(!0),f=(0,n.useRouter)(),m=(0,i.eI)();(0,a.useEffect)(()=>{(async()=>{try{let{data:{user:e},error:r}=await m.auth.getUser();if(e&&!r){o(e);let{data:r}=await m.from("aloa_user_profiles").select("*").eq("id",e.id).single();u(r)}}catch(e){console.error("Error getting user:",e)}finally{h(!1)}})();let{data:{subscription:e}}=m.auth.onAuthStateChange(async(e,r)=>{if("SIGNED_IN"===e&&(null==r?void 0:r.user)){o(r.user);let{data:e}=await m.from("aloa_user_profiles").select("*").eq("id",r.user.id).single();u(e)}else if("SIGNED_OUT"===e)o(null),u(null),f.push("/auth/login");else if("USER_UPDATED"===e&&(null==r?void 0:r.user)){o(r.user);let{data:e}=await m.from("aloa_user_profiles").select("*").eq("id",r.user.id).single();u(e)}});return()=>{null==e||e.unsubscribe()}},[f,m]);let p=async e=>{if(t)try{let{data:r,error:s}=await m.from("aloa_user_profiles").update(e).eq("id",t.id).select().single();if(s)throw s;return u(r),{data:r,error:null}}catch(e){return console.error("Error updating profile:",e),{data:null,error:e}}},x=async(e,r)=>{if(!t)return!1;try{let{data:s}=await m.from("aloa_project_members").select("project_role").eq("user_id",t.id).eq("project_id",e).single();if(!s)return!1;let a=["viewer","editor","admin","owner"],n=a.indexOf(r);return a.indexOf(s.project_role)>=n}catch(e){return console.error("Error checking project role:",e),!1}},g={user:t,profile:c,loading:d,signOut:async()=>{try{let{error:e}=await m.auth.signOut();if(e)throw e}catch(e){console.error("Error signing out:",e)}},updateProfile:p,hasRole:e=>(null==c?void 0:c.role)===e,hasProjectRole:x,isAuthenticated:!!t,isSuperAdmin:(null==c?void 0:c.role)==="super_admin",isProjectAdmin:(null==c?void 0:c.role)==="project_admin"||(null==c?void 0:c.role)==="super_admin",isTeamMember:["team_member","project_admin","super_admin"].includes(null==c?void 0:c.role),isClient:(null==c?void 0:c.role)==="client"};return(0,s.jsx)(l.Provider,{value:g,children:r})}function c(){let e=(0,a.useContext)(l);if(void 0===e)throw Error("useUser must be used within a UserProvider");return e}},3059:function(e,r,t){"use strict";t.d(r,{RN:function(){return n},c0:function(){return l},eI:function(){return a},gQ:function(){return o},y1:function(){return i}});var s=t(2990);function a(){let e="https://eycgzjqwowrdmjlzqqyg.supabase.co",r="sb_publishable_eG0lH_ACpyOjqG44mN_5PA_1-oFLr5n";if(console.log("Creating Supabase client with:",{url:e,keyPrefix:r?r.substring(0,20)+"...":"NO KEY"}),!e||!r)throw console.error("Missing Supabase environment variables"),Error("Supabase configuration is missing");return(0,s.createBrowserClient)(e,r)}async function n(e){let r=a(),{error:t}=await r.auth.signInWithOtp({email:e,options:{emailRedirectTo:"".concat(window.location.origin,"/auth/callback")}});return t?{error:t.message}:{success:!0}}async function i(e,r){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",s=a(),{data:n,error:i}=await s.auth.signUp({email:e,password:r,options:{data:{full_name:t},emailRedirectTo:"".concat(window.location.origin,"/auth/callback")}});return i?{error:i.message}:n.user&&n.user.identities&&0===n.user.identities.length?{error:"A user with this email already exists. Please sign in instead.",userExists:!0}:{user:n.user}}async function l(e){let r=a();console.log("Attempting to reset password for:",e);let{data:t,error:s}=await r.auth.resetPasswordForEmail(e,{redirectTo:"".concat(window.location.origin,"/auth/update-password")});return(console.log("Reset password response:",{data:t,error:s}),s)?(console.error("Reset password error:",s),{error:s.message}):{success:!0}}async function o(e){let r=a(),{error:t}=await r.auth.updateUser({password:e});return t?{error:t.message}:{success:!0}}},8736:function(e,r,t){"use strict";t.d(r,{Z:function(){return s}});let s=(0,t(9205).Z)("file-text",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]])},9397:function(e,r,t){"use strict";t.d(r,{Z:function(){return s}});let s=(0,t(9205).Z)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},8728:function(e,r,t){"use strict";t.d(r,{Z:function(){return s}});let s=(0,t(9205).Z)("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},2023:function(e,r,t){"use strict";t.d(r,{Z:function(){return s}});let s=(0,t(9205).Z)("sparkles",[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]])},2369:function(e,r,t){"use strict";t.d(r,{Z:function(){return s}});let s=(0,t(9205).Z)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},5805:function(e,r,t){"use strict";t.d(r,{Z:function(){return s}});let s=(0,t(9205).Z)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]])},7960:function(){}},function(e){e.O(0,[587,346,64,648,971,117,744],function(){return e(e.s=9810)}),_N_E=e.O()}]);