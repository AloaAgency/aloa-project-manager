(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[756],{6558:function(e,t,s){Promise.resolve().then(s.bind(s,9524))},9524:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return q}});var a=s(7437),r=s(2265),l=s(9376),o=s(166),n=s(9537),c=s(6337),i=s(9589);s(4372),s(1723),s(9322);var d=s(1671),m=s(2660),p=s(4972),u=s(7689),x=s(9202),h=s(6475),g=s(91),j=s(9658),f=s(8930),b=s(5805),y=s(9397),v=s(8893),N=s(9345),w=s(6595),k=s(2135),C=s(875),_=s(8736),D=s(2208),I=s(2805),Z=s(3417),S=s(1905),E=s(2489),T=s(5675),P=s(1047),A=s(1533),F=s(8728),O=s(8867),L=s(6362),U=s(464),R=s(5868),J=s(9064);let V=(0,o.default)(()=>s.e(986).then(s.bind(s,9986)),{loadableGenerated:{webpack:()=>[9986]},ssr:!1}),B=(0,o.default)(()=>s.e(78).then(s.bind(s,78)),{loadableGenerated:{webpack:()=>[78]},ssr:!1}),z=(0,o.default)(()=>s.e(538).then(s.bind(s,3538)),{loadableGenerated:{webpack:()=>[3538]},ssr:!1,loading:()=>(0,a.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"})})}),G=(0,o.default)(()=>s.e(202).then(s.bind(s,6202)),{loadableGenerated:{webpack:()=>[6202]},ssr:!1}),K=(0,o.default)(()=>s.e(482).then(s.bind(s,3482)),{loadableGenerated:{webpack:()=>[3482]},ssr:!1}),M=(0,o.default)(()=>s.e(768).then(s.bind(s,5768)),{loadableGenerated:{webpack:()=>[5768]},ssr:!1});function H(){var e,t,s,o,n,H;let q=(0,l.useParams)(),W=(0,l.useRouter)(),[Y,Q]=(0,r.useState)(null),[X,$]=(0,r.useState)([]),[ee,et]=(0,r.useState)(!0),[es,ea]=(0,r.useState)(null),[er,el]=(0,r.useState)([]),[eo,en]=(0,r.useState)([]),[ec,ei]=(0,r.useState)([]),[ed,em]=(0,r.useState)(!1),[ep,eu]=(0,r.useState)(null),[ex,eh]=(0,r.useState)(!1),[eg,ej]=(0,r.useState)(null),[ef,eb]=(0,r.useState)(!1),[ey,ev]=(0,r.useState)(!1),[eN,ew]=(0,r.useState)({}),[ek,eC]=(0,r.useState)({}),[e_,eD]=(0,r.useState)(null),[eI,eZ]=(0,r.useState)(""),[eS,eE]=(0,r.useState)(null),[eT,eP]=(0,r.useState)(!1),[eA,eF]=(0,r.useState)(null),[eO,eL]=(0,r.useState)(!1),[eU,eR]=(0,r.useState)(null),[eJ,eV]=(0,r.useState)(!1),[eB,ez]=(0,r.useState)(!1),[eG,eK]=(0,r.useState)(null),[eM,eH]=(0,r.useState)([]),[eq,eW]=(0,r.useState)(!1),[eY,eQ]=(0,r.useState)(null),[eX,e$]=(0,r.useState)({});(0,r.useEffect)(()=>{e9(),e0(),e6()},[q.projectId]),(0,r.useEffect)(()=>{let e=e=>{e.target.closest(".action-menu-container")||eF(null)};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[]);let e0=async()=>{try{let e=await fetch("/api/aloa-projects/".concat(q.projectId,"/knowledge")),t=await e.json();ej(t)}catch(e){console.error("Error fetching knowledge base:",e)}},e2=async(e,t)=>{try{(await fetch("/api/aloa-projects/".concat(q.projectId,"/knowledge"),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({[e]:t})})).ok&&(J.ZP.success("Knowledge base updated"),e0())}catch(e){console.error("Error updating knowledge:",e),J.ZP.error("Failed to update knowledge base")}},e1=async e=>{ev(!0);let t=new FormData;t.append("file",e),t.append("projectId",q.projectId);try{let s=await fetch("/api/aloa-forms/upload",{method:"POST",body:t});if(!s.ok)throw Error("Failed to upload file");let{fileUrl:a}=await s.json();(await fetch("/api/aloa-projects/".concat(q.projectId,"/knowledge"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"file",title:e.name,file_url:a,importance:7})})).ok&&(J.ZP.success("File added to knowledge base"),e0(),eb(!1))}catch(e){console.error("Error uploading file:",e),J.ZP.error("Failed to upload file")}finally{ev(!1)}},e4=async e=>{if(confirm("Are you sure you want to delete this knowledge document?"))try{(await fetch("/api/aloa-projects/".concat(q.projectId,"/knowledge?knowledgeId=").concat(e),{method:"DELETE"})).ok&&(J.ZP.success("Knowledge document deleted"),e0())}catch(e){console.error("Error deleting knowledge:",e),J.ZP.error("Failed to delete knowledge document")}},e6=async()=>{try{let e=await fetch("/api/aloa-projects/".concat(q.projectId,"/stakeholders")),t=await e.json();eH(t.stakeholders||[])}catch(e){console.error("Error fetching stakeholders:",e)}},e3=async e=>{try{let t=eY?"/api/aloa-projects/".concat(q.projectId,"/stakeholders?stakeholderId=").concat(eY.id):"/api/aloa-projects/".concat(q.projectId,"/stakeholders");(await fetch(t,{method:eY?"PATCH":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok&&(J.ZP.success(eY?"Stakeholder updated":"Stakeholder added"),e6(),eW(!1),eQ(null))}catch(e){console.error("Error saving stakeholder:",e),J.ZP.error("Failed to save stakeholder")}},e5=async e=>{if(confirm("Are you sure you want to delete this stakeholder?"))try{(await fetch("/api/aloa-projects/".concat(q.projectId,"/stakeholders?stakeholderId=").concat(e),{method:"DELETE"})).ok&&(J.ZP.success("Stakeholder deleted"),e6())}catch(e){console.error("Error deleting stakeholder:",e),J.ZP.error("Failed to delete stakeholder")}},e7=async()=>{try{let e=await fetch("/api/aloa-forms?project=".concat(q.projectId)),t=await e.json();en(t||[]),ei(t||[])}catch(e){console.error("Error fetching project forms:",e)}},e8=async function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=!1!==t,r=a?"close":"reopen";if(confirm("Are you sure you want to ".concat(r," this form?")))try{if((await fetch("/api/aloa-forms/".concat(e,"/toggle-status"),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({is_active:!a})})).ok){if(s){let t=await fetch("/api/aloa-responses?formId=".concat(e));(t.ok?await t.json():[]).length>0&&await fetch("/api/aloa-applets/".concat(s),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:a?"completed":"in_progress",completion_percentage:a?100:50,...a?{completed_at:new Date().toISOString()}:{completed_at:null}})})}await e7(),X.forEach(e=>{ts(e.id)});let t=document.createElement("div");t.className="fixed bottom-4 right-4 ".concat("close"===r?"bg-orange-600":"bg-green-600"," text-white px-4 py-2 rounded-lg shadow-lg z-50"),t.textContent="Form ".concat("close"===r?"closed":"reopened"," successfully"),document.body.appendChild(t),setTimeout(()=>t.remove(),3e3)}else throw Error("Failed to toggle form status")}catch(t){console.error("Error toggling form status:",t);let e=document.createElement("div");e.className="fixed bottom-4 right-4 bg-red-600 text-white px-4 py-2 rounded-lg shadow-lg z-50",e.textContent="Failed to ".concat(r," form"),document.body.appendChild(e),setTimeout(()=>e.remove(),3e3)}},e9=async()=>{try{let e=await fetch("/api/aloa-projects/".concat(q.projectId)),t=await e.json();Q(t);let s=await fetch("/api/aloa-projects/".concat(q.projectId,"/projectlets")),a=await s.json();$(a.projectlets),a.projectlets&&a.projectlets.forEach(e=>{ts(e.id)});let r=await fetch("/api/aloa-projects/".concat(q.projectId,"/team")),l=await r.json();l.team&&el(l.team),await e7()}catch(e){console.error("Error fetching project data:",e)}finally{et(!1)}},te=async()=>{if(ep)try{(await fetch("/api/aloa-projects/".concat(q.projectId,"/projectlets"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectletId:ep.id,name:ep.name,description:ep.description,type:ep.type,formId:ep.formId,deadline:ep.deadline,metadata:ep.metadata})})).ok&&(em(!1),eu(null),e9())}catch(e){console.error("Error saving projectlet:",e)}},tt=e=>{var t,s;eu({...e,formId:(null===(s=e.aloa_project_forms)||void 0===s?void 0:null===(t=s[0])||void 0===t?void 0:t.form_id)||null}),em(!0)},ts=async e=>{try{eC(t=>({...t,[e]:!0}));let s=await fetch("/api/aloa-projects/".concat(q.projectId,"/projectlets/").concat(e,"/applets"));if(s.ok){var t;let a=await s.json();console.log("Fetched ".concat((null===(t=a.applets)||void 0===t?void 0:t.length)||0," applets for projectlet ").concat(e,":"),a.applets),ew(t=>({...t,[e]:a.applets||[]}))}else console.error("Failed to fetch applets:",s.status)}catch(e){console.error("Error fetching applets:",e)}finally{eC(t=>({...t,[e]:!1}))}},ta=e=>{eR(e),eL(!0)},tr=async(e,t)=>{try{(await fetch("/api/aloa-projects/".concat(q.projectId,"/projectlets"),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectletId:e,status:t})})).ok&&e9()}catch(e){console.error("Error updating projectlet:",e)}},tl=e=>{eD(e.id),eZ(e.name)},to=async e=>{try{(await fetch("/api/aloa-projects/".concat(q.projectId,"/projectlets"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectletId:e,name:eI})})).ok&&(eD(null),e9(),J.ZP.success("Name updated"))}catch(e){console.error("Error updating name:",e),J.ZP.error("Failed to update name")}},tn=async e=>{if(confirm("Are you sure you want to delete this entire projectlet? This will also delete all applets within it."))try{(await fetch("/api/aloa-projects/".concat(q.projectId,"/projectlets?projectletId=").concat(e),{method:"DELETE"})).ok&&(J.ZP.success("Projectlet deleted"),e9(),eF(null))}catch(e){console.error("Error deleting projectlet:",e),J.ZP.error("Failed to delete projectlet")}},tc=async e=>{try{(await fetch("/api/aloa-projects/".concat(q.projectId,"/projectlets"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:"".concat(e.name," (Copy)"),description:e.description,type:e.type,metadata:e.metadata})})).ok&&(J.ZP.success("Projectlet duplicated"),e9(),eF(null))}catch(e){console.error("Error duplicating projectlet:",e),J.ZP.error("Failed to duplicate projectlet")}},ti=async()=>{try{let e=await fetch("/api/aloa-projects/".concat(q.projectId,"/projectlets"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:"New Projectlet",description:"Click to edit description",type:"design"})});if(e.ok){let{projectlet:t}=await e.json();$([...X,t]),ew(e=>({...e,[t.id]:[]}))}}catch(e){console.error("Error creating projectlet:",e)}},td=(e,t,s)=>{e.dataTransfer.getData("isApplet")||(eE({projectlet:t,index:s}),e.dataTransfer.effectAllowed="move")},tm=e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"},tp=async(e,t)=>{if(e.preventDefault(),e.dataTransfer.getData("isApplet")||!eS||eS.index===t)return;let s=[...X],[a]=s.splice(eS.index,1);s.splice(t,0,a),$(s),eE(null);try{s.map((e,t)=>({id:e.id,order_index:t})),J.ZP.success("Order updated")}catch(e){console.error("Error updating order:",e),e9()}},tu=e=>({locked:"bg-gray-100 text-gray-600 border-gray-300",available:"bg-blue-50 text-blue-700 border-blue-300",in_progress:"bg-yellow-50 text-yellow-700 border-yellow-300",client_review:"bg-purple-50 text-purple-700 border-purple-300",revision_requested:"bg-orange-50 text-orange-700 border-orange-300",completed:"bg-green-50 text-green-700 border-green-300"})[e]||"bg-gray-100 text-gray-600";return ee?(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-b from-[#faf8f3] to-[#f5f1e8] flex items-center justify-center",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-black"})}):(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-b from-[#faf8f3] to-[#f5f1e8]",children:[(0,a.jsx)("div",{className:"bg-black text-white",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 py-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("button",{onClick:()=>W.push("/admin/projects"),className:"mr-4 hover:bg-white/10 p-2 rounded-lg transition-colors",children:(0,a.jsx)(m.Z,{className:"w-6 h-6"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:null==Y?void 0:Y.project_name}),(0,a.jsx)("p",{className:"text-gray-300",children:"Admin Management View"})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(z,{projectId:q.projectId}),(0,a.jsx)("button",{onClick:()=>W.push("/project/".concat(q.projectId,"/dashboard")),className:"bg-white/10 text-white px-4 py-2 rounded-lg hover:bg-white/20 transition-colors",children:"View as Client"}),(0,a.jsx)("button",{className:"bg-white text-black px-4 py-2 rounded-lg hover:bg-gray-100 transition-colors",children:"Edit Project"})]})]})})}),(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6 mb-8",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(p.Z,{className:"w-6 h-6 mr-2 text-purple-600"}),(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"Project Knowledge Base"})]}),(0,a.jsxs)("button",{onClick:()=>eb(!0),className:"bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 flex items-center",children:[(0,a.jsx)(u.Z,{className:"w-4 h-4 mr-2"}),"Upload Document"]})]}),eg&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[(0,a.jsx)(x.Z,{className:"inline w-4 h-4 mr-1"}),"Existing Website URL"]}),(0,a.jsx)("input",{type:"url",value:(null===(e=eg.project)||void 0===e?void 0:e.existing_url)||"",onChange:e=>e2("existing_url",e.target.value),placeholder:"https://example.com",className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[(0,a.jsx)(h.Z,{className:"inline w-4 h-4 mr-1"}),"Google Drive Assets URL"]}),(0,a.jsx)("input",{type:"url",value:(null===(t=eg.project)||void 0===t?void 0:t.google_drive_url)||"",onChange:e=>e2("google_drive_url",e.target.value),placeholder:"https://drive.google.com/...",className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"})]})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[(0,a.jsx)(g.Z,{className:"inline w-4 h-4 mr-1"}),"Base Knowledge (Key Information)"]}),(0,a.jsx)("textarea",{value:(null===(o=eg.project)||void 0===o?void 0:null===(s=o.base_knowledge)||void 0===s?void 0:s.notes)||"",onChange:e=>e2("base_knowledge",{notes:e.target.value}),placeholder:"Enter key information about this project: brand guidelines, target audience, business goals, etc.",rows:4,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),eg.knowledge&&eg.knowledge.length>0&&(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold mb-3",children:["Knowledge Documents (",eg.knowledge.length,")"]}),(0,a.jsx)("div",{className:"space-y-2",children:eg.knowledge.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center flex-1",children:[(0,a.jsx)(j.Z,{className:"w-4 h-4 mr-2 text-gray-600"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:e.title}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["Type: ",e.type," • Importance: ",e.importance,"/10"]})]})]}),(0,a.jsx)("button",{onClick:()=>e4(e.id),className:"text-red-600 hover:text-red-800 p-2",children:(0,a.jsx)(f.Z,{className:"w-4 h-4"})})]},e.id))})]}),eg.insights&&eg.insights.length>0&&(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold mb-3",children:["AI Insights (",eg.insights.length,")"]}),(0,a.jsx)("div",{className:"space-y-2",children:eg.insights.map(e=>(0,a.jsx)("div",{className:"p-3 bg-purple-50 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-xs font-medium text-purple-600 uppercase",children:e.category}),(0,a.jsx)("p",{className:"text-sm mt-1",children:e.insight})]}),(0,a.jsxs)("span",{className:"text-xs text-gray-500",children:[Math.round(100*e.confidence),"% confidence"]})]})},e.id))})]}),eg.stats&&(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-4 p-4 bg-gray-50 rounded-lg",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-2xl font-bold text-purple-600",children:eg.stats.totalDocuments}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Documents"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-2xl font-bold text-purple-600",children:eg.stats.totalInsights}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Insights"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Last Updated"}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:eg.stats.lastUpdated?new Date(eg.stats.lastUpdated).toLocaleString():"Never"})]})]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6 mb-8",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(b.Z,{className:"w-6 h-6 mr-2 text-purple-600"}),(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"Client Stakeholders"})]}),(0,a.jsxs)("button",{onClick:()=>{eQ(null),eW(!0)},className:"bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 flex items-center",children:[(0,a.jsx)(y.Z,{className:"w-4 h-4 mr-2"}),"Add Stakeholder"]})]}),eM.length>0?(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:eM.map(e=>(0,a.jsxs)("div",{className:"border rounded-lg p-4 hover:shadow-md transition-shadow",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,a.jsxs)("div",{className:"flex-1",children:[e.is_primary&&(0,a.jsx)("span",{className:"inline-block px-2 py-1 text-xs font-semibold text-purple-800 bg-purple-100 rounded-full mb-2",children:"Primary Contact"}),(0,a.jsx)("h3",{className:"font-bold text-lg",children:e.name}),e.title&&(0,a.jsx)("p",{className:"text-sm text-gray-600",children:e.title}),e.role&&(0,a.jsxs)("p",{className:"text-xs text-gray-500 capitalize mt-1",children:["Role: ",e.role.replace("_"," ")]})]}),(0,a.jsxs)("div",{className:"flex space-x-1",children:[(0,a.jsx)("button",{onClick:()=>{eQ(e),eW(!0)},className:"text-gray-600 hover:text-purple-600 p-1",children:(0,a.jsx)(v.Z,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:()=>e5(e.id),className:"text-gray-600 hover:text-red-600 p-1",children:(0,a.jsx)(f.Z,{className:"w-4 h-4"})})]})]}),e.email&&(0,a.jsxs)("p",{className:"text-sm text-gray-600 mb-1",children:[(0,a.jsx)(N.Z,{className:"inline w-3 h-3 mr-1"}),e.email]}),e.bio&&(0,a.jsx)("p",{className:"text-sm text-gray-700 mt-2 line-clamp-3",children:e.bio}),e.importance&&(0,a.jsx)("div",{className:"mt-2",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"text-xs text-gray-500 mr-2",children:"Importance:"}),(0,a.jsx)("div",{className:"flex",children:[...Array(10)].map((t,s)=>(0,a.jsx)(w.Z,{className:"w-3 h-3 ".concat(s<e.importance?"text-yellow-400 fill-current":"text-gray-300")},s))})]})})]},e.id))}):(0,a.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,a.jsx)(b.Z,{className:"w-12 h-12 mx-auto mb-3 text-gray-400"}),(0,a.jsx)("p",{children:"No stakeholders added yet"}),(0,a.jsx)("p",{className:"text-sm mt-1",children:"Add stakeholders to help AI understand your client better"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,a.jsx)("div",{className:"lg:col-span-2",children:(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold",children:"Projectlets Management"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{onClick:()=>{let e=[];if(X.forEach(t=>{(eN[t.id]||[]).forEach(t=>e.push(t.id))}),e.length>0&&e.every(e=>eX[e]))e$({});else{let t={};e.forEach(e=>t[e]=!0),e$(t)}},className:"px-3 py-2 text-sm border rounded-lg hover:bg-gray-50 flex items-center",title:"Expand/Collapse All Applets",children:(()=>{let e=[];return X.forEach(t=>{(eN[t.id]||[]).forEach(t=>e.push(t.id))}),e.length>0&&e.every(e=>eX[e])?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(k.Z,{className:"w-4 h-4 mr-1"}),"Collapse All"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(C.Z,{className:"w-4 h-4 mr-1"}),"Expand All"]})})()}),(0,a.jsxs)("button",{onClick:ti,className:"bg-black text-white px-4 py-2 rounded-lg hover:bg-gray-800 flex items-center",children:[(0,a.jsx)(y.Z,{className:"w-4 h-4 mr-2"}),"Add Projectlet"]})]})]}),(0,a.jsx)("div",{className:"space-y-4",children:X.map((e,t)=>{let s=eN[e.id]||[],r=ek[e.id],l=e_===e.id,o={form:_.Z,review:D.Z,upload:u.Z,signoff:d.Z,moodboard:I.Z,content_gather:Z.Z};return(0,a.jsxs)("div",{className:"border-2 rounded-lg ".concat(tu(e.status)," transition-all hover:shadow-lg"),draggable:!0,onDragStart:s=>td(s,e,t),onDragOver:tm,onDrop:e=>tp(e,t),children:[(0,a.jsx)("div",{className:"p-4 pb-0",children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex items-start flex-1",children:[(0,a.jsx)("div",{className:"mr-3 mt-1 cursor-move opacity-50 hover:opacity-100",children:(0,a.jsx)(S.Z,{className:"w-5 h-5"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center mb-2 group",children:[(0,a.jsxs)("span",{className:"text-sm font-medium text-gray-500 mr-3",children:["#",t+1]}),l?(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("input",{type:"text",value:eI,onChange:e=>eZ(e.target.value),onKeyDown:t=>{"Enter"===t.key&&to(e.id),"Escape"===t.key&&eD(null)},className:"font-bold text-lg px-2 py-1 border rounded",autoFocus:!0}),(0,a.jsx)("button",{onClick:()=>to(e.id),className:"p-1 hover:bg-green-100 rounded",children:(0,a.jsx)(d.Z,{className:"w-4 h-4 text-green-600"})}),(0,a.jsx)("button",{onClick:()=>eD(null),className:"p-1 hover:bg-red-100 rounded",children:(0,a.jsx)(E.Z,{className:"w-4 h-4 text-red-600"})})]}):(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("h3",{className:"font-bold text-lg",children:e.name}),(0,a.jsx)("button",{onClick:()=>tl(e),className:"ml-2 p-1 opacity-0 group-hover:opacity-100 hover:bg-gray-200 rounded transition-opacity",children:(0,a.jsx)(T.Z,{className:"w-4 h-4"})})]})]}),e.description&&(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:e.description}),(0,a.jsxs)("div",{className:"flex items-center space-x-4 text-sm",children:[e.deadline&&(0,a.jsxs)("span",{className:"flex items-center text-gray-600",children:[(0,a.jsx)(P.Z,{className:"w-4 h-4 mr-1"}),new Date(e.deadline).toLocaleDateString()]}),(0,a.jsxs)("span",{className:"text-xs bg-gray-100 px-2 py-1 rounded",children:[s.length," applet",1!==s.length?"s":""]})]})]})]}),(0,a.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,a.jsxs)("select",{value:e.status,onChange:t=>tr(e.id,t.target.value),className:"px-3 py-1 border rounded-lg text-sm font-medium ".concat(tu(e.status)),children:[(0,a.jsx)("option",{value:"locked",children:"\uD83D\uDD12 Locked"}),(0,a.jsx)("option",{value:"available",children:"✅ Available"}),(0,a.jsx)("option",{value:"in_progress",children:"⏳ In Progress"}),(0,a.jsx)("option",{value:"client_review",children:"\uD83D\uDC41 Review"}),(0,a.jsx)("option",{value:"revision_requested",children:"\uD83D\uDD04 Revision"}),(0,a.jsx)("option",{value:"completed",children:"✓ Completed"})]}),(0,a.jsxs)("div",{className:"relative action-menu-container",children:[(0,a.jsx)("button",{onClick:()=>eF(eA===e.id?null:e.id),className:"p-1 hover:bg-white/50 rounded",title:"More actions",children:(0,a.jsx)(A.Z,{className:"w-5 h-5"})}),eA===e.id&&(0,a.jsxs)("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border z-10",children:[(0,a.jsxs)("button",{onClick:()=>{tt(e),eF(null)},className:"w-full px-4 py-2 text-left hover:bg-gray-100 flex items-center",children:[(0,a.jsx)(F.Z,{className:"w-4 h-4 mr-2"}),"Edit Details"]}),(0,a.jsxs)("button",{onClick:()=>tc(e),className:"w-full px-4 py-2 text-left hover:bg-gray-100 flex items-center",children:[(0,a.jsx)(O.Z,{className:"w-4 h-4 mr-2"}),"Duplicate"]}),(0,a.jsx)("hr",{className:"my-1"}),(0,a.jsxs)("button",{onClick:()=>tn(e.id),className:"w-full px-4 py-2 text-left hover:bg-red-50 text-red-600 flex items-center",children:[(0,a.jsx)(f.Z,{className:"w-4 h-4 mr-2"}),"Delete Projectlet"]})]})]})]})]})}),(0,a.jsxs)("div",{className:"p-4 pt-2",children:[r?(0,a.jsx)("div",{className:"py-4 text-center",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-gray-600 mx-auto"})}):s.length>0?(0,a.jsxs)("div",{className:"space-y-2",children:[s.map((t,r)=>{var l,n,d,m,p,u,x;let h=o[t.type]||_.Z,g=t.form_id||(null===(l=t.config)||void 0===l?void 0:l.form_id),j=g?eo.find(e=>e.id===g):null,y=(null==j?void 0:j.status)==="closed";return(0,a.jsxs)("div",{className:"p-2 rounded cursor-move transition-colors group border-2 ".concat(y&&"form"===t.type?"bg-red-50 border-red-300 hover:bg-red-100":"bg-white/50 border-transparent hover:bg-white/70"),draggable:!0,onDragStart:s=>{s.stopPropagation(),eP(!0),s.dataTransfer.effectAllowed="move",s.dataTransfer.setData("appletId",t.id),s.dataTransfer.setData("appletIndex",r),s.dataTransfer.setData("projectletId",e.id),s.dataTransfer.setData("isApplet","true")},onDragEnd:()=>{eP(!1)},onDragOver:e=>{e.preventDefault(),e.stopPropagation(),e.currentTarget.style.backgroundColor="#DBEAFE",e.currentTarget.style.borderColor="#3B82F6"},onDragLeave:e=>{e.currentTarget.style.backgroundColor="",e.currentTarget.style.borderColor=""},onDrop:async t=>{if(t.preventDefault(),t.stopPropagation(),t.currentTarget.style.backgroundColor="",t.currentTarget.style.borderColor="",!t.dataTransfer.getData("isApplet"))return;let a=t.dataTransfer.getData("appletId"),l=parseInt(t.dataTransfer.getData("appletIndex")),o=t.dataTransfer.getData("projectletId");if(o===e.id){if(l!==r){let t=[...s],[a]=t.splice(l,1);t.splice(r,0,a);try{await fetch("/api/aloa-projects/".concat(q.projectId,"/projectlets/").concat(e.id,"/applets/reorder"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({appletIds:t.map(e=>e.id)})}),ts(e.id)}catch(e){console.error("Error reordering applets:",e)}}}else try{(await fetch("/api/aloa-projects/".concat(q.projectId,"/projectlets/").concat(o,"/applets/").concat(a),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectlet_id:e.id,order_index:r})})).ok&&(ts(o),ts(e.id),J.ZP.success("Applet moved successfully"))}catch(e){console.error("Error moving applet:",e),J.ZP.error("Failed to move applet")}},children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(S.Z,{className:"w-4 h-4 text-gray-400"}),(0,a.jsx)(h,{className:"w-4 h-4 text-gray-600"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:t.name}),t.status&&(0,a.jsx)("span",{className:"text-xs px-2 py-0.5 rounded ".concat(tu(t.status)),children:t.status}),y&&"form"===t.type&&(0,a.jsx)("span",{className:"text-xs px-2 py-0.5 bg-red-600 text-white rounded font-semibold uppercase",children:"\uD83D\uDD12 LOCKED"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[t.completion_percentage>0&&(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"w-16 bg-gray-200 rounded-full h-1.5",children:(0,a.jsx)("div",{className:"bg-green-600 h-1.5 rounded-full",style:{width:"".concat(t.completion_percentage,"%")}})}),(0,a.jsxs)("span",{className:"text-xs ml-2 text-gray-500",children:[t.completion_percentage,"%"]})]}),(0,a.jsx)("div",{className:"flex items-center space-x-1 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,a.jsx)("button",{onClick:async s=>{if(s.stopPropagation(),confirm('Delete applet "'.concat(t.name,'"?')))try{(await fetch("/api/aloa-projects/".concat(q.projectId,"/projectlets/").concat(e.id,"/applets/").concat(t.id),{method:"DELETE"})).ok&&ts(e.id)}catch(e){console.error("Error deleting applet:",e)}},className:"p-1 hover:bg-red-100 rounded",title:"Delete applet",children:(0,a.jsx)(f.Z,{className:"w-3 h-3 text-red-600"})})}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),e$(e=>({...e,[t.id]:!e[t.id]}))},className:"p-1 hover:bg-gray-200 rounded ml-2",title:eX[t.id]?"Collapse":"Expand",children:eX[t.id]?(0,a.jsx)(k.Z,{className:"w-4 h-4"}):(0,a.jsx)(C.Z,{className:"w-4 h-4"})})]})]}),eX[t.id]&&"form"===t.type&&(0,a.jsxs)("div",{className:"mt-2",children:[y&&(0,a.jsx)("div",{className:"mb-2 p-2 bg-red-100 border border-red-300 rounded text-xs text-red-700 font-medium",children:"⚠️ This form is locked and not accepting new responses"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsxs)("select",{value:t.form_id||(null===(n=t.config)||void 0===n?void 0:n.form_id)||"",onChange:async s=>{if("create_new"===s.target.value)ez(!0),eK({projectletId:e.id,projectletName:e.name});else try{(await fetch("/api/aloa-projects/".concat(q.projectId,"/projectlets/").concat(e.id,"/applets/").concat(t.id),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({form_id:s.target.value,config:{...t.config,form_id:s.target.value}})})).ok&&ts(e.id)}catch(e){console.error("Error updating applet:",e)}},className:"flex-1 max-w-xs text-sm px-2 py-1 border rounded bg-white",children:[(0,a.jsx)("option",{value:"",children:"Select a form..."}),(0,a.jsx)("option",{value:"create_new",children:"✨ Create New Form with AI"}),eo.map(e=>(0,a.jsx)("option",{value:e.id,children:e.title},e.id))]}),(t.form_id||(null===(d=t.config)||void 0===d?void 0:d.form_id))&&(0,a.jsx)("div",{className:"flex items-center space-x-1",children:(()=>{var e;let s=t.form_id||(null===(e=t.config)||void 0===e?void 0:e.form_id),r=eo.find(e=>e.id===s);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>e8(s,(null==r?void 0:r.status)!=="closed",t.id),className:"p-1 rounded transition-colors ".concat((null==r?void 0:r.status)==="closed"?"hover:bg-green-200 text-green-600":"hover:bg-orange-200 text-orange-600"),title:(null==r?void 0:r.status)==="closed"?"Reopen Form":"Close Form",children:(null==r?void 0:r.status)==="closed"?(0,a.jsx)(i.Z,{className:"w-4 h-4"}):(0,a.jsx)(c.Z,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:()=>{((null==r?void 0:r.urlId)||(null==r?void 0:r.url_id))&&window.open("/forms/".concat(r.urlId||r.url_id),"_blank")},className:"p-1 hover:bg-gray-200 rounded transition-colors",title:"View Form",children:(0,a.jsx)(L.Z,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:()=>W.push("/edit/".concat(s)),className:"p-1 hover:bg-gray-200 rounded transition-colors",title:"Edit Form",children:(0,a.jsx)(v.Z,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:()=>W.push("/responses/".concat(s)),className:"p-1 hover:bg-gray-200 rounded transition-colors",title:"View Responses",children:(0,a.jsx)(U.Z,{className:"w-4 h-4"})})]})})()})]}),(t.form_id||(null===(m=t.config)||void 0===m?void 0:m.form_id))&&(()=>{var e,s;let r=t.form_id||(null===(e=t.config)||void 0===e?void 0:e.form_id),l=eo.find(e=>e.id===r);return l?(0,a.jsxs)("div",{className:"flex items-center gap-4 mt-2 pl-2 text-xs text-gray-600",children:[(0,a.jsxs)("span",{className:"flex items-center gap-1",children:[(0,a.jsx)(_.Z,{className:"w-3 h-3"}),(null===(s=l.fields)||void 0===s?void 0:s.length)||0," FIELDS"]}),(0,a.jsxs)("span",{className:"flex items-center gap-1",children:[(0,a.jsx)(b.Z,{className:"w-3 h-3"}),l.responseCount||l.response_count||0," RESPONSES"]}),l.createdAt&&(0,a.jsxs)("span",{className:"flex items-center gap-1",children:[(0,a.jsx)(P.Z,{className:"w-3 h-3"}),new Date(l.createdAt).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}).toUpperCase()]})]}):null})()]}),eX[t.id]&&("link_submission"===t.type||"Link Submission"===t.name||(null===(p=t.description)||void 0===p?void 0:p.includes("Share deliverables and resources")))&&(0,a.jsx)(K,{applet:t,projectId:q.projectId,projectletId:e.id,onUpdate:()=>ts(e.id)}),eX[t.id]&&("upload"===t.type||"file_upload"===t.type||(null===(u=t.name)||void 0===u?void 0:u.includes("Upload"))||(null===(x=t.description)||void 0===x?void 0:x.includes("upload")))&&(0,a.jsx)(M,{applet:t,projectId:q.projectId,projectletId:e.id,onClose:()=>e$(e=>({...e,[t.id]:!1}))})]},t.id)}),(0,a.jsx)("div",{className:"py-3 border-2 border-dashed rounded-lg transition-all ".concat(eT?"border-gray-300 hover:border-blue-400 hover:bg-blue-50/50":"border-transparent"),onDragOver:e=>{e.preventDefault(),e.stopPropagation(),e.currentTarget.style.borderColor="#3B82F6",e.currentTarget.style.backgroundColor="#DBEAFE"},onDragLeave:e=>{e.currentTarget.style.borderColor="",e.currentTarget.style.backgroundColor=""},onDrop:async t=>{if(t.preventDefault(),t.stopPropagation(),t.currentTarget.style.borderColor="",t.currentTarget.style.backgroundColor="",!t.dataTransfer.getData("isApplet"))return;let a=t.dataTransfer.getData("appletId"),r=t.dataTransfer.getData("projectletId");if(r!==e.id)try{(await fetch("/api/aloa-projects/".concat(q.projectId,"/projectlets/").concat(r,"/applets/").concat(a),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectlet_id:e.id,order_index:s.length})})).ok&&(ts(r),ts(e.id),J.ZP.success("Applet moved successfully"))}catch(e){console.error("Error moving applet:",e),J.ZP.error("Failed to move applet")}},children:eT&&(0,a.jsx)("p",{className:"text-xs text-gray-500 text-center font-medium",children:"Drop applet here"})})]}):(0,a.jsxs)("div",{className:"text-center border-2 border-dashed rounded-lg bg-white/30 transition-all ".concat(eT?"py-6 border-gray-300 hover:border-blue-400":"py-4 border-gray-200"),onDragOver:e=>{e.preventDefault(),e.stopPropagation(),e.currentTarget.style.borderColor="#3B82F6",e.currentTarget.style.backgroundColor="#DBEAFE"},onDragLeave:e=>{e.currentTarget.style.borderColor="",e.currentTarget.style.backgroundColor=""},onDrop:async t=>{if(t.preventDefault(),t.stopPropagation(),t.currentTarget.style.borderColor="",t.currentTarget.style.backgroundColor="",!t.dataTransfer.getData("isApplet"))return;let s=t.dataTransfer.getData("appletId"),a=t.dataTransfer.getData("projectletId");if(a)try{(await fetch("/api/aloa-projects/".concat(q.projectId,"/projectlets/").concat(a,"/applets/").concat(s),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectlet_id:e.id,order_index:0})})).ok&&(ts(a),ts(e.id),J.ZP.success("Applet moved successfully"))}catch(e){console.error("Error moving applet:",e),J.ZP.error("Failed to move applet")}},children:[(0,a.jsx)("p",{className:"text-sm text-gray-500 mb-2",children:eT?"Drop applet here":"No applets added yet"}),(0,a.jsxs)("button",{onClick:()=>ta(e),className:"inline-flex items-center px-3 py-1 bg-black text-white rounded-lg hover:bg-gray-800 text-sm",children:[(0,a.jsx)(y.Z,{className:"w-3 h-3 mr-1"}),"Add First Applet"]})]}),s.length>0&&(0,a.jsxs)("button",{onClick:()=>ta(e),className:"mt-2 w-full py-2 border-2 border-dashed border-gray-400 rounded-lg hover:border-black hover:bg-white/50 transition-all flex items-center justify-center text-sm text-gray-600 hover:text-black",children:[(0,a.jsx)(y.Z,{className:"w-4 h-4 mr-1"}),"Add Applet"]})]})]},e.id)})})]})}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[(0,a.jsx)("h3",{className:"font-bold mb-4",children:"Project Information"}),(0,a.jsxs)("div",{className:"space-y-3 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Client:"}),(0,a.jsx)("div",{className:"font-medium",children:null==Y?void 0:Y.client_name}),(0,a.jsx)("div",{className:"text-gray-600",children:null==Y?void 0:Y.client_email})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Status:"}),(0,a.jsx)("div",{className:"font-medium capitalize",children:null==Y?void 0:Y.status.replace(/_/g," ")})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Timeline:"}),(0,a.jsxs)("div",{className:"font-medium",children:[(null==Y?void 0:Y.start_date)&&new Date(Y.start_date).toLocaleDateString()," - ",(null==Y?void 0:Y.estimated_completion_date)&&new Date(Y.estimated_completion_date).toLocaleDateString()]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Scope:"}),(0,a.jsxs)("div",{className:"font-medium",children:[null==Y?void 0:null===(n=Y.rules)||void 0===n?void 0:n.main_pages," main pages, ",null==Y?void 0:null===(H=Y.rules)||void 0===H?void 0:H.aux_pages," aux pages"]})]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h3",{className:"font-bold",children:"Team Members"}),(0,a.jsx)("button",{className:"text-black hover:bg-gray-100 p-1 rounded",children:(0,a.jsx)(y.Z,{className:"w-4 h-4"})})]}),(0,a.jsx)("div",{className:"space-y-3",children:er.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-sm",children:e.name||e.email}),(0,a.jsx)("div",{className:"text-xs text-gray-600 capitalize",children:e.role})]}),(0,a.jsx)("button",{className:"text-gray-400 hover:text-red-600",children:(0,a.jsx)(E.Z,{className:"w-4 h-4"})})]},e.id))})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h3",{className:"font-bold",children:"Project Forms"}),(0,a.jsxs)("span",{className:"text-sm bg-gray-100 px-2 py-1 rounded",children:[ec.length," forms"]})]}),(0,a.jsx)("div",{className:"space-y-2 mb-4",children:0===ec.length?(0,a.jsx)("p",{className:"text-sm text-gray-500 text-center py-4",children:"No forms created for this project yet"}):ec.slice(0,5).map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"text-sm font-medium truncate",children:e.title}),(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:[e.response_count||0," responses • ",e.status]})]}),(0,a.jsxs)("div",{className:"flex space-x-1",children:[(0,a.jsx)("button",{onClick:()=>window.open("/forms/".concat(e.urlId||e.url_id),"_blank"),className:"p-1 hover:bg-gray-200 rounded",title:"View Form",children:(0,a.jsx)(D.Z,{className:"w-3 h-3"})}),(0,a.jsx)("button",{onClick:()=>window.open("/edit/".concat(e.id),"_blank"),className:"p-1 hover:bg-gray-200 rounded",title:"Edit Form",children:(0,a.jsx)(R.Z,{className:"w-3 h-3"})}),(0,a.jsx)("button",{onClick:async()=>{if(confirm('Are you sure you want to delete "'.concat(e.title,'"?')))try{let t=await fetch("/api/aloa-forms/".concat(e.id),{method:"DELETE"});if(t.ok)await t.json(),J.ZP.success("Form deleted successfully"),e7();else try{let e=await t.json();J.ZP.error(e.error||"Failed to delete form")}catch(e){J.ZP.error("Failed to delete form")}}catch(e){console.error("Error deleting form:",e),J.ZP.error("Failed to delete form")}},className:"p-1 hover:bg-red-100 rounded",title:"Delete Form",children:(0,a.jsx)(f.Z,{className:"w-3 h-3 text-red-600"})})]})]},e.id))}),(0,a.jsxs)("div",{className:"space-y-2 border-t pt-4",children:[(0,a.jsxs)("button",{onClick:()=>{ez(!0),eK({projectletId:null,projectletName:null})},className:"w-full bg-black text-white px-4 py-2 rounded-lg hover:bg-gray-800 flex items-center justify-center",children:[(0,a.jsx)(y.Z,{className:"w-4 h-4 mr-2"}),"Create New Form"]}),ec.length>5&&(0,a.jsxs)("button",{onClick:()=>eh(!0),className:"w-full text-sm text-gray-600 hover:text-black",children:["View all ",ec.length," forms →"]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[(0,a.jsx)("h3",{className:"font-bold mb-4",children:"Quick Actions"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("button",{className:"w-full text-left px-4 py-2 bg-gray-50 rounded-lg hover:bg-gray-100 flex items-center",children:[(0,a.jsx)(N.Z,{className:"w-4 h-4 mr-2"}),"Send Status Update"]}),(0,a.jsxs)("button",{className:"w-full text-left px-4 py-2 bg-gray-50 rounded-lg hover:bg-gray-100 flex items-center",children:[(0,a.jsx)(_.Z,{className:"w-4 h-4 mr-2"}),"Generate Report"]}),(0,a.jsxs)("button",{className:"w-full text-left px-4 py-2 bg-gray-50 rounded-lg hover:bg-gray-100 flex items-center",children:[(0,a.jsx)(u.Z,{className:"w-4 h-4 mr-2"}),"Upload Deliverables"]}),(0,a.jsxs)("button",{className:"w-full text-left px-4 py-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 flex items-center",children:[(0,a.jsx)(f.Z,{className:"w-4 h-4 mr-2"}),"Archive Project"]})]})]})]})]})]}),ed&&ep&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[(0,a.jsx)("div",{className:"p-6 border-b",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"Edit Projectlet"}),(0,a.jsx)("button",{onClick:()=>{em(!1),eu(null)},className:"p-2 hover:bg-gray-100 rounded-lg",children:(0,a.jsx)(E.Z,{className:"w-5 h-5"})})]})}),(0,a.jsxs)("div",{className:"p-6 space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Name"}),(0,a.jsx)("input",{type:"text",value:ep.name,onChange:e=>eu({...ep,name:e.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-black"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),(0,a.jsx)("textarea",{value:ep.description||"",onChange:e=>eu({...ep,description:e.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-black",rows:3})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Type"}),(0,a.jsxs)("select",{value:ep.type,onChange:e=>eu({...ep,type:e.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-black",children:[(0,a.jsx)("option",{value:"form",children:"Form"}),(0,a.jsx)("option",{value:"design",children:"Design"}),(0,a.jsx)("option",{value:"content",children:"Content"}),(0,a.jsx)("option",{value:"development",children:"Development"}),(0,a.jsx)("option",{value:"review",children:"Review"}),(0,a.jsx)("option",{value:"milestone",children:"Milestone"})]})]}),"form"===ep.type&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Attached Form"}),(0,a.jsxs)("select",{value:ep.formId||"",onChange:e=>eu({...ep,formId:e.target.value||null}),className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-black",children:[(0,a.jsx)("option",{value:"",children:"No form attached"}),eo.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.title," (",e.status,")"]},e.id))]}),(0,a.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"Attach an existing form or create a new one from the Forms Dashboard"}),(0,a.jsxs)("div",{className:"mt-2 flex space-x-2",children:[(0,a.jsx)("button",{onClick:()=>window.open("/create","_blank"),className:"text-sm bg-blue-100 text-blue-700 px-3 py-1 rounded-lg hover:bg-blue-200",children:"Create New Form"}),ep.formId&&(0,a.jsx)("button",{onClick:()=>window.open("/edit/".concat(ep.formId),"_blank"),className:"text-sm bg-green-100 text-green-700 px-3 py-1 rounded-lg hover:bg-green-200",children:"Edit Form"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Deadline (optional)"}),(0,a.jsx)("input",{type:"date",value:ep.deadline?ep.deadline.split("T")[0]:"",onChange:e=>eu({...ep,deadline:e.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-black"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Additional Metadata (JSON)"}),(0,a.jsx)("textarea",{value:JSON.stringify(ep.metadata||{},null,2),onChange:e=>{try{let t=JSON.parse(e.target.value);eu({...ep,metadata:t})}catch(e){}},className:"w-full px-4 py-2 border rounded-lg font-mono text-sm focus:outline-none focus:ring-2 focus:ring-black",rows:5})]}),(0,a.jsx)("div",{className:"border-t pt-6",children:(0,a.jsx)(V,{projectId:q.projectId,projectletId:ep.id,projectletName:ep.name,availableForms:eo})})]}),(0,a.jsxs)("div",{className:"p-6 border-t flex justify-end space-x-3",children:[(0,a.jsx)("button",{onClick:()=>{em(!1),eu(null)},className:"px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancel"}),(0,a.jsx)("button",{onClick:te,className:"px-6 py-2 bg-black text-white rounded-lg hover:bg-gray-800",children:"Save Changes"})]})]})}),ef&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h3",{className:"text-xl font-bold",children:"Upload Knowledge Document"}),(0,a.jsx)("button",{onClick:()=>eb(!1),className:"text-gray-500 hover:text-gray-700",children:(0,a.jsx)(E.Z,{className:"w-5 h-5"})})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-purple-600 cursor-pointer",onClick:()=>document.getElementById("knowledge-file-input").click(),children:[(0,a.jsx)(u.Z,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Click to upload a document"}),(0,a.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"PDF, DOC, TXT, or Markdown files"}),(0,a.jsx)("input",{id:"knowledge-file-input",type:"file",accept:".pdf,.doc,.docx,.txt,.md",className:"hidden",onChange:e=>{let t=e.target.files[0];t&&e1(t)}})]}),ey&&(0,a.jsxs)("div",{className:"text-center py-4",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-2",children:"Uploading document..."})]})]})]})}),eq&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h3",{className:"text-xl font-bold",children:eY?"Edit Stakeholder":"Add New Stakeholder"}),(0,a.jsx)("button",{onClick:()=>{eW(!1),eQ(null)},className:"text-gray-500 hover:text-gray-700",children:(0,a.jsx)(E.Z,{className:"w-6 h-6"})})]}),(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault();let t=new FormData(e.target);e3({name:t.get("name"),title:t.get("title"),role:t.get("role"),email:t.get("email"),phone:t.get("phone"),bio:t.get("bio"),responsibilities:t.get("responsibilities"),preferences:t.get("preferences"),linkedin_url:t.get("linkedin_url"),importance:parseInt(t.get("importance")),is_primary:"on"===t.get("is_primary")})},className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name *"}),(0,a.jsx)("input",{type:"text",name:"name",defaultValue:null==eY?void 0:eY.name,required:!0,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title"}),(0,a.jsx)("input",{type:"text",name:"title",defaultValue:null==eY?void 0:eY.title,placeholder:"e.g., CEO, Product Manager",className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Role"}),(0,a.jsxs)("select",{name:"role",defaultValue:(null==eY?void 0:eY.role)||"decision_maker",className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500",children:[(0,a.jsx)("option",{value:"decision_maker",children:"Decision Maker"}),(0,a.jsx)("option",{value:"influencer",children:"Influencer"}),(0,a.jsx)("option",{value:"end_user",children:"End User"}),(0,a.jsx)("option",{value:"technical_lead",children:"Technical Lead"}),(0,a.jsx)("option",{value:"sponsor",children:"Sponsor"}),(0,a.jsx)("option",{value:"consultant",children:"Consultant"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Importance (1-10)"}),(0,a.jsx)("input",{type:"number",name:"importance",min:"1",max:"10",defaultValue:(null==eY?void 0:eY.importance)||5,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),(0,a.jsx)("input",{type:"email",name:"email",defaultValue:null==eY?void 0:eY.email,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone"}),(0,a.jsx)("input",{type:"tel",name:"phone",defaultValue:null==eY?void 0:eY.phone,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"LinkedIn URL"}),(0,a.jsx)("input",{type:"url",name:"linkedin_url",defaultValue:null==eY?void 0:eY.linkedin_url,placeholder:"https://linkedin.com/in/...",className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bio / Background"}),(0,a.jsx)("textarea",{name:"bio",defaultValue:null==eY?void 0:eY.bio,rows:3,placeholder:"Brief background about this stakeholder...",className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Key Responsibilities"}),(0,a.jsx)("textarea",{name:"responsibilities",defaultValue:null==eY?void 0:eY.responsibilities,rows:2,placeholder:"What are their main responsibilities in this project?",className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Communication Preferences"}),(0,a.jsx)("textarea",{name:"preferences",defaultValue:null==eY?void 0:eY.preferences,rows:2,placeholder:"Preferred communication style, meeting times, etc.",className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",name:"is_primary",id:"is_primary",defaultChecked:null==eY?void 0:eY.is_primary,className:"mr-2"}),(0,a.jsx)("label",{htmlFor:"is_primary",className:"text-sm font-medium text-gray-700",children:"Set as primary contact"})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{eW(!1),eQ(null)},className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"Cancel"}),(0,a.jsxs)("button",{type:"submit",className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:[eY?"Update":"Add"," Stakeholder"]})]})]})]})}),eO&&eU&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[(0,a.jsx)("div",{className:"p-6 border-b",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("h2",{className:"text-2xl font-bold",children:["Choose Applet for ",eU.name]}),(0,a.jsx)("button",{onClick:()=>{eL(!1),eR(null),ts(eU.id)},className:"p-2 hover:bg-gray-100 rounded-lg",children:(0,a.jsx)(E.Z,{className:"w-6 h-6"})})]})}),(0,a.jsx)("div",{className:"p-6",children:(0,a.jsx)(V,{projectId:q.projectId,projectletId:eU.id,projectletName:eU.name,availableForms:eo,startWithLibraryOpen:!0,onAppletsUpdated:async()=>{eL(!1),await new Promise(e=>setTimeout(e,500)),await ts(eU.id),eR(null)}})})]})}),eB&&(0,a.jsx)(G,{isOpen:eB,onClose:()=>{ez(!1),eK(null)},projectId:q.projectId,projectName:null==Y?void 0:Y.project_name,projectKnowledge:eg,projectletId:null==eG?void 0:eG.projectletId,projectletName:null==eG?void 0:eG.projectletName,onFormCreated:e=>{e9(),(null==eG?void 0:eG.projectletId)&&ts(eG.projectletId)}}),eJ&&eU&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-xl w-full max-w-6xl max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)("div",{className:"p-6 border-b flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-bold",children:"Create Form with AI"}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:["For projectlet: ",eU.name]})]}),(0,a.jsx)("button",{onClick:()=>eV(!1),className:"p-2 hover:bg-gray-100 rounded-lg",children:(0,a.jsx)(E.Z,{className:"w-5 h-5"})})]}),(0,a.jsx)("div",{className:"p-6",children:(0,a.jsx)(B,{onMarkdownGenerated:async e=>{try{let t=new URLSearchParams({markdown:e,projectlet_id:eU.id,project_id:q.projectId});window.location.href="/create?".concat(t.toString())}catch(e){console.error("Error creating form:",e)}},projectContext:eg,projectName:null==Y?void 0:Y.name})})]})})]})}function q(){return(0,a.jsx)(n.Z,{allowedRoles:["super_admin","project_admin","team_member"],redirectTo:"/auth/login",children:(0,a.jsx)(H,{})})}},9537:function(e,t,s){"use strict";s.d(t,{Z:function(){return i}});var a=s(7437),r=s(2265),l=s(9376),o=s(1013),n=s(6337),c=s(9322);function i(e){let{children:t,allowedRoles:s=[],redirectTo:i="/auth/login",requireAuth:d=!0}=e,m=(0,l.useRouter)(),[p,u]=(0,r.useState)(!0),[x,h]=(0,r.useState)(!1),[g,j]=(0,r.useState)(null),[f,b]=(0,r.useState)(null);(0,r.useEffect)(()=>{y()},[]);let y=async()=>{try{let e=(0,o.e)(),{data:{user:t},error:a}=await e.auth.getUser();if(a||!t){d?(console.log("No authenticated user, redirecting to login"),m.push("".concat(i,"?message=Please login to continue"))):h(!0),u(!1);return}console.log("Fetching profile for user:",t.id,t.email);let r=await fetch("/api/auth/profile",{credentials:"include",headers:{"Content-Type":"application/json"}}),l=await r.json();if(console.log("Profile API response:",l),!r.ok||l.error){console.error("Error fetching user profile:",l.error),b("Unable to verify user permissions: "+(l.error||"Unknown error")),u(!1);return}if(!l.user||!l.user.role){console.error("No user role found in response"),b("User profile incomplete. Please contact support."),u(!1);return}let n=l.user.profile||{role:l.user.role};j(n.role),console.log("User role set to:",n.role),s.length>0?(console.log("Checking role access:",{userRole:n.role,allowedRoles:s,isIncluded:s.includes(n.role)}),s.includes(n.role)?(console.log("Access granted for role:",n.role),h(!0)):(console.log("User role ".concat(n.role," not in allowed roles:"),s),b("Access denied. This area is restricted to: ".concat(s.join(", "))),h(!1))):(console.log("No specific roles required, user is authenticated"),h(!0)),u(!1)}catch(e){console.error("Auth check error:",e),b("An error occurred while checking permissions"),u(!1)}};return p?(0,a.jsx)("div",{className:"min-h-screen bg-gradient-subtle flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Checking permissions..."})]})}):f||!x?(0,a.jsx)("div",{className:"min-h-screen bg-gradient-subtle flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"bg-white p-8 rounded-lg shadow-xl max-w-md w-full",children:[(0,a.jsx)("div",{className:"flex justify-center mb-6",children:(0,a.jsx)("div",{className:"p-4 bg-red-100 rounded-full",children:(0,a.jsx)(n.Z,{className:"w-8 h-8 text-red-600"})})}),(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900 text-center mb-2",children:"Access Restricted"}),(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:(0,a.jsxs)("div",{className:"flex items-start",children:[(0,a.jsx)(c.Z,{className:"w-5 h-5 text-red-600 mt-0.5 mr-2 flex-shrink-0"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-red-800 text-sm",children:f||"You do not have permission to access this page."}),g&&(0,a.jsxs)("p",{className:"text-red-600 text-xs mt-1",children:["Your role: ",(0,a.jsx)("span",{className:"font-semibold",children:g})]})]})]})}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("button",{onClick:()=>m.back(),className:"w-full px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:"Go Back"}),(0,a.jsx)("button",{onClick:()=>m.push("/dashboard"),className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Go to Dashboard"})]})]})}):t}},1013:function(e,t,s){"use strict";s.d(t,{e:function(){return l}});var a=s(2990);let r=null;function l(){if(r)return r;let e="https://eycgzjqwowrdmjlzqqyg.supabase.co",t="sb_publishable_eG0lH_ACpyOjqG44mN_5PA_1-oFLr5n";if(console.log("Creating Supabase browser client with:",{url:e,keyPrefix:t?t.substring(0,20)+"...":"NO KEY"}),!e||!t)throw console.error("Missing Supabase environment variables"),Error("Supabase configuration is missing");return r=(0,a.createBrowserClient)(e,t)}}},function(e){e.O(0,[346,64,584,971,117,744],function(){return e(e.s=6558)}),_N_E=e.O()}]);