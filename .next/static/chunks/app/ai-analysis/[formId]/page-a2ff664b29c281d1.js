(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[806],{5570:function(e,t,s){Promise.resolve().then(s.bind(s,5639))},5639:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return w}});var a=s(7437),n=s(2265),i=s(9376),o=s(4972),r=s(2735),l=s(9345),c=s(7168),d=s(2023),p=s(5805),m=s(525),h=s(1671),u=s(6858);let g=(0,s(9205).Z)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);var x=s(8239),f=s(832),b=s(9537),y=s(9064);function v(){let e=(0,i.useParams)(),t=(0,i.useRouter)(),[b,v]=(0,n.useState)(null),[w,j]=(0,n.useState)(null),[k,N]=(0,n.useState)(!0),[A,S]=(0,n.useState)(!1),[E,C]=(0,n.useState)(!1),[F,Z]=(0,n.useState)({recipientEmail:"",recipientName:"",ccEmails:"",customSubject:"",isClientFacing:!0}),[z,R]=(0,n.useState)(!1),[P,T]=(0,n.useState)(null),[I,M]=(0,n.useState)(!1);(0,n.useEffect)(()=>{L()},[e.formId]);let L=async()=>{try{let t=await fetch("/api/aloa-forms/".concat(e.formId));if(!t.ok)throw Error("Failed to fetch form");let s=await t.json();v(s);let a=await fetch("/api/ai-analysis/".concat(e.formId));if(a.ok){let e=await a.json();e.analysis&&j(e.analysis)}}catch(e){console.error("Error fetching form:",e),y.ZP.error("Failed to load form data"),t.push("/dashboard")}finally{N(!1)}},D=async()=>{w&&b&&(document.body.classList.add("printing-pdf"),window.print(),setTimeout(()=>{document.body.classList.remove("printing-pdf")},100),y.ZP.success("Opening print dialog - save as PDF for best results"))},q=async()=>{try{let{generateEmailPreview:e,parseAnalysisText:t}=await Promise.resolve().then(s.bind(s,9468)),a=W(w,F.isClientFacing),n={summary:w.executiveSummary||"",consensusAreas:w.consensusAreas||[],divergenceAreas:w.conflictAreas?w.conflictAreas.map(e=>({topic:e.topic,viewpoints:e.viewpoints?e.viewpoints.map(e=>({label:e.percentage>50?"Majority view":e.percentage>30?"Significant perspective":"Alternative approach",percentage:e.percentage,description:e.description})):[]})):[],synthesis:a.includes("## Synthesis")?a.split("## Synthesis")[1].split("##")[0].trim():"",recommendations:!F.isClientFacing&&w.recommendations?w.recommendations.map(e=>"".concat(e.title,": ").concat(e.description)):[],statistics:{totalResponses:w.totalResponses||0,consensusScore:w.consensusScore||0,completionRate:w.completionRate,averageTime:w.averageTime}},i={html:B(b.title,n,F.recipientName,F.isClientFacing),preview:{subject:F.customSubject||(F.isClientFacing?"Your Input Summary: ".concat(b.title):"AI Analysis Report: ".concat(b.title)),greeting:F.recipientName?"Dear ".concat(F.recipientName,","):"Hello,",isClientFacing:F.isClientFacing,sections:[]}};T(i),M(!0)}catch(e){console.error("Error generating preview:",e),y.ZP.error("Failed to generate preview")}},B=(e,t,a,n)=>{{let{generateAnalysisEmailHTML:i}=s(9468);return i(e,t,a,n)}},O=async()=>{if(!F.recipientEmail){y.ZP.error("Please enter a recipient email");return}R(!0);try{let t={summary:w.executiveSummary||"",consensusAreas:w.consensusAreas||[],divergenceAreas:w.conflictAreas?w.conflictAreas.map(e=>({topic:e.topic,viewpoints:e.viewpoints?e.viewpoints.map(e=>({label:e.percentage>50?"Majority view":e.percentage>30?"Significant perspective":"Alternative approach",percentage:e.percentage,description:e.description})):[]})):[],synthesis:F.isClientFacing?Y(w):"",recommendations:!F.isClientFacing&&w.recommendations?w.recommendations.map(e=>"".concat(e.title,": ").concat(e.description)):[],statistics:{totalResponses:w.totalResponses||0,consensusScore:w.consensusScore||0}},s=JSON.stringify(t),a=await fetch("/api/ai-analysis/".concat(e.formId,"/email"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({recipientEmail:F.recipientEmail,recipientName:F.recipientName,analysisText:s,formTitle:b.title,ccEmails:F.ccEmails?F.ccEmails.split(",").map(e=>e.trim()).filter(Boolean):[],customSubject:F.customSubject||(F.isClientFacing?"Your Input Summary: ".concat(b.title):"AI Analysis Report: ".concat(b.title)),isClientFacing:F.isClientFacing})});if(!a.ok){let e=await a.json();throw Error(e.error||"Failed to send email")}y.ZP.success("Analysis email sent successfully!"),C(!1),Z({recipientEmail:"",recipientName:"",ccEmails:"",customSubject:"",isClientFacing:!0})}catch(e){console.error("Error sending email:",e),y.ZP.error(e.message||"Failed to send email")}finally{R(!1)}},Y=e=>{let t="";if(e.consensusAreas&&e.consensusAreas.length>0){let s=e.consensusAreas[0];t+="**Build on Strong Foundations:** Your team's ".concat(s.agreementPercentage||"strong","% agreement on ").concat(s.topic.toLowerCase()," provides a solid foundation. This should be your north star as you move forward.\n\n")}e.conflictAreas&&e.conflictAreas.length>0&&(t+="**Embrace Diverse Perspectives:** The varying viewpoints aren't obstacles but rather indicators of a thoughtful team considering multiple angles. ",e.conflictAreas.some(e=>e.viewpoints&&e.viewpoints.some(e=>e.percentage>40&&e.percentage<60))?t+="With relatively even splits on certain topics, consider pilot programs or A/B testing to validate different approaches.":t+="With clear majority/minority splits, consider implementing the majority view while creating specific accommodations for minority concerns.",t+="\n\n"),t+="**Immediate Next Steps:**\n"+"1. Focus first on areas with ".concat(e.consensusScore||80,"% or higher agreement to build momentum\n")+"2. Create working groups for areas with divergent views to develop integrated solutions\n3. Establish success metrics that reflect both consensus priorities and diverse perspectives\n\n";let s=e.consensusScore||0;return t+("**Key Insight:** Your team shows ".concat(s,"% overall alignment, which is ")+(s>70?"exceptionally strong":s>50?"healthy":"an opportunity for further dialogue"))+". The areas of difference are well-defined and manageable, suggesting a team that's thoughtfully engaged with the challenges at hand."},W=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s="";if(e.executiveSummary&&(s+="## Executive Summary\n".concat(e.executiveSummary,"\n\n")),t){if(e.consensusAreas&&e.consensusAreas.length>0&&(s+="## Where Your Team Strongly Agrees\n\n",e.consensusAreas.forEach(e=>{s+="### ".concat(e.topic,"\n")+"".concat(e.description,"\n")+"*".concat(e.agreementPercentage,"% of participants share this view*\n\n"),e.description.length>50&&(s+="This consensus suggests that ".concat(e.topic.toLowerCase()," is a critical priority that should anchor your strategy moving forward.\n\n"))})),e.conflictAreas&&e.conflictAreas.length>0&&(s+="## Where Perspectives Differ\n\nThese differences aren't roadblocks—they're opportunities to create a more comprehensive solution that addresses diverse needs:\n\n",e.conflictAreas.forEach(e=>{s+="### ".concat(e.topic,"\n\n")+"Your team has identified multiple valid approaches:\n\n",e.viewpoints.forEach((e,t)=>{s+="**".concat(0===t?"One perspective":1===t?"Another view":"An additional approach"," (").concat(e.percentage,"% of team):** ").concat(e.description,"\n\n")}),s+="*Synthesis:* These different viewpoints on ".concat(e.topic.toLowerCase()," suggest an opportunity to implement a hybrid approach that leverages the strengths of each perspective.\n\n")})),s+="## Synthesis & Recommended Path Forward\n\n",e.consensusAreas&&e.consensusAreas.length>0){let t=e.consensusAreas[0];s+="**Build on Strong Foundations:** Your team's ".concat(t.agreementPercentage,"% agreement on ").concat(t.topic.toLowerCase()," provides a solid foundation. This should be your north star as you move forward.\n\n")}e.conflictAreas&&e.conflictAreas.length>0&&(s+="**Embrace Diverse Perspectives:** The varying viewpoints aren't obstacles but rather indicators of a thoughtful team considering multiple angles. ",e.conflictAreas.some(e=>e.viewpoints.some(e=>e.percentage>40&&e.percentage<60))?s+="With relatively even splits on certain topics, consider pilot programs or A/B testing to validate different approaches.\n\n":s+="With clear majority/minority splits, consider implementing the majority view while creating specific accommodations for minority concerns.\n\n"),s+="**Immediate Next Steps:**\n"+"1. Focus first on areas with ".concat(e.consensusScore,"% or higher agreement to build momentum\n")+"2. Create working groups for areas with divergent views to develop integrated solutions\n3. Establish success metrics that reflect both consensus priorities and diverse perspectives\n\n"+"**Key Insight:** Your team shows ".concat(e.consensusScore,"% overall alignment, which is ").concat(e.consensusScore>70?"exceptionally strong":e.consensusScore>50?"healthy":"an opportunity for further dialogue",". ")+"The areas of difference are well-defined and manageable, suggesting a team that's thoughtfully engaged with the challenges at hand.\n\n"}else e.consensusAreas&&e.consensusAreas.length>0&&(s+="## Key Insights\n",e.consensusAreas.forEach(e=>{s+="- ".concat(e.topic,": ").concat(e.description," (").concat(e.agreementPercentage,"% agreement)\n")}),s+="\n"),e.conflictAreas&&e.conflictAreas.length>0&&(s+="## Areas of Divergence\n",e.conflictAreas.forEach(e=>{s+="- ".concat(e.topic,":\n"),e.viewpoints.forEach(e=>{s+="  - ".concat(e.percentage,"%: ").concat(e.description,"\n")})}),s+="\n"),e.recommendations&&e.recommendations.length>0&&(s+="## Recommendations\n",e.recommendations.forEach((e,t)=>{s+="".concat(t+1,". ").concat(e.title,": ").concat(e.description),e.priority&&(s+=" (".concat(e.priority," priority)")),s+="\n"}),s+="\n");return s+="## Response Statistics\n"+"Total Responses: ".concat(e.totalResponses,"\n")+"Consensus Level: ".concat(e.consensusScore,"%\n")+"Confidence Score: ".concat(e.confidence,"%\n")},_=async()=>{S(!0);try{let t=await fetch("/api/ai-analysis/".concat(e.formId),{method:"POST"});if(!t.ok)throw Error("Analysis failed");let s=await t.json();j(s),y.ZP.success("Analysis complete!")}catch(e){console.error("Error running analysis:",e),y.ZP.error("Failed to analyze responses")}finally{S(!1)}};return k?(0,a.jsx)("div",{className:"min-h-screen bg-gradient-subtle flex items-center justify-center",children:(0,a.jsx)(f.Z,{message:"Loading form data..."})}):b?(0,a.jsx)("div",{className:"min-h-screen bg-gradient-subtle",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsxs)("button",{onClick:()=>t.push("/dashboard"),className:"mb-6 inline-flex items-center gap-2 text-aloa-black hover:text-aloa-gray transition-colors font-display uppercase tracking-wider text-xs sm:text-sm group",children:[(0,a.jsx)("svg",{className:"w-4 h-4 transition-transform group-hover:-translate-x-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),(0,a.jsx)("span",{children:"Back to Dashboard"})]}),(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl sm:text-4xl font-display font-bold text-aloa-black uppercase tracking-tight mb-2",children:b.title}),(0,a.jsxs)("p",{className:"text-lg text-aloa-gray font-body",children:["Analysis based on ",w?w.totalResponses:"..."," responses"]})]}),(0,a.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-start justify-between gap-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-3 bg-gradient-to-br from-purple-500 to-pink-500 shadow-lg",children:(0,a.jsx)(o.Z,{className:"w-6 h-6 text-white"})}),(0,a.jsx)("span",{className:"text-sm font-display uppercase tracking-wider text-aloa-gray",children:"AI-Powered Insights"})]}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 w-full lg:w-auto",children:[w&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("button",{onClick:D,className:"px-6 py-3 bg-transparent text-aloa-black border-2 border-aloa-black font-display uppercase tracking-wider hover:bg-aloa-black hover:text-aloa-cream transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-aloa-black focus:ring-offset-2 focus:ring-offset-aloa-cream flex items-center justify-center gap-2 w-full sm:w-auto",children:[(0,a.jsx)(r.Z,{className:"w-5 h-5"}),(0,a.jsx)("span",{children:"Download PDF"})]}),(0,a.jsxs)("button",{onClick:()=>C(!0),className:"px-6 py-3 bg-transparent text-aloa-black border-2 border-aloa-black font-display uppercase tracking-wider hover:bg-aloa-black hover:text-aloa-cream transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-aloa-black focus:ring-offset-2 focus:ring-offset-aloa-cream flex items-center justify-center gap-2 w-full sm:w-auto",children:[(0,a.jsx)(l.Z,{className:"w-5 h-5"}),(0,a.jsx)("span",{children:"Send"})]})]}),(0,a.jsx)("button",{onClick:_,disabled:A,className:"px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-display uppercase tracking-wider transition-all duration-300 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 focus:ring-offset-aloa-cream disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 w-full sm:w-auto",children:A?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.Z,{className:"w-5 h-5 animate-spin"}),(0,a.jsx)("span",{children:"Analyzing..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d.Z,{className:"w-5 h-5"}),(0,a.jsx)("span",{children:w?"Re-analyze":"Start Analysis"})]})})]})]})]}),!w&&!A&&(0,a.jsx)("div",{className:"bg-aloa-white p-12 sm:p-16 border-2 border-aloa-black shadow-xl text-center",children:(0,a.jsxs)("div",{className:"max-w-md mx-auto",children:[(0,a.jsx)("div",{className:"mb-8 mx-auto w-24 h-24 bg-gradient-to-br from-purple-100 to-pink-100 border-2 border-purple-300 flex items-center justify-center",children:(0,a.jsx)(o.Z,{className:"w-12 h-12 text-purple-600"})}),(0,a.jsx)("h2",{className:"text-2xl sm:text-3xl font-display font-bold text-aloa-black mb-4 uppercase",children:"Ready to Analyze"}),(0,a.jsx)("p",{className:"text-aloa-gray mb-10 font-body text-sm sm:text-base leading-relaxed",children:"Generate AI-powered insights from your collected responses. The AI will identify areas of consensus, divergence, and provide actionable synthesis."}),(0,a.jsxs)("button",{onClick:_,className:"px-8 py-4 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-display uppercase tracking-wider transition-all duration-300 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 focus:ring-offset-aloa-cream inline-flex items-center justify-center gap-2",children:[(0,a.jsx)(d.Z,{className:"w-5 h-5"}),(0,a.jsx)("span",{children:"Start Analysis"})]})]})}),A&&(0,a.jsx)("div",{className:"bg-aloa-white p-12 sm:p-16 border-2 border-aloa-black shadow-xl text-center",children:(0,a.jsxs)("div",{className:"max-w-md mx-auto",children:[(0,a.jsx)("div",{className:"mb-8",children:(0,a.jsxs)("div",{className:"relative w-24 h-24 mx-auto",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-500 to-pink-500 animate-pulse"}),(0,a.jsx)("div",{className:"absolute inset-3 bg-white flex items-center justify-center",children:(0,a.jsx)(o.Z,{className:"w-10 h-10 text-purple-600 animate-pulse"})})]})}),(0,a.jsx)("h2",{className:"text-xl sm:text-2xl font-display font-bold text-aloa-black mb-3 uppercase",children:"Analyzing Responses..."}),(0,a.jsx)("p",{className:"text-aloa-gray font-body text-sm sm:text-base",children:"Our AI is processing all responses to identify patterns and insights"})]})}),w&&(0,a.jsxs)(x.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"space-y-6",children:[(0,a.jsx)("div",{className:"bg-gradient-to-br from-purple-50 to-pink-50 p-6 sm:p-8 border-2 border-purple-400 shadow-xl hover:shadow-2xl transition-all duration-300",children:(0,a.jsxs)("div",{className:"flex items-start gap-4",children:[(0,a.jsx)("div",{className:"p-2 bg-purple-600 rounded",children:(0,a.jsx)(d.Z,{className:"w-6 h-6 text-white"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h2",{className:"text-xl sm:text-2xl font-display font-bold text-aloa-black uppercase mb-4",children:"Executive Summary"}),(0,a.jsx)("p",{className:"text-aloa-gray font-body leading-relaxed text-sm sm:text-base",children:w.executiveSummary})]})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"bg-aloa-white p-6 sm:p-8 border-2 border-aloa-black shadow-lg hover:shadow-xl transition-all duration-300 text-center group hover:-translate-y-1",children:[(0,a.jsx)(p.Z,{className:"w-10 h-10 text-blue-500 mx-auto mb-3 group-hover:scale-110 transition-transform duration-300"}),(0,a.jsx)("p",{className:"text-3xl font-display font-bold text-aloa-black mb-1",children:w.totalResponses}),(0,a.jsx)("p",{className:"text-xs sm:text-sm font-display uppercase tracking-wider text-aloa-gray",children:"Total Responses"})]}),(0,a.jsxs)("div",{className:"bg-aloa-white p-6 sm:p-8 border-2 border-aloa-black shadow-lg hover:shadow-xl transition-all duration-300 text-center group hover:-translate-y-1",children:[(0,a.jsx)(m.Z,{className:"w-10 h-10 text-green-500 mx-auto mb-3 group-hover:scale-110 transition-transform duration-300"}),(0,a.jsxs)("p",{className:"text-3xl font-display font-bold text-aloa-black mb-1",children:[w.consensusScore,"%"]}),(0,a.jsx)("p",{className:"text-xs sm:text-sm font-display uppercase tracking-wider text-aloa-gray",children:"Consensus Level"})]}),(0,a.jsxs)("div",{className:"bg-aloa-white p-6 sm:p-8 border-2 border-aloa-black shadow-lg hover:shadow-xl transition-all duration-300 text-center group hover:-translate-y-1",children:[(0,a.jsx)(o.Z,{className:"w-10 h-10 text-purple-500 mx-auto mb-3 group-hover:scale-110 transition-transform duration-300"}),(0,a.jsxs)("p",{className:"text-3xl font-display font-bold text-aloa-black mb-1",children:[w.confidence,"%"]}),(0,a.jsx)("p",{className:"text-xs sm:text-sm font-display uppercase tracking-wider text-aloa-gray",children:"Confidence Score"})]})]}),w.consensusAreas&&w.consensusAreas.length>0&&(0,a.jsxs)("div",{className:"bg-aloa-white p-6 sm:p-8 border-2 border-aloa-black shadow-xl hover:shadow-2xl transition-all duration-300",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,a.jsx)("div",{className:"p-2 bg-green-500 rounded",children:(0,a.jsx)(h.Z,{className:"w-6 h-6 text-white"})}),(0,a.jsx)("h2",{className:"text-xl sm:text-2xl font-display font-bold text-aloa-black uppercase",children:"Areas of Agreement"})]}),(0,a.jsx)("div",{className:"space-y-4",children:w.consensusAreas.map((e,t)=>(0,a.jsxs)(x.E.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.1*t},className:"flex items-start gap-3 p-4 bg-green-50 border-2 border-green-300 hover:border-green-400 transition-all duration-200 hover:shadow-md",children:[(0,a.jsx)(u.Z,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-1"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"font-display font-bold text-aloa-black uppercase text-sm sm:text-base mb-2",children:e.topic}),(0,a.jsx)("p",{className:"text-aloa-gray font-body text-sm sm:text-base leading-relaxed mb-2",children:e.description}),(0,a.jsxs)("span",{className:"inline-block text-xs font-display uppercase tracking-wider text-green-600 bg-green-100 px-2 py-1",children:[e.agreementPercentage,"% agreement"]})]})]},t))})]}),w.conflictAreas&&w.conflictAreas.length>0&&(0,a.jsxs)("div",{className:"bg-aloa-white p-6 sm:p-8 border-2 border-aloa-black shadow-xl hover:shadow-2xl transition-all duration-300",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,a.jsx)("div",{className:"p-2 bg-orange-500 rounded",children:(0,a.jsx)(g,{className:"w-6 h-6 text-white"})}),(0,a.jsx)("h2",{className:"text-xl sm:text-2xl font-display font-bold text-aloa-black uppercase",children:"Areas of Divergence"})]}),(0,a.jsx)("div",{className:"space-y-4",children:w.conflictAreas.map((e,t)=>(0,a.jsxs)(x.E.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.1*t},className:"p-4 bg-orange-50 border-2 border-orange-300 hover:border-orange-400 transition-all duration-200 hover:shadow-md",children:[(0,a.jsx)("h3",{className:"font-display font-bold text-aloa-black uppercase text-sm sm:text-base mb-3",children:e.topic}),(0,a.jsx)("div",{className:"space-y-3",children:e.viewpoints.map((e,t)=>(0,a.jsx)("div",{className:"pl-4 border-l-3 border-orange-400",children:(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[(0,a.jsxs)("span",{className:"inline-block text-xs font-display uppercase tracking-wider text-orange-700 bg-orange-100 px-2 py-1",children:[e.percentage,"%"]}),(0,a.jsx)("p",{className:"text-sm sm:text-base text-aloa-gray font-body leading-relaxed flex-1",children:e.description})]})},t))})]},t))})]}),w.recommendations&&w.recommendations.length>0&&(0,a.jsxs)("div",{className:"bg-gradient-to-br from-blue-50 to-purple-50 p-6 sm:p-8 border-2 border-blue-400 shadow-xl hover:shadow-2xl transition-all duration-300",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,a.jsx)("div",{className:"p-2 bg-blue-600 rounded",children:(0,a.jsx)(m.Z,{className:"w-6 h-6 text-white"})}),(0,a.jsx)("h2",{className:"text-xl sm:text-2xl font-display font-bold text-aloa-black uppercase",children:"Actionable Recommendations"})]}),(0,a.jsx)("div",{className:"space-y-4",children:w.recommendations.map((e,t)=>(0,a.jsxs)(x.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.1*t},className:"flex items-start gap-3",children:[(0,a.jsx)("span",{className:"flex-shrink-0 w-10 h-10 bg-blue-600 text-white flex items-center justify-center font-display font-bold text-base",children:t+1}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"font-display font-bold text-aloa-black uppercase text-sm sm:text-base mb-2",children:e.title}),(0,a.jsx)("p",{className:"text-aloa-gray font-body text-sm sm:text-base leading-relaxed mb-2",children:e.description}),e.priority&&(0,a.jsxs)("span",{className:"inline-block px-3 py-1 text-xs font-display uppercase tracking-wider ".concat("high"===e.priority?"bg-red-100 text-red-700 border border-red-300":"medium"===e.priority?"bg-yellow-100 text-yellow-700 border border-yellow-300":"bg-green-100 text-green-700 border border-green-300"),children:[e.priority," priority"]})]})]},t))})]}),w.stakeholderMessage&&(0,a.jsx)("div",{className:"bg-gradient-to-br from-indigo-50 to-purple-50 p-6 sm:p-8 border-2 border-indigo-400 shadow-xl hover:shadow-2xl transition-all duration-300",children:(0,a.jsxs)("div",{className:"flex items-start gap-4",children:[(0,a.jsx)("div",{className:"p-2 bg-indigo-600 rounded",children:(0,a.jsx)(p.Z,{className:"w-6 h-6 text-white"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h2",{className:"text-xl sm:text-2xl font-display font-bold text-aloa-black uppercase mb-4",children:"Message to Stakeholders"}),(0,a.jsxs)("p",{className:"text-aloa-gray font-body leading-relaxed italic text-sm sm:text-base",children:['"',w.stakeholderMessage,'"']})]})]})})]}),E&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center p-4 z-50 overflow-y-auto",children:(0,a.jsxs)(x.E.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-aloa-white border-2 border-aloa-black shadow-2xl max-w-lg w-full my-8 max-h-[90vh] overflow-y-auto relative",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between sticky top-0 bg-aloa-white p-8 pb-4 border-b-2 border-aloa-black z-10",children:[(0,a.jsx)("h3",{className:"text-xl font-display font-bold text-aloa-black uppercase",children:"Send Analysis Report"}),(0,a.jsx)("button",{onClick:()=>C(!1),className:"w-8 h-8 flex items-center justify-center text-aloa-gray hover:text-aloa-black hover:bg-aloa-sand transition-all duration-200 rounded-full",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsxs)("div",{className:"space-y-2 px-8 pb-8",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("label",{className:"block text-sm font-display uppercase tracking-wider text-aloa-gray mb-3",children:"Email Type"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{type:"button",onClick:()=>Z({...F,isClientFacing:!0}),className:"flex-1 px-4 py-3 text-sm font-display uppercase tracking-wider transition-all duration-200 ".concat(F.isClientFacing?"bg-aloa-black text-aloa-cream shadow-md":"bg-aloa-white text-aloa-gray border-2 border-aloa-black hover:bg-aloa-sand"),children:"Client-Facing"}),(0,a.jsx)("button",{type:"button",onClick:()=>Z({...F,isClientFacing:!1}),className:"flex-1 px-4 py-3 text-sm font-display uppercase tracking-wider transition-all duration-200 ".concat(F.isClientFacing?"bg-aloa-white text-aloa-gray border-2 border-aloa-black hover:bg-aloa-sand":"bg-aloa-black text-aloa-cream shadow-md"),children:"Internal"})]})]}),(0,a.jsxs)("div",{className:"mb-5",children:[(0,a.jsx)("label",{className:"block text-sm font-display uppercase tracking-wider text-aloa-gray mb-2",children:"Recipient Email *"}),(0,a.jsx)("input",{type:"email",value:F.recipientEmail,onChange:e=>Z({...F,recipientEmail:e.target.value}),className:"w-full px-4 py-3 bg-aloa-white border-2 border-aloa-black focus:outline-none focus:ring-2 focus:ring-aloa-black focus:ring-offset-2 focus:ring-offset-white transition-all duration-200 hover:shadow-md placeholder:text-aloa-gray",placeholder:"recipient@example.com",required:!0})]}),(0,a.jsxs)("div",{className:"mb-5",children:[(0,a.jsx)("label",{className:"block text-sm font-display uppercase tracking-wider text-aloa-gray mb-2",children:"Recipient Name"}),(0,a.jsx)("input",{type:"text",value:F.recipientName,onChange:e=>Z({...F,recipientName:e.target.value}),className:"w-full px-4 py-3 bg-aloa-white border-2 border-aloa-black focus:outline-none focus:ring-2 focus:ring-aloa-black focus:ring-offset-2 focus:ring-offset-white transition-all duration-200 hover:shadow-md placeholder:text-aloa-gray",placeholder:"John Doe"})]}),(0,a.jsxs)("div",{className:"mb-5",children:[(0,a.jsx)("label",{className:"block text-sm font-display uppercase tracking-wider text-aloa-gray mb-2",children:"CC Emails (comma-separated)"}),(0,a.jsx)("input",{type:"text",value:F.ccEmails,onChange:e=>Z({...F,ccEmails:e.target.value}),className:"w-full px-4 py-3 bg-aloa-white border-2 border-aloa-black focus:outline-none focus:ring-2 focus:ring-aloa-black focus:ring-offset-2 focus:ring-offset-white transition-all duration-200 hover:shadow-md placeholder:text-aloa-gray",placeholder:"cc1@example.com, cc2@example.com"})]}),(0,a.jsxs)("div",{className:"mb-5",children:[(0,a.jsx)("label",{className:"block text-sm font-display uppercase tracking-wider text-aloa-gray mb-2",children:"Custom Subject (optional)"}),(0,a.jsx)("input",{type:"text",value:F.customSubject,onChange:e=>Z({...F,customSubject:e.target.value}),className:"w-full px-4 py-3 bg-aloa-white border-2 border-aloa-black focus:outline-none focus:ring-2 focus:ring-aloa-black focus:ring-offset-2 focus:ring-offset-white transition-all duration-200 hover:shadow-md placeholder:text-aloa-gray",placeholder:F.isClientFacing?"Your Input Summary: ".concat((null==b?void 0:b.title)||"Form"):"AI Analysis Report: ".concat((null==b?void 0:b.title)||"Form")})]})]}),I&&P&&(0,a.jsxs)("div",{className:"mx-8 mt-6 p-4 bg-aloa-sand border-2 border-aloa-black",children:[(0,a.jsx)("h4",{className:"text-sm font-display uppercase tracking-wider text-aloa-black mb-2",children:"Email Preview"}),(0,a.jsxs)("div",{className:"text-xs text-aloa-gray space-y-1 mb-3 font-body",children:[(0,a.jsxs)("p",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"font-display uppercase tracking-wider",children:"Subject:"}),(0,a.jsx)("span",{className:"text-aloa-black truncate ml-2",children:P.preview.subject})]}),(0,a.jsxs)("p",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"font-display uppercase tracking-wider",children:"Type:"}),(0,a.jsx)("span",{className:"text-aloa-black",children:P.preview.isClientFacing?"Client-Facing":"Internal"})]})]}),(0,a.jsx)("div",{className:"bg-aloa-white border-2 border-aloa-black",style:{height:"250px",overflow:"hidden",position:"relative"},children:(0,a.jsx)("iframe",{srcDoc:P.html,style:{width:"200%",height:"500px",border:"none",transform:"scale(0.5)",transformOrigin:"top left",position:"absolute",top:0,left:0},title:"Email Preview",sandbox:"allow-same-origin"})})]}),(0,a.jsxs)("div",{className:"flex gap-3 mt-8 px-8 pb-12",children:[(0,a.jsx)("button",{onClick:()=>{C(!1),M(!1),T(null)},className:"flex-1 px-4 py-3 bg-transparent text-aloa-black border-2 border-aloa-black font-display uppercase tracking-wider hover:bg-aloa-black hover:text-aloa-cream transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-aloa-black focus:ring-offset-2 focus:ring-offset-white disabled:opacity-50 disabled:cursor-not-allowed",disabled:z,children:"Cancel"}),I?(0,a.jsx)("button",{onClick:()=>{M(!1),T(null)},className:"flex-1 px-4 py-3 bg-transparent text-aloa-black border-2 border-aloa-black font-display uppercase tracking-wider hover:bg-aloa-black hover:text-aloa-cream transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-aloa-black focus:ring-offset-2 focus:ring-offset-white",children:"Edit"}):(0,a.jsxs)("button",{onClick:q,className:"flex-1 px-4 py-3 bg-transparent text-aloa-black border-2 border-aloa-black font-display uppercase tracking-wider hover:bg-aloa-black hover:text-aloa-cream transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-aloa-black focus:ring-offset-2 focus:ring-offset-white flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",disabled:!F.recipientEmail,children:[(0,a.jsx)(c.Z,{className:"w-4 h-4"}),"Preview"]}),(0,a.jsx)("button",{onClick:O,className:"flex-1 px-4 py-3 bg-aloa-black text-aloa-cream font-display uppercase tracking-wider hover:bg-opacity-90 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 focus:outline-none focus:ring-2 focus:ring-aloa-black focus:ring-offset-2 focus:ring-offset-white active:scale-95 flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",disabled:z||!F.recipientEmail,children:z?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.Z,{className:"w-4 h-4 animate-spin"}),"Sending..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.Z,{className:"w-4 h-4"}),"Send"]})})]})]})})]})}):null}function w(){return(0,a.jsx)(b.Z,{requireAuth:!0,redirectTo:"/auth/login",children:(0,a.jsx)(v,{})})}},9537:function(e,t,s){"use strict";s.d(t,{Z:function(){return c}});var a=s(7437),n=s(2265),i=s(9376),o=s(1013),r=s(6337),l=s(9322);function c(e){let{children:t,allowedRoles:s=[],redirectTo:c="/auth/login",requireAuth:d=!0}=e,p=(0,i.useRouter)(),[m,h]=(0,n.useState)(!0),[u,g]=(0,n.useState)(!1),[x,f]=(0,n.useState)(null),[b,y]=(0,n.useState)(null);(0,n.useEffect)(()=>{v()},[]);let v=async()=>{try{let e=(0,o.e)(),{data:{user:t},error:a}=await e.auth.getUser();if(a||!t){d?(console.log("No authenticated user, redirecting to login"),p.push("".concat(c,"?message=Please login to continue"))):g(!0),h(!1);return}console.log("Fetching profile for user:",t.id,t.email);let n=await fetch("/api/auth/profile",{credentials:"include",headers:{"Content-Type":"application/json"}}),i=await n.json();if(console.log("Profile API response:",i),!n.ok||i.error){console.error("Error fetching user profile:",i.error),y("Unable to verify user permissions: "+(i.error||"Unknown error")),h(!1);return}if(!i.user||!i.user.role){console.error("No user role found in response"),y("User profile incomplete. Please contact support."),h(!1);return}let r=i.user.profile||{role:i.user.role};f(r.role),console.log("User role set to:",r.role),s.length>0?(console.log("Checking role access:",{userRole:r.role,allowedRoles:s,isIncluded:s.includes(r.role)}),s.includes(r.role)?(console.log("Access granted for role:",r.role),g(!0)):(console.log("User role ".concat(r.role," not in allowed roles:"),s),y("Access denied. This area is restricted to: ".concat(s.join(", "))),g(!1))):(console.log("No specific roles required, user is authenticated"),g(!0)),h(!1)}catch(e){console.error("Auth check error:",e),y("An error occurred while checking permissions"),h(!1)}};return m?(0,a.jsx)("div",{className:"min-h-screen bg-gradient-subtle flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Checking permissions..."})]})}):b||!u?(0,a.jsx)("div",{className:"min-h-screen bg-gradient-subtle flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"bg-white p-8 rounded-lg shadow-xl max-w-md w-full",children:[(0,a.jsx)("div",{className:"flex justify-center mb-6",children:(0,a.jsx)("div",{className:"p-4 bg-red-100 rounded-full",children:(0,a.jsx)(r.Z,{className:"w-8 h-8 text-red-600"})})}),(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900 text-center mb-2",children:"Access Restricted"}),(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:(0,a.jsxs)("div",{className:"flex items-start",children:[(0,a.jsx)(l.Z,{className:"w-5 h-5 text-red-600 mt-0.5 mr-2 flex-shrink-0"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-red-800 text-sm",children:b||"You do not have permission to access this page."}),x&&(0,a.jsxs)("p",{className:"text-red-600 text-xs mt-1",children:["Your role: ",(0,a.jsx)("span",{className:"font-semibold",children:x})]})]})]})}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("button",{onClick:()=>p.back(),className:"w-full px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:"Go Back"}),(0,a.jsx)("button",{onClick:()=>p.push("/dashboard"),className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Go to Dashboard"})]})]})}):t}},832:function(e,t,s){"use strict";s.d(t,{Z:function(){return i}});var a=s(7437),n=s(8239);function i(e){let{message:t="Loading...",size:s="default"}=e,i={small:"w-8 h-8",default:"w-16 h-16",large:"w-24 h-24"};return(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-[200px] p-8",children:[(0,a.jsx)(n.E.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.3},className:"relative",children:(0,a.jsxs)("div",{className:"".concat(i[s]," relative"),children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-aloa-black rounded-full animate-ping opacity-20"}),(0,a.jsx)("div",{className:"".concat(i[s]," bg-aloa-black rounded-full animate-pulse")})]})}),t&&(0,a.jsx)(n.E.p,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},className:"mt-4 text-sm font-display uppercase tracking-wider text-aloa-gray",children:t})]})}},9468:function(e,t,s){"use strict";function a(e,t){let s,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=!(arguments.length>3)||void 0===arguments[3]||arguments[3];if("object"==typeof t&&null!==t)s=t;else if("string"==typeof t)try{s=t.startsWith("{")?JSON.parse(t):n(t)}catch(e){s=n(t)}else s={summary:"",consensusAreas:[],divergenceAreas:[],recommendations:[],synthesis:"",statistics:{}};return'\n<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>AI Analysis Report - '.concat(e,'</title>\n  <!--[if mso]>\n  <noscript>\n    <xml>\n      <o:OfficeDocumentSettings>\n        <o:PixelsPerInch>96</o:PixelsPerInch>\n      </o:OfficeDocumentSettings>\n    </xml>\n  </noscript>\n  <![endif]-->\n</head>\n<body style="margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, \'Helvetica Neue\', Arial, sans-serif; background-color: #f5f5f5;">\n  <table role="presentation" cellspacing="0" cellpadding="0" border="0" width="100%" style="background-color: #f5f5f5;">\n    <tr>\n      <td align="center" style="padding: 40px 20px;">\n        <table role="presentation" cellspacing="0" cellpadding="0" border="0" width="600" style="background-color: #ffffff; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">\n          \n          <!-- Header -->\n          <tr>\n            <td style="background-color: #000000; padding: 40px 30px; text-align: center; border-radius: 8px 8px 0 0;">\n              <!-- Aloa Logo -->\n              <img src="https://images.ctfassets.net/qkznfzcikv51/xWpsUAypBrRgAjmbyLGYy/b969f4353174e4f209996ebf60af8f7c/aloa_-_white.svg" \n                   alt="Aloa" \n                   style="height: 40px; width: auto; margin: 0 auto 20px auto; display: block;"\n              />\n              <!-- Form Title -->\n              <h1 style="margin: 0 0 10px 0; color: #FFF8E8; font-size: 28px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px;">\n                ').concat(e,'\n              </h1>\n              <!-- Subtitle -->\n              <p style="margin: 0; color: #FFF8E8; font-size: 16px; opacity: 0.9;">\n                Analysis based on ').concat(s.statistics&&s.statistics.totalResponses?s.statistics.totalResponses:"all",' responses\n              </p>\n            </td>\n          </tr>\n          \n          <!-- Content -->\n          <tr>\n            <td style="padding: 40px 30px;">\n              \n              <!-- Greeting -->\n              <p style="margin: 0 0 20px 0; color: #333333; font-size: 16px; line-height: 1.5;">\n                ').concat(a?"Dear ".concat(a,","):"Hello,",'\n              </p>\n              \n              <!-- Introduction -->\n              <p style="margin: 0 0 30px 0; color: #666666; font-size: 14px; line-height: 1.6;">\n                ').concat(i?"Thank you for participating in <strong>".concat(e,"</strong>. We've analyzed all responses and are pleased to share the collective insights from all participants. This summary highlights where there's consensus and where perspectives differ."):"We're pleased to share the AI-powered analysis of the responses collected through <strong>".concat(e,"</strong>. This report provides valuable insights and recommendations based on the submitted data."),"\n              </p>\n              \n              ").concat(s.summary?'\n              <!-- Executive Summary -->\n              <div style="margin-bottom: 30px; padding: 20px; background-color: #FFF8E8; border-left: 4px solid #000000; border-radius: 4px;">\n                <h2 style="margin: 0 0 15px 0; color: #000000; font-size: 18px; font-weight: 600;">Executive Summary</h2>\n                <p style="margin: 0; color: #333333; font-size: 14px; line-height: 1.6;">\n                  '.concat(s.summary,"\n                </p>\n              </div>\n              "):"","\n              \n              ").concat(i&&s.consensusAreas&&s.consensusAreas.length>0?'\n              <!-- Where Your Team Agrees -->\n              <div style="margin-bottom: 30px;">\n                <h2 style="margin: 0 0 20px 0; color: #000000; font-size: 18px; font-weight: 600;">Where Your Team Strongly Agrees</h2>\n                '.concat(s.consensusAreas.map(e=>'\n                  <div style="margin-bottom: 20px; padding: 15px; background-color: #e8f5e9; border-left: 4px solid #4caf50; border-radius: 4px;">\n                    <h3 style="margin: 0 0 10px 0; color: #2e7d32; font-size: 16px; font-weight: 600;">'.concat(e.topic,'</h3>\n                    <p style="margin: 0; color: #333333; font-size: 14px; line-height: 1.6;">\n                      ').concat(e.description,"\n                    </p>\n                  </div>\n                ")).join(""),"\n              </div>\n              "):"","\n              \n              ").concat(i&&s.divergenceAreas&&s.divergenceAreas.length>0?'\n              <!-- Where Perspectives Differ -->\n              <div style="margin-bottom: 30px;">\n                <h2 style="margin: 0 0 10px 0; color: #000000; font-size: 18px; font-weight: 600;">Where Perspectives Differ</h2>\n                <p style="margin: 0 0 20px 0; color: #666666; font-size: 14px; font-style: italic;">\n                  These differences represent opportunities to create more comprehensive solutions:\n                </p>\n                '.concat(s.divergenceAreas.map(e=>'\n                  <div style="margin-bottom: 20px; padding: 15px; background-color: #fff3e0; border-left: 4px solid #ff9800; border-radius: 4px;">\n                    <h3 style="margin: 0 0 12px 0; color: #e65100; font-size: 16px; font-weight: 600;">'.concat(e.topic,"</h3>\n                    ").concat(e.viewpoints&&e.viewpoints.map(e=>'\n                      <div style="margin-bottom: 10px; padding: 10px; background-color: white; border-radius: 4px;">\n                        <strong style="color: #333333; font-size: 13px;">'.concat(e.label," (").concat(e.percentage,'% of team):</strong>\n                        <p style="margin: 5px 0 0 0; color: #666666; font-size: 13px; line-height: 1.5;">\n                          ').concat(e.description,"\n                        </p>\n                      </div>\n                    ")).join(""),"\n                  </div>\n                ")).join(""),"\n              </div>\n              "):"","\n              \n              ").concat(!i&&s.insights&&s.insights.length>0?'\n              <!-- Key Insights (Internal) -->\n              <div style="margin-bottom: 30px;">\n                <h2 style="margin: 0 0 15px 0; color: #000000; font-size: 18px; font-weight: 600;">Key Insights</h2>\n                <ul style="margin: 0; padding-left: 20px; color: #333333;">\n                  '.concat(s.insights.map(e=>'\n                    <li style="margin-bottom: 10px; font-size: 14px; line-height: 1.6;">'.concat(e,"</li>\n                  ")).join(""),"\n                </ul>\n              </div>\n              "):"","\n              \n              ").concat(!i&&s.trends&&s.trends.length>0?'\n              <!-- Trends & Patterns (Internal) -->\n              <div style="margin-bottom: 30px;">\n                <h2 style="margin: 0 0 15px 0; color: #000000; font-size: 18px; font-weight: 600;">Trends & Patterns</h2>\n                <ul style="margin: 0; padding-left: 20px; color: #333333;">\n                  '.concat(s.trends.map(e=>'\n                    <li style="margin-bottom: 10px; font-size: 14px; line-height: 1.6;">'.concat(e,"</li>\n                  ")).join(""),"\n                </ul>\n              </div>\n              "):"","\n              \n              ").concat(s.recommendations&&s.recommendations.length>0&&!i?'\n              <!-- Recommendations (Internal Only) -->\n              <div style="margin-bottom: 30px; padding: 20px; background-color: #f8f9fa; border-radius: 4px;">\n                <h2 style="margin: 0 0 15px 0; color: #000000; font-size: 18px; font-weight: 600;">Recommendations</h2>\n                <ol style="margin: 0; padding-left: 20px; color: #333333;">\n                  '.concat(s.recommendations.map(e=>'\n                    <li style="margin-bottom: 10px; font-size: 14px; line-height: 1.6; font-weight: 500;">'.concat(e,"</li>\n                  ")).join(""),"\n                </ol>\n              </div>\n              "):"","\n              \n              ").concat(s.synthesis&&i?'\n              <!-- Synthesis & Path Forward -->\n              <div style="margin-bottom: 30px; padding: 20px; background-color: #e8f4fd; border-radius: 4px; border-left: 4px solid #0066cc;">\n                <h2 style="margin: 0 0 20px 0; color: #000000; font-size: 18px; font-weight: 600;">Synthesis & Path Forward</h2>\n                <div style="color: #333333; font-size: 14px; line-height: 1.7;">\n                  '.concat(function(e){if(!e)return"";let t="";return e.split("\n\n").forEach(e=>{if(e.trim()){if(e.includes("**")&&e.includes(":**")){let s=e.replace(/\*\*([^:]+):\*\*/g,'<strong style="color: #0066cc; display: block; margin-bottom: 8px;">$1:</strong>').replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>");t+='<div style="margin: 0 0 16px 0;">'.concat(s,"</div>")}else if(e.match(/^\d+\./m)){let s=e.split("\n").filter(e=>e.trim());t+='<ol style="margin: 0 0 16px 0; padding-left: 24px;">',s.forEach(e=>{let s=e.replace(/^\d+\.\s*/,"").trim();s&&(t+='<li style="margin-bottom: 8px; line-height: 1.6;">'.concat(s,"</li>"))}),t+="</ol>"}else{let s=e.replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>");t+='<p style="margin: 0 0 16px 0; line-height: 1.6;">'.concat(s,"</p>")}}}),t}(s.synthesis),"\n                </div>\n              </div>\n              "):"","\n              \n              ").concat(s.statistics&&Object.keys(s.statistics).length>0?'\n              <!-- Statistics -->\n              <div style="margin-bottom: 30px;">\n                <h2 style="margin: 0 0 15px 0; color: #000000; font-size: 18px; font-weight: 600;">Response Statistics</h2>\n                <table role="presentation" cellspacing="0" cellpadding="0" border="0" width="100%">\n                  '.concat(void 0!==s.statistics.totalResponses?'\n                  <tr>\n                    <td style="padding: 8px 0; color: #666666; font-size: 14px;">Total Responses:</td>\n                    <td style="padding: 8px 0; color: #000000; font-size: 14px; font-weight: 600; text-align: right;">'.concat(s.statistics.totalResponses,"</td>\n                  </tr>\n                  "):"","\n                  ").concat(void 0!==s.statistics.completionRate?'\n                  <tr>\n                    <td style="padding: 8px 0; color: #666666; font-size: 14px;">Completion Rate:</td>\n                    <td style="padding: 8px 0; color: #000000; font-size: 14px; font-weight: 600; text-align: right;">'.concat(s.statistics.completionRate,"%</td>\n                  </tr>\n                  "):"","\n                  ").concat(void 0!==s.statistics.averageTime?'\n                  <tr>\n                    <td style="padding: 8px 0; color: #666666; font-size: 14px;">Average Time:</td>\n                    <td style="padding: 8px 0; color: #000000; font-size: 14px; font-weight: 600; text-align: right;">'.concat(s.statistics.averageTime,"</td>\n                  </tr>\n                  "):"","\n                </table>\n              </div>\n              "):"",'\n              \n              <!-- Closing -->\n              <div style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #e0e0e0;">\n                ').concat(i?'\n                  <p style="margin: 0 0 20px 0; color: #666666; font-size: 14px; line-height: 1.6;">\n                    This analysis represents the collective input from all participants. We appreciate your contribution to this collaborative process.\n                  </p>\n                  <p style="margin: 0 0 20px 0; color: #666666; font-size: 14px; line-height: 1.6;">\n                    If you have any questions about these findings or would like to discuss next steps, please don\'t hesitate to reach out to our team.\n                  </p>\n                ':'\n                  <p style="margin: 0 0 20px 0; color: #666666; font-size: 14px; line-height: 1.6;">\n                    For a more detailed analysis and to download the full report, please visit your dashboard.\n                  </p>\n                  <p style="margin: 0 0 20px 0; color: #666666; font-size: 14px; line-height: 1.6;">\n                    Thank you for using Aloa\xae Custom Forms. If you have any questions about this analysis, please don\'t hesitate to reach out.\n                  </p>\n                ','\n              </div>\n              \n              <p style="margin: 20px 0 0 0; color: #666666; font-size: 14px;">\n                Best regards,<br>\n                <strong>The Aloa\xae Team</strong>\n              </p>\n              \n            </td>\n          </tr>\n          \n          <!-- Footer -->\n          <tr>\n            <td style="padding: 30px; background-color: #f8f9fa; text-align: center; border-radius: 0 0 8px 8px;">\n              <p style="margin: 0 0 10px 0; color: #999999; font-size: 12px;">\n                This report was generated on ').concat(new Date().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),'\n              </p>\n              <p style="margin: 0; color: #999999; font-size: 12px;">\n                \xa9 ').concat(new Date().getFullYear()," Aloa\xae. All rights reserved.\n              </p>\n            </td>\n          </tr>\n          \n        </table>\n      </td>\n    </tr>\n  </table>\n</body>\n</html>\n  ")}function n(e){let t={summary:"",insights:[],trends:[],recommendations:[],synthesis:"",consensusAreas:[],divergenceAreas:[],statistics:{}};if(!e)return t;if(console.log("Parsing analysis text for email:",e.substring(0,500)),e.split(/##\s+/).forEach(e=>{let s=e.trim().split("\n"),a=s[0].toLowerCase(),n=s.slice(1).join("\n").trim();if(a.includes("summary")||a.includes("overview"))t.summary=n.replace(/^[-•*]\s*/gm,"").trim();else if(a.includes("strongly agree")||a.includes("team agrees")||a.includes("where your team strongly agrees"))n.split(/###\s+/).filter(Boolean).forEach(e=>{let s=e.trim().split("\n");if(s.length>0){let e=s[0].trim(),a=s.slice(1).join(" ").replace(/\*[^*]+\*/g,"").trim();e&&a&&t.consensusAreas.push({topic:e,description:a})}});else if(a.includes("differ")||a.includes("diverge")||a.includes("where perspectives differ"))n.split(/###\s+/).filter(Boolean).forEach(e=>{let s=e.trim().split("\n");if(s.length>0){let e=s[0].trim(),a=[];s.forEach(e=>{let t=e.match(/\*\*(.+?)\s*\(([\d.]+)%[^)]*\):\*\*\s*(.+)/);t&&a.push({label:t[1].trim(),percentage:t[2],description:t[3].trim()})}),e&&a.length>0&&t.divergenceAreas.push({topic:e,viewpoints:a})}});else if(a.includes("insight")||a.includes("finding")){let e=n.split(/^[-•*]\s+/m).filter(Boolean);t.insights=e.map(e=>e.trim())}else if(a.includes("trend")||a.includes("pattern")){let e=n.split(/^[-•*]\s+/m).filter(Boolean);t.trends=e.map(e=>e.trim())}else if(a.includes("recommend")||a.includes("suggestion")){let e=n.split(/^[\d.]+\s+/m).filter(Boolean);t.recommendations=e.map(e=>e.trim())}else a.includes("synthesis")||a.includes("path forward")?t.synthesis=n.replace(/^[-•*]\s*/gm,"").trim():(a.includes("statistic")||a.includes("metric"))&&n.split("\n").forEach(e=>{if(e.includes("Total")&&e.includes("Response")){let s=e.match(/\d+/);s&&(t.statistics.totalResponses=parseInt(s[0]))}if(e.includes("Completion")&&e.includes("Rate")){let s=e.match(/(\d+(?:\.\d+)?)\s*%/);s&&(t.statistics.completionRate=parseFloat(s[1]))}if(e.includes("Average")&&e.includes("Time")){let s=e.match(/(\d+(?:\.\d+)?)\s*(minute|second|hour)/i);s&&(t.statistics.averageTime="".concat(s[1]," ").concat(s[2],"s"))}if(e.includes("overall alignment")){let s=e.match(/(\d+(?:\.\d+)?)\s*%/);s&&(t.statistics.consensusScore=parseFloat(s[1]))}})}),!t.summary&&0===t.insights.length&&0===t.trends.length){let s=e.split(/\n\n+/);s.length>0&&(t.summary=s[0].replace(/^#\s+/,"").trim())}return t}function i(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=!(arguments.length>3)||void 0===arguments[3]||arguments[3],i=a(e,t,s,n);return{html:i,preview:{subject:"".concat(n?"Your Input Summary":"AI Analysis Report",": ").concat(e),greeting:s?"Dear ".concat(s,","):"Hello,",isClientFacing:n,sections:function(e){let t=[];return e.includes("Executive Summary")&&t.push("Executive Summary"),e.includes("Key Insights")&&t.push("Key Insights"),e.includes("Areas of Divergence")&&t.push("Areas of Divergence"),e.includes("Synthesis & Path Forward")&&t.push("Synthesis & Path Forward"),e.includes("Recommendations")&&t.push("Recommendations"),e.includes("Response Statistics")&&t.push("Response Statistics"),t}(i)}}}s.r(t),s.d(t,{generateAnalysisEmailHTML:function(){return a},generateEmailPreview:function(){return i}})},1013:function(e,t,s){"use strict";s.d(t,{e:function(){return i}});var a=s(2990);let n=null;function i(){if(n)return n;let e="https://eycgzjqwowrdmjlzqqyg.supabase.co",t="sb_publishable_eG0lH_ACpyOjqG44mN_5PA_1-oFLr5n";if(console.log("Creating Supabase browser client with:",{url:e,keyPrefix:t?t.substring(0,20)+"...":"NO KEY"}),!e||!t)throw console.error("Missing Supabase environment variables"),Error("Supabase configuration is missing");return n=(0,a.createBrowserClient)(e,t)}},6858:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9205).Z)("arrow-right",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]])},4972:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9205).Z)("brain",[["path",{d:"M12 18V5",key:"adv99a"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4",key:"1e3is1"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5",key:"1gqd8o"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77",key:"iwvgf7"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464",key:"efp6ie"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517",key:"1gq6am"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464",key:"k1g0md"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77",key:"q97ue3"}]])},9322:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9205).Z)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},1671:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9205).Z)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},2735:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9205).Z)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]])},9345:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9205).Z)("mail",[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]])},7168:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9205).Z)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},2023:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9205).Z)("sparkles",[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]])},525:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9205).Z)("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]])},5805:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9205).Z)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]])}},function(e){e.O(0,[346,64,846,971,117,744],function(){return e(e.s=5570)}),_N_E=e.O()}]);