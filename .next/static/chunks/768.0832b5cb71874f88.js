"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[768],{5768:function(e,a,l){l.r(a),l.d(a,{default:function(){return x}});var s=l(7437),t=l(2265);l(6475),l(4924);var i=l(2489),r=l(7689),o=l(9322),n=l(401),d=l(3229),c=l(9064),p=l(8439);let u="https://eycgzjqwowrdmjlzqqyg.supabase.co",g="sb_publishable_eG0lH_ACpyOjqG44mN_5PA_1-oFLr5n",m=null;u&&g?m=(0,p.eI)(u,g):console.error("Warning: Supabase environment variables are missing");let f="Aloa Project Tracker Bucket";function x(e){var a,l,p,u,g,x,h;let{projectId:y,projectletId:b,applet:v,onClose:j}=e,[_,w]=(0,t.useState)({heading:(null===(a=v.config)||void 0===a?void 0:a.heading)||"File Uploads",description:(null===(l=v.config)||void 0===l?void 0:l.description)||"Upload and share project files",files:(null===(p=v.config)||void 0===p?void 0:p.files)||[],category:(null===(u=v.config)||void 0===u?void 0:u.category)||"general",allow_client_upload:(null===(g=v.config)||void 0===g?void 0:g.allow_client_upload)||!1,max_file_size:(null===(x=v.config)||void 0===x?void 0:x.max_file_size)||100,allowed_file_types:(null===(h=v.config)||void 0===h?void 0:h.allowed_file_types)||["pdf","doc","docx","jpg","jpeg","png","zip","mp4","mov","ai","psd","sketch","fig"]}),[N,k]=(0,t.useState)(!1),[D,C]=(0,t.useState)(0),[z,F]=(0,t.useState)(!1),[S,Z]=(0,t.useState)(!1),[M,P]=(0,t.useState)(!1);(0,t.useEffect)(()=>{var e,a,l,s,t,i,r;let o={heading:(null===(e=v.config)||void 0===e?void 0:e.heading)||"File Uploads",description:(null===(a=v.config)||void 0===a?void 0:a.description)||"Upload and share project files",files:(null===(l=v.config)||void 0===l?void 0:l.files)||[],category:(null===(s=v.config)||void 0===s?void 0:s.category)||"general",allow_client_upload:(null===(t=v.config)||void 0===t?void 0:t.allow_client_upload)||!1,max_file_size:(null===(i=v.config)||void 0===i?void 0:i.max_file_size)||100,allowed_file_types:(null===(r=v.config)||void 0===r?void 0:r.allowed_file_types)||["pdf","doc","docx","jpg","jpeg","png","zip","mp4","mov","ai","psd","sketch","fig"]},n=JSON.stringify(_)!==JSON.stringify(o);P(n),n&&Z(!1)},[_,v.config]);let B=async e=>{let a=e.target.files[0];if(!a)return;if(a.size/1048576>_.max_file_size){c.ZP.error("File size exceeds ".concat(_.max_file_size,"MB limit"));return}let l=a.name.split(".").pop().toLowerCase();if(!_.allowed_file_types.includes(l)){c.ZP.error("File type .".concat(l," is not allowed"));return}k(!0),C(0);try{let e={};if(a.size<=5242880){let l=new FileReader,s=new Promise((e,a)=>{l.onload=()=>e(l.result),l.onerror=a});l.readAsDataURL(a);let t=await s;e={id:Date.now().toString(),name:a.name,size:a.size,type:a.type,data:t,storage_type:"base64",uploaded_at:new Date().toISOString(),uploaded_by:"admin"},C(100)}else{let l=Date.now(),s=a.name.replace(/[^a-zA-Z0-9.-]/g,"_"),t="projects/".concat(y,"/").concat(_.category,"/").concat(l,"_").concat(s),{data:i,error:r}=await m.storage.from(f).upload(t,a,{onUploadProgress:e=>{let a=e.loaded/e.total*100;C(Math.round(a))}});if(r)throw r.message.includes("bucket")?c.ZP.error("Storage bucket not configured. Please contact admin."):c.ZP.error("Upload failed: ".concat(r.message)),r;let{data:o}=m.storage.from(f).getPublicUrl(t);e={id:Date.now().toString(),name:a.name,size:a.size,type:a.type,storage_path:t,storage_type:"supabase",url:o.publicUrl,uploaded_at:new Date().toISOString(),uploaded_by:"admin",category:_.category};try{await fetch("/api/project-files",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({project_id:y,projectlet_id:b,applet_id:v.id,file_name:a.name,file_size:a.size,file_type:a.type,storage_path:t,category:_.category,uploaded_by:"admin"})})}catch(e){console.log("Database logging skipped:",e)}}w(a=>({...a,files:[...a.files,e]})),c.ZP.success("File uploaded successfully ".concat(a.size>5242880?"(stored in cloud)":"(stored locally)"))}catch(e){console.error("Error uploading file:",e),c.ZP.error("Failed to upload file")}finally{k(!1),C(0)}},U=async e=>{let a=_.files.find(a=>a.id===e);if(a&&"supabase"===a.storage_type&&a.storage_path)try{await m.storage.from(f).remove([a.storage_path])}catch(e){console.error("Error deleting file from storage:",e)}w(a=>({...a,files:a.files.filter(a=>a.id!==e)})),c.ZP.success("File removed")},A=async()=>{F(!0);try{if(!(await fetch("/api/aloa-projects/".concat(y,"/projectlets/").concat(b,"/applets/").concat(v.id),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({config:_})})).ok)throw Error("Failed to save");P(!1),Z(!0),c.ZP.success("File upload configuration saved"),setTimeout(()=>Z(!1),3e3)}catch(e){console.error("Error saving configuration:",e),c.ZP.error("Failed to save configuration")}finally{F(!1)}},E=e=>{if(0===e)return"0 Bytes";let a=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,a)*100)/100+" "+["Bytes","KB","MB","GB"][a]},O=e=>{let a=e.split(".").pop().toLowerCase();return["jpg","jpeg","png","gif","svg"].includes(a)?"\uD83D\uDDBC️":["pdf","doc","docx","txt"].includes(a)?"\uD83D\uDCC4":["mp4","mov","avi","webm"].includes(a)?"\uD83C\uDFAC":["ai","psd","sketch","fig","xd"].includes(a)?"\uD83C\uDFA8":"zip"===a||"rar"===a?"\uD83D\uDCE6":"\uD83D\uDCCE"};return(0,s.jsx)("div",{className:"bg-gray-50 border-2 border-gray-200 rounded-lg p-4 mt-2",children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsx)("h4",{className:"font-semibold text-gray-900",children:"File Upload Configuration"}),(0,s.jsx)("button",{onClick:j,className:"p-1 hover:bg-gray-200 rounded",children:(0,s.jsx)(i.Z,{className:"w-4 h-4"})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"File Category"}),(0,s.jsxs)("select",{value:_.category,onChange:e=>w(a=>({...a,category:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-black",children:[(0,s.jsx)("option",{value:"general",children:"General Files"}),(0,s.jsx)("option",{value:"final-deliverables",children:"Final Deliverables"}),(0,s.jsx)("option",{value:"work-in-progress",children:"Work in Progress"})]}),"final-deliverables"===_.category&&(0,s.jsx)("p",{className:"text-xs text-green-600 mt-1",children:"✨ Files marked as Final Deliverables will be prominently displayed to clients"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Heading"}),(0,s.jsx)("input",{type:"text",value:_.heading,onChange:e=>w(a=>({...a,heading:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-black",placeholder:"e.g., Style Guide, Brand Assets, Final Designs"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),(0,s.jsx)("textarea",{value:_.description,onChange:e=>w(a=>({...a,description:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-black",rows:2,placeholder:"Describe what files are being shared..."})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Uploaded Files"}),_.files.length>0&&(0,s.jsx)("div",{className:"space-y-2 mb-3",children:_.files.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-2 bg-white border rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("span",{className:"text-xl",children:O(e.name)}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium",children:e.name}),(0,s.jsxs)("p",{className:"text-xs text-gray-500",children:[E(e.size)," • Uploaded ",new Date(e.uploaded_at).toLocaleDateString(),"supabase"===e.storage_type&&(0,s.jsx)("span",{className:"ml-2 text-blue-600",children:"☁️ Cloud"})]})]})]}),(0,s.jsx)("button",{onClick:()=>U(e.id),className:"p-1 hover:bg-red-50 rounded text-red-600",children:(0,s.jsx)(i.Z,{className:"w-4 h-4"})})]},e.id))}),(0,s.jsxs)("label",{className:"relative",children:[(0,s.jsx)("input",{type:"file",onChange:B,accept:_.allowed_file_types.map(e=>".".concat(e)).join(","),className:"hidden",disabled:N}),(0,s.jsx)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center cursor-pointer hover:border-gray-400 transition-colors",children:N?(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-gray-600"}),(0,s.jsx)("span",{className:"text-sm text-gray-600",children:"Uploading..."})]}),D>0&&(0,s.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,s.jsx)("div",{className:"bg-black h-2 rounded-full transition-all duration-300",style:{width:"".concat(D,"%")}})})]}):(0,s.jsxs)("div",{className:"flex flex-col items-center space-y-2",children:[(0,s.jsx)(r.Z,{className:"w-8 h-8 text-gray-400"}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Click to upload file"}),(0,s.jsxs)("p",{className:"text-xs text-gray-500",children:["Max ",_.max_file_size,"MB • Supports large files (PDFs, videos, design files)"]}),(0,s.jsx)("p",{className:"text-xs text-gray-400",children:_.allowed_file_types.join(", ")})]})})]})]}),(0,s.jsxs)("div",{className:"space-y-3 border-t pt-3",children:[(0,s.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,s.jsx)("input",{type:"checkbox",checked:_.allow_client_upload,onChange:e=>w(a=>({...a,allow_client_upload:e.target.checked})),className:"rounded border-gray-300"}),(0,s.jsx)("span",{className:"text-sm text-gray-700",children:"Allow clients to upload files"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Max File Size (MB)"}),(0,s.jsx)("input",{type:"number",value:_.max_file_size,onChange:e=>w(a=>({...a,max_file_size:parseInt(e.target.value)||100})),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded",min:"1",max:"200"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Allowed File Types"}),(0,s.jsx)("input",{type:"text",value:_.allowed_file_types.join(", "),onChange:e=>w(a=>({...a,allowed_file_types:e.target.value.split(",").map(e=>e.trim()).filter(Boolean)})),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded",placeholder:"pdf, jpg, png, mp4, ai, psd"})]})]}),(0,s.jsx)("div",{className:"text-xs text-gray-500 bg-gray-100 p-2 rounded",children:"\uD83D\uDCA1 Files under 5MB are stored securely in the database. Larger files (up to 200MB) are stored in cloud storage for optimal performance."})]}),(0,s.jsxs)("div",{className:"flex justify-end items-center space-x-2 pt-2 border-t",children:[M&&!S&&(0,s.jsxs)("span",{className:"text-xs text-amber-600 flex items-center",children:[(0,s.jsx)(o.Z,{className:"w-3 h-3 mr-1"}),"Unsaved changes"]}),S&&(0,s.jsxs)("span",{className:"text-xs text-green-600 flex items-center",children:[(0,s.jsx)(n.Z,{className:"w-3 h-3 mr-1"}),"Saved"]}),(0,s.jsxs)("button",{onClick:A,disabled:!M||z,className:"px-4 py-2 rounded-lg font-medium transition-colors flex items-center space-x-2 ".concat(M?"bg-black text-white hover:bg-gray-800":"bg-gray-200 text-gray-400 cursor-not-allowed"),children:[(0,s.jsx)(d.Z,{className:"w-4 h-4"}),(0,s.jsx)("span",{children:z?"Saving...":"Save Changes"})]})]})]})})}},401:function(e,a,l){l.d(a,{Z:function(){return s}});let s=(0,l(9205).Z)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},4924:function(e,a,l){l.d(a,{Z:function(){return s}});let s=(0,l(9205).Z)("folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]])},3229:function(e,a,l){l.d(a,{Z:function(){return s}});let s=(0,l(9205).Z)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]])}}]);