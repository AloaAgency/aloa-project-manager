"use strict";(()=>{var e={};e.id=4078,e.ids=[4078],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},71568:e=>{e.exports=require("zlib")},56369:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>_,patchFetch:()=>g,requestAsyncStorage:()=>u,routeModule:()=>d,serverHooks:()=>m,staticGenerationAsyncStorage:()=>j});var o={};r.r(o),r.d(o,{GET:()=>l,PATCH:()=>c});var s=r(49303),a=r(88716),n=r(60670),i=r(87070),p=r(76995);async function l(e,{params:t}){try{let{projectId:e}=t,{data:r,error:o}=await p.O.from("aloa_projectlets").select(`
        *,
        aloa_project_forms (
          id,
          title,
          description,
          form_type,
          is_active,
          responses_required,
          responses_received
        )
      `).eq("project_id",e).order("sequence_order",{ascending:!0});if(o)return console.error("Error fetching projectlets:",o),i.NextResponse.json({error:"Failed to fetch projectlets"},{status:500});let s=r.length,a=r.filter(e=>"completed"===e.status).length;return i.NextResponse.json({projectlets:r,stats:{total:s,completed:a,inProgress:r.filter(e=>"in_progress"===e.status).length,available:r.filter(e=>"available"===e.status).length,locked:r.filter(e=>"locked"===e.status).length,completionPercentage:s>0?Math.round(a/s*100):0}})}catch(e){return console.error("Error in projectlets route:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}async function c(e,{params:t}){try{let{projectId:r}=t,{projectletId:o,status:s,metadata:a}=await e.json(),{data:n,error:l}=await p.O.from("aloa_projectlets").update({status:s,...a&&{metadata:a},..."completed"===s&&{completion_date:new Date().toISOString()}}).eq("id",o).eq("project_id",r).select().single();if(l)return console.error("Error updating projectlet:",l),i.NextResponse.json({error:"Failed to update projectlet"},{status:500});if("completed"===s){let{data:e}=await p.O.from("aloa_projectlets").select().eq("project_id",r).eq("status","locked").gt("sequence_order",n.sequence_order).order("sequence_order",{ascending:!0}).limit(1).single();e&&e.unlock_condition?.type==="previous_complete"&&(await p.O.from("aloa_projectlets").update({status:"available"}).eq("id",e.id),await p.O.from("aloa_project_timeline").insert([{project_id:r,projectlet_id:e.id,event_type:"projectlet_unlocked",description:`"${e.name}" is now available`,metadata:{previous_projectlet:n.name}}])),await p.O.from("aloa_project_timeline").insert([{project_id:r,projectlet_id:o,event_type:"projectlet_completed",description:`"${n.name}" completed`,metadata:{completion_date:new Date().toISOString()}}])}return i.NextResponse.json({success:!0,projectlet:n})}catch(e){return console.error("Error updating projectlet:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}let d=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/projects/[projectId]/projectlets/route",pathname:"/api/projects/[projectId]/projectlets",filename:"route",bundlePath:"app/api/projects/[projectId]/projectlets/route"},resolvedPagePath:"/Users/rosspalmer/Ross GitHub Projects/aloa-web-design-project-manager/app/api/projects/[projectId]/projectlets/route.js",nextConfigOutput:"",userland:o}),{requestAsyncStorage:u,staticGenerationAsyncStorage:j,serverHooks:m}=d,_="/api/projects/[projectId]/projectlets/route";function g(){return(0,n.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:j})}},76995:(e,t,r)=>{r.d(t,{O:()=>n});var o=r(69498);let s="https://eycgzjqwowrdmjlzqqyg.supabase.co",a="sb_publishable_eG0lH_ACpyOjqG44mN_5PA_1-oFLr5n",n=null;s&&a?n=(0,o.eI)(s,a):console.error("Warning: Supabase environment variables are missing")}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[9276,5972,9498],()=>r(56369));module.exports=o})();