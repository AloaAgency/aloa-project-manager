"use strict";(()=>{var e={};e.id=4871,e.ids=[4871],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},71568:e=>{e.exports=require("zlib")},6870:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>x,patchFetch:()=>E,requestAsyncStorage:()=>f,routeModule:()=>j,serverHooks:()=>m,staticGenerationAsyncStorage:()=>g});var o={};t.r(o),t.d(o,{GET:()=>u,POST:()=>l});var s=t(49303),a=t(88716),n=t(60670),i=t(87070),c=t(76995),p=t(40259);async function u(){try{if(!c.O)return console.log("Supabase is not configured. Returning empty projects array."),i.NextResponse.json([]);if(!await d())return console.log("Projects table does not exist yet. Please create it in Supabase."),i.NextResponse.json([]);let{data:e,error:r}=await c.O.from("aloa_projects").select(`
        *,
        aloa_forms(count)
      `).order("created_at",{ascending:!1});if(r)return console.error("Error fetching projects:",r),i.NextResponse.json([]);let t=(e||[]).map(e=>({...e,formCount:e.aloa_forms?.[0]?.count||0}));return i.NextResponse.json(t)}catch(e){return console.error("Error fetching projects:",e),i.NextResponse.json([])}}async function l(e){try{if(!c.O)return i.NextResponse.json({error:"Database is not configured"},{status:503});let{name:r,description:t}=await e.json();if(!r)return i.NextResponse.json({error:"Project name is required"},{status:400});if(!await d())return i.NextResponse.json({error:"Projects table does not exist. Please create it in Supabase first."},{status:503});let o={id:(0,p.x0)(),name:r,description:t||"",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{data:s,error:a}=await c.O.from("aloa_projects").insert([o]).select().single();if(a)throw a;return i.NextResponse.json(s)}catch(e){return console.error("Error creating project:",e),i.NextResponse.json({error:"Failed to create project"},{status:500})}}async function d(){try{if(!c.O)return!1;let{error:e}=await c.O.from("aloa_projects").select("id").limit(1);if(e&&"42P01"===e.code)return console.log("Projects table needs to be created in Supabase"),console.log(`
        CREATE TABLE aloa_projects (
          id TEXT PRIMARY KEY,
          name TEXT NOT NULL,
          description TEXT,
          created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
          updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
        );
        
        ALTER TABLE aloa_forms ADD COLUMN IF NOT EXISTS project_id TEXT REFERENCES aloa_projects(id);
      `),!1;return!0}catch(e){return console.error("Error checking projects table:",e),!1}}let j=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/projects/route",pathname:"/api/projects",filename:"route",bundlePath:"app/api/projects/route"},resolvedPagePath:"/Users/rosspalmer/Ross GitHub Projects/aloa-web-design-project-manager/app/api/projects/route.js",nextConfigOutput:"",userland:o}),{requestAsyncStorage:f,staticGenerationAsyncStorage:g,serverHooks:m}=j,x="/api/projects/route";function E(){return(0,n.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:g})}},76995:(e,r,t)=>{t.d(r,{O:()=>n});var o=t(69498);let s="https://eycgzjqwowrdmjlzqqyg.supabase.co",a="sb_publishable_eG0lH_ACpyOjqG44mN_5PA_1-oFLr5n",n=null;s&&a?n=(0,o.eI)(s,a):console.error("Warning: Supabase environment variables are missing")},40259:(e,r,t)=>{let o,s;t.d(r,{x0:()=>n});let a=require("node:crypto");function n(e=21){var r;r=e|=0,!o||o.length<r?(o=Buffer.allocUnsafe(128*r),a.webcrypto.getRandomValues(o),s=0):s+r>o.length&&(a.webcrypto.getRandomValues(o),s=0),s+=r;let t="";for(let r=s-e;r<s;r++)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&o[r]];return t}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[9276,5972,9498],()=>t(6870));module.exports=o})();