"use strict";(()=>{var e={};e.id=6115,e.ids=[6115],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},71568:e=>{e.exports=require("zlib")},22917:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>m,patchFetch:()=>x,requestAsyncStorage:()=>j,routeModule:()=>f,serverHooks:()=>g,staticGenerationAsyncStorage:()=>_});var o={};t.r(o),t.d(o,{DELETE:()=>u,GET:()=>c,PATCH:()=>d,POST:()=>p});var s=t(49303),a=t(88716),i=t(60670),n=t(87070),l=t(76995);async function p(e){try{let r=await e.json(),{data:t,error:o}=await l.O.from("project_files").insert([{project_id:r.project_id,projectlet_id:r.projectlet_id,applet_id:r.applet_id,file_name:r.file_name,file_size:r.file_size,file_type:r.file_type,storage_path:r.storage_path,category:r.category||"general",is_public:r.is_public||!1,requires_auth:!1!==r.requires_auth,uploaded_by:r.uploaded_by||"admin",description:r.description,tags:r.tags||[],metadata:r.metadata||{}}]).select().single();if(o)return console.error("Error creating project file record:",o),n.NextResponse.json({error:"Failed to create file record"},{status:500});return n.NextResponse.json({file:t})}catch(e){return console.error("Error in project files route:",e),n.NextResponse.json({error:"Internal server error"},{status:500})}}async function c(e){try{let{searchParams:r}=new URL(e.url),t=r.get("project_id"),o=r.get("category"),s=l.O.from("project_files").select("*").eq("is_latest",!0).order("uploaded_at",{ascending:!1});t&&(s=s.eq("project_id",t)),o&&(s=s.eq("category",o));let{data:a,error:i}=await s;if(i)return console.error("Error fetching project files:",i),n.NextResponse.json({error:"Failed to fetch files"},{status:500});return n.NextResponse.json({files:a||[]})}catch(e){return console.error("Error in project files route:",e),n.NextResponse.json({error:"Internal server error"},{status:500})}}async function u(e){try{let{searchParams:r}=new URL(e.url),t=r.get("id"),o=r.get("storage_path");if(!t)return n.NextResponse.json({error:"File ID required"},{status:400});if(o)try{let{error:e}=await l.O.storage.from("project-files").remove([o]);e&&console.error("Storage deletion error:",e)}catch(e){console.error("Storage deletion failed:",e)}let{error:s}=await l.O.from("project_files").delete().eq("id",t);if(s)return console.error("Error deleting project file:",s),n.NextResponse.json({error:"Failed to delete file"},{status:500});return n.NextResponse.json({success:!0})}catch(e){return console.error("Error in project files route:",e),n.NextResponse.json({error:"Internal server error"},{status:500})}}async function d(e){try{let{id:r,increment_download:t}=await e.json();if(!r)return n.NextResponse.json({error:"File ID required"},{status:400});let o={last_accessed:new Date().toISOString()};if(t){let{data:e}=await l.O.from("project_files").select("download_count").eq("id",r).single();o.download_count=(e?.download_count||0)+1}let{data:s,error:a}=await l.O.from("project_files").update(o).eq("id",r).select().single();if(a)return console.error("Error updating project file:",a),n.NextResponse.json({error:"Failed to update file"},{status:500});return n.NextResponse.json({file:s})}catch(e){return console.error("Error in project files route:",e),n.NextResponse.json({error:"Internal server error"},{status:500})}}let f=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/project-files/route",pathname:"/api/project-files",filename:"route",bundlePath:"app/api/project-files/route"},resolvedPagePath:"/Users/rosspalmer/Ross GitHub Projects/aloa-web-design-project-manager/app/api/project-files/route.js",nextConfigOutput:"",userland:o}),{requestAsyncStorage:j,staticGenerationAsyncStorage:_,serverHooks:g}=f,m="/api/project-files/route";function x(){return(0,i.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:_})}},76995:(e,r,t)=>{t.d(r,{O:()=>i});var o=t(69498);let s="https://eycgzjqwowrdmjlzqqyg.supabase.co",a="sb_publishable_eG0lH_ACpyOjqG44mN_5PA_1-oFLr5n",i=null;s&&a?i=(0,o.eI)(s,a):console.error("Warning: Supabase environment variables are missing")}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[9276,5972,9498],()=>t(22917));module.exports=o})();