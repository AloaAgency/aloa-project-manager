"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/project-files/route";
exports.ids = ["app/api/project-files/route"];
exports.modules = {

/***/ "../../client/components/action-async-storage.external":
/*!*******************************************************************************!*\
  !*** external "next/dist/client/components/action-async-storage.external.js" ***!
  \*******************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/action-async-storage.external.js");

/***/ }),

/***/ "../../client/components/request-async-storage.external":
/*!********************************************************************************!*\
  !*** external "next/dist/client/components/request-async-storage.external.js" ***!
  \********************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/request-async-storage.external.js");

/***/ }),

/***/ "../../client/components/static-generation-async-storage.external":
/*!******************************************************************************************!*\
  !*** external "next/dist/client/components/static-generation-async-storage.external.js" ***!
  \******************************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/static-generation-async-storage.external.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("punycode");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fproject-files%2Froute&page=%2Fapi%2Fproject-files%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fproject-files%2Froute.js&appDir=%2FUsers%2Frosspalmer%2FRoss%20GitHub%20Projects%2Faloa-web-design-project-manager%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Frosspalmer%2FRoss%20GitHub%20Projects%2Faloa-web-design-project-manager&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fproject-files%2Froute&page=%2Fapi%2Fproject-files%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fproject-files%2Froute.js&appDir=%2FUsers%2Frosspalmer%2FRoss%20GitHub%20Projects%2Faloa-web-design-project-manager%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Frosspalmer%2FRoss%20GitHub%20Projects%2Faloa-web-design-project-manager&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_rosspalmer_Ross_GitHub_Projects_aloa_web_design_project_manager_app_api_project_files_route_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/project-files/route.js */ \"(rsc)/./app/api/project-files/route.js\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/project-files/route\",\n        pathname: \"/api/project-files\",\n        filename: \"route\",\n        bundlePath: \"app/api/project-files/route\"\n    },\n    resolvedPagePath: \"/Users/rosspalmer/Ross GitHub Projects/aloa-web-design-project-manager/app/api/project-files/route.js\",\n    nextConfigOutput,\n    userland: _Users_rosspalmer_Ross_GitHub_Projects_aloa_web_design_project_manager_app_api_project_files_route_js__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/project-files/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZwcm9qZWN0LWZpbGVzJTJGcm91dGUmcGFnZT0lMkZhcGklMkZwcm9qZWN0LWZpbGVzJTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGcHJvamVjdC1maWxlcyUyRnJvdXRlLmpzJmFwcERpcj0lMkZVc2VycyUyRnJvc3NwYWxtZXIlMkZSb3NzJTIwR2l0SHViJTIwUHJvamVjdHMlMkZhbG9hLXdlYi1kZXNpZ24tcHJvamVjdC1tYW5hZ2VyJTJGYXBwJnBhZ2VFeHRlbnNpb25zPXRzeCZwYWdlRXh0ZW5zaW9ucz10cyZwYWdlRXh0ZW5zaW9ucz1qc3gmcGFnZUV4dGVuc2lvbnM9anMmcm9vdERpcj0lMkZVc2VycyUyRnJvc3NwYWxtZXIlMkZSb3NzJTIwR2l0SHViJTIwUHJvamVjdHMlMkZhbG9hLXdlYi1kZXNpZ24tcHJvamVjdC1tYW5hZ2VyJmlzRGV2PXRydWUmdHNjb25maWdQYXRoPXRzY29uZmlnLmpzb24mYmFzZVBhdGg9JmFzc2V0UHJlZml4PSZuZXh0Q29uZmlnT3V0cHV0PSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDYztBQUNxRDtBQUNsSTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsZ0hBQW1CO0FBQzNDO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLGlFQUFpRTtBQUN6RTtBQUNBO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ3VIOztBQUV2SCIsInNvdXJjZXMiOlsid2VicGFjazovL2Fsb2EtcHJvamVjdC1tYW5hZ2VyLz9jNjM3Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcFJvdXRlUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi9Vc2Vycy9yb3NzcGFsbWVyL1Jvc3MgR2l0SHViIFByb2plY3RzL2Fsb2Etd2ViLWRlc2lnbi1wcm9qZWN0LW1hbmFnZXIvYXBwL2FwaS9wcm9qZWN0LWZpbGVzL3JvdXRlLmpzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcIlwiXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBBcHBSb3V0ZVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9wcm9qZWN0LWZpbGVzL3JvdXRlXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvcHJvamVjdC1maWxlc1wiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvcHJvamVjdC1maWxlcy9yb3V0ZVwiXG4gICAgfSxcbiAgICByZXNvbHZlZFBhZ2VQYXRoOiBcIi9Vc2Vycy9yb3NzcGFsbWVyL1Jvc3MgR2l0SHViIFByb2plY3RzL2Fsb2Etd2ViLWRlc2lnbi1wcm9qZWN0LW1hbmFnZXIvYXBwL2FwaS9wcm9qZWN0LWZpbGVzL3JvdXRlLmpzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MgfSA9IHJvdXRlTW9kdWxlO1xuY29uc3Qgb3JpZ2luYWxQYXRobmFtZSA9IFwiL2FwaS9wcm9qZWN0LWZpbGVzL3JvdXRlXCI7XG5mdW5jdGlvbiBwYXRjaEZldGNoKCkge1xuICAgIHJldHVybiBfcGF0Y2hGZXRjaCh7XG4gICAgICAgIHNlcnZlckhvb2tzLFxuICAgICAgICBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlXG4gICAgfSk7XG59XG5leHBvcnQgeyByb3V0ZU1vZHVsZSwgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIG9yaWdpbmFsUGF0aG5hbWUsIHBhdGNoRmV0Y2gsICB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAtcm91dGUuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fproject-files%2Froute&page=%2Fapi%2Fproject-files%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fproject-files%2Froute.js&appDir=%2FUsers%2Frosspalmer%2FRoss%20GitHub%20Projects%2Faloa-web-design-project-manager%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Frosspalmer%2FRoss%20GitHub%20Projects%2Faloa-web-design-project-manager&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/project-files/route.js":
/*!****************************************!*\
  !*** ./app/api/project-files/route.js ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DELETE: () => (/* binding */ DELETE),\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   PATCH: () => (/* binding */ PATCH),\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n/* harmony import */ var next_headers__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/headers */ \"(rsc)/./node_modules/next/dist/api/headers.js\");\n\n\n\n// Initialize Supabase service client\nconst supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_2__.createClient)(\"https://eycgzjqwowrdmjlzqqyg.supabase.co\", process.env.SUPABASE_SECRET_KEY // Using service key to bypass RLS\n);\n// POST - Create new project file record, upload file, or create folder\nasync function POST(request) {\n    try {\n        const contentType = request.headers.get(\"content-type\");\n        // Handle folder creation with JSON\n        if (contentType?.includes(\"application/json\")) {\n            const { project_id, file_name, is_folder, parent_folder_id, uploaded_by } = await request.json();\n            if (!project_id || !file_name) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: \"Project ID and name are required\"\n                }, {\n                    status: 400\n                });\n            }\n            if (is_folder) {\n                // Create folder record\n                const { data: folderRecord, error: folderError } = await supabase.from(\"aloa_project_files\").insert([\n                    {\n                        project_id,\n                        file_name,\n                        is_folder: true,\n                        parent_folder_id: parent_folder_id || null,\n                        uploaded_by: uploaded_by || \"admin\",\n                        folder_path: \"/\",\n                        is_visible: true\n                    }\n                ]).select().single();\n                if (folderError) {\n                    console.error(\"Error creating folder:\", folderError);\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                        error: \"Failed to create folder\"\n                    }, {\n                        status: 500\n                    });\n                }\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    folder: folderRecord\n                });\n            }\n            // Handle regular file creation (legacy JSON path)\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Use FormData for file uploads\"\n            }, {\n                status: 400\n            });\n        }\n        // Handle file upload with FormData\n        if (contentType?.includes(\"multipart/form-data\")) {\n            const formData = await request.formData();\n            const file = formData.get(\"file\");\n            const projectId = formData.get(\"project_id\") || formData.get(\"projectId\");\n            const parentFolderId = formData.get(\"parent_folder_id\");\n            const category = formData.get(\"category\") || \"general\";\n            const description = formData.get(\"description\") || \"\";\n            const tags = formData.get(\"tags\") ? JSON.parse(formData.get(\"tags\")) : [];\n            if (!file || !projectId) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: \"File and projectId are required\"\n                }, {\n                    status: 400\n                });\n            }\n            // Get user from cookies\n            const cookieStore = (0,next_headers__WEBPACK_IMPORTED_MODULE_1__.cookies)();\n            const userRole = cookieStore.get(\"userRole\")?.value;\n            const userId = cookieStore.get(\"userId\")?.value;\n            // Generate unique file path\n            const timestamp = Date.now();\n            const sanitizedName = file.name.replace(/[^a-zA-Z0-9.-]/g, \"_\");\n            const storagePath = `${projectId}/${timestamp}_${sanitizedName}`;\n            // Upload file to Supabase Storage\n            const fileBuffer = await file.arrayBuffer();\n            console.log(\"Uploading file to storage path:\", storagePath);\n            console.log(\"File size:\", file.size, \"bytes\");\n            console.log(\"File type:\", file.type);\n            const { data: uploadData, error: uploadError } = await supabase.storage.from(\"project-files\").upload(storagePath, fileBuffer, {\n                contentType: file.type,\n                upsert: false\n            });\n            if (uploadError) {\n                console.error(\"Error uploading file to storage:\", uploadError);\n                console.error(\"Storage path attempted:\", storagePath);\n                console.error(\"Full error object:\", JSON.stringify(uploadError, null, 2));\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: \"Failed to upload file\",\n                    details: uploadError.message\n                }, {\n                    status: 500\n                });\n            }\n            // Check if upload actually succeeded\n            if (!uploadData || !uploadData.path) {\n                console.error(\"Upload returned no data, likely failed silently\");\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: \"Upload failed - no data returned\"\n                }, {\n                    status: 500\n                });\n            }\n            console.log(\"File uploaded successfully:\", JSON.stringify(uploadData, null, 2));\n            // Verify the file actually exists in storage\n            const { data: existsData, error: existsError } = await supabase.storage.from(\"project-files\").list(projectId, {\n                limit: 1,\n                search: sanitizedName\n            });\n            console.log(\"File exists check:\", existsData ? \"Files found: \" + existsData.length : \"No files found\");\n            if (existsError) {\n                console.error(\"Error checking if file exists:\", existsError);\n            }\n            // Get public URL for the file\n            const { data: { publicUrl } } = supabase.storage.from(\"project-files\").getPublicUrl(storagePath);\n            console.log(\"Generated public URL:\", publicUrl);\n            console.log(\"Storage path:\", storagePath);\n            // Create database record\n            const { data: fileRecord, error: dbError } = await supabase.from(\"aloa_project_files\").insert([\n                {\n                    project_id: projectId,\n                    file_name: file.name,\n                    file_size: file.size,\n                    file_type: file.type,\n                    storage_path: storagePath,\n                    category: category,\n                    is_public: false,\n                    requires_auth: true,\n                    uploaded_by: userRole || \"admin\",\n                    uploaded_by_id: userId,\n                    description: description,\n                    tags: tags,\n                    metadata: {},\n                    url: publicUrl,\n                    download_count: 0,\n                    is_visible: true,\n                    is_latest: true,\n                    is_folder: false,\n                    parent_folder_id: parentFolderId || null\n                }\n            ]).select().single();\n            if (dbError) {\n                console.error(\"Error creating file record:\", dbError);\n                // Clean up uploaded file\n                await supabase.storage.from(\"project-files\").remove([\n                    storagePath\n                ]);\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: \"Failed to create file record\"\n                }, {\n                    status: 500\n                });\n            }\n            // Log activity to timeline\n            await supabase.from(\"aloa_project_timeline\").insert({\n                project_id: projectId,\n                event_type: \"file_upload\",\n                description: `File \"${file.name}\" uploaded by ${userRole || \"user\"}`,\n                user_id: userId,\n                metadata: {\n                    file_id: fileRecord.id,\n                    file_name: file.name,\n                    file_size: file.size,\n                    category: category\n                }\n            });\n            // Send notification to admins if uploaded by client\n            if (userRole === \"client\") {\n                await supabase.from(\"aloa_applet_interactions\").insert({\n                    project_id: projectId,\n                    interaction_type: \"file_upload\",\n                    user_identifier: userId || \"anonymous\",\n                    data: {\n                        file_name: file.name,\n                        file_size: file.size,\n                        category: category,\n                        file_id: fileRecord.id\n                    },\n                    created_at: new Date().toISOString(),\n                    read: false\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                file: fileRecord,\n                url: publicUrl,\n                id: fileRecord.id\n            });\n        }\n        // Handle JSON body (for backwards compatibility)\n        const body = await request.json();\n        // Get user from cookies\n        const cookieStore = (0,next_headers__WEBPACK_IMPORTED_MODULE_1__.cookies)();\n        const userRole = cookieStore.get(\"userRole\")?.value;\n        const userId = cookieStore.get(\"userId\")?.value;\n        const { data: file, error } = await supabase.from(\"aloa_project_files\").insert([\n            {\n                project_id: body.project_id,\n                projectlet_id: body.projectlet_id,\n                applet_id: body.applet_id,\n                file_name: body.file_name,\n                file_size: body.file_size,\n                file_type: body.file_type,\n                storage_path: body.storage_path,\n                category: body.category || \"general\",\n                is_public: body.is_public || false,\n                requires_auth: body.requires_auth !== false,\n                uploaded_by: body.uploaded_by || userRole || \"admin\",\n                uploaded_by_id: userId,\n                description: body.description,\n                tags: body.tags || [],\n                metadata: body.metadata || {},\n                url: body.url,\n                download_count: 0,\n                is_visible: true,\n                is_latest: true\n            }\n        ]).select().single();\n        if (error) {\n            console.error(\"Error creating project file record:\", error);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Failed to create file record\"\n            }, {\n                status: 500\n            });\n        }\n        // Log activity to timeline\n        await supabase.from(\"aloa_project_timeline\").insert({\n            project_id: body.project_id,\n            event_type: \"file_upload\",\n            description: `File \"${body.file_name}\" uploaded by ${body.uploaded_by || userRole || \"user\"}`,\n            user_id: userId,\n            metadata: {\n                file_id: file.id,\n                file_name: body.file_name,\n                file_size: body.file_size,\n                category: body.category\n            }\n        });\n        // Send notification to admins if uploaded by client\n        if (body.uploaded_by === \"client\" || userRole === \"client\") {\n            await supabase.from(\"aloa_applet_interactions\").insert({\n                project_id: body.project_id,\n                interaction_type: \"file_upload\",\n                user_identifier: userId || \"anonymous\",\n                data: {\n                    file_name: body.file_name,\n                    file_size: body.file_size,\n                    category: body.category,\n                    file_id: file.id\n                },\n                created_at: new Date().toISOString(),\n                read: false\n            });\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            file\n        });\n    } catch (error) {\n        console.error(\"Error in project files route:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Internal server error\"\n        }, {\n            status: 500\n        });\n    }\n}\n// GET - Get project files and folders\nasync function GET(request) {\n    try {\n        const { searchParams } = new URL(request.url);\n        const projectId = searchParams.get(\"project_id\");\n        const category = searchParams.get(\"category\");\n        const parentFolderId = searchParams.get(\"parent_folder_id\");\n        let query = supabase.from(\"aloa_project_files\").select(\"*\").eq(\"is_visible\", true).order(\"uploaded_at\", {\n            ascending: false\n        });\n        if (projectId) {\n            query = query.eq(\"project_id\", projectId);\n        }\n        if (category && category !== \"all\") {\n            query = query.eq(\"category\", category);\n        }\n        // Filter by parent folder\n        if (parentFolderId) {\n            query = query.eq(\"parent_folder_id\", parentFolderId);\n        } else {\n            // If no parent_folder_id provided, get root level items\n            query = query.is(\"parent_folder_id\", null);\n        }\n        // Order folders first, then files\n        const { data: files, error } = await query.order(\"is_folder\", {\n            ascending: false\n        }).order(\"file_name\", {\n            ascending: true\n        });\n        if (error) {\n            console.error(\"Error fetching project files:\", error);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Failed to fetch files\"\n            }, {\n                status: 500\n            });\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(files || []);\n    } catch (error) {\n        console.error(\"Error in project files route:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Internal server error\"\n        }, {\n            status: 500\n        });\n    }\n}\n// DELETE - Delete project file\nasync function DELETE(request) {\n    try {\n        const { searchParams } = new URL(request.url);\n        const fileId = searchParams.get(\"id\");\n        const storagePath = searchParams.get(\"storage_path\");\n        if (!fileId) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"File ID required\"\n            }, {\n                status: 400\n            });\n        }\n        // Get file details first\n        const { data: fileData } = await supabase.from(\"aloa_project_files\").select(\"*\").eq(\"id\", fileId).single();\n        // Delete from storage if path provided\n        const pathToDelete = storagePath || fileData?.storage_path;\n        if (pathToDelete) {\n            try {\n                const { error: storageError } = await supabase.storage.from(\"project-files\").remove([\n                    pathToDelete\n                ]);\n                if (storageError) {\n                    console.error(\"Storage deletion error:\", storageError);\n                // Continue anyway - maybe file is already gone\n                }\n            } catch (err) {\n                console.error(\"Storage deletion failed:\", err);\n            }\n        }\n        // Delete from database\n        const { error } = await supabase.from(\"aloa_project_files\").delete().eq(\"id\", fileId);\n        if (error) {\n            console.error(\"Error deleting project file:\", error);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Failed to delete file\"\n            }, {\n                status: 500\n            });\n        }\n        // Log deletion activity\n        if (fileData) {\n            const cookieStore = (0,next_headers__WEBPACK_IMPORTED_MODULE_1__.cookies)();\n            const userId = cookieStore.get(\"userId\")?.value;\n            await supabase.from(\"aloa_project_timeline\").insert({\n                project_id: fileData.project_id,\n                event_type: \"file_delete\",\n                description: `File \"${fileData.file_name}\" deleted`,\n                user_id: userId,\n                metadata: {\n                    file_id: fileData.id,\n                    file_name: fileData.file_name\n                }\n            });\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: true\n        });\n    } catch (error) {\n        console.error(\"Error in project files route:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Internal server error\"\n        }, {\n            status: 500\n        });\n    }\n}\n// PATCH - Update file access count or other properties\nasync function PATCH(request) {\n    try {\n        const body = await request.json();\n        const { id, action, ...updates } = body;\n        if (!id) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"File ID required\"\n            }, {\n                status: 400\n            });\n        }\n        let updateData = {\n            last_accessed: new Date().toISOString(),\n            ...updates\n        };\n        // Handle download tracking\n        if (action === \"download\" || body.increment_download) {\n            // Increment download count\n            const { data: currentFile } = await supabase.from(\"aloa_project_files\").select(\"download_count\").eq(\"id\", id).single();\n            updateData.download_count = (currentFile?.download_count || 0) + 1;\n            updateData.last_downloaded_at = new Date().toISOString();\n        }\n        const { data: file, error } = await supabase.from(\"aloa_project_files\").update(updateData).eq(\"id\", id).select().single();\n        if (error) {\n            console.error(\"Error updating project file:\", error);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Failed to update file\"\n            }, {\n                status: 500\n            });\n        }\n        // Log download activity if applicable\n        if (action === \"download\" || body.increment_download) {\n            const cookieStore = (0,next_headers__WEBPACK_IMPORTED_MODULE_1__.cookies)();\n            const userId = cookieStore.get(\"userId\")?.value;\n            await supabase.from(\"aloa_project_timeline\").insert({\n                project_id: file.project_id,\n                event_type: \"file_download\",\n                description: `File \"${file.file_name}\" downloaded`,\n                user_id: userId,\n                metadata: {\n                    file_id: file.id,\n                    file_name: file.file_name\n                }\n            });\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            file\n        });\n    } catch (error) {\n        console.error(\"Error in project files route:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Internal server error\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL3Byb2plY3QtZmlsZXMvcm91dGUuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUEyQztBQUNVO0FBQ2Q7QUFFdkMscUNBQXFDO0FBQ3JDLE1BQU1HLFdBQVdGLG1FQUFZQSxDQUMzQkcsMENBQW9DLEVBQ3BDQSxRQUFRQyxHQUFHLENBQUNFLG1CQUFtQixDQUFDLGtDQUFrQzs7QUFHcEUsdUVBQXVFO0FBQ2hFLGVBQWVDLEtBQUtDLE9BQU87SUFDaEMsSUFBSTtRQUNGLE1BQU1DLGNBQWNELFFBQVFFLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDO1FBRXhDLG1DQUFtQztRQUNuQyxJQUFJRixhQUFhRyxTQUFTLHFCQUFxQjtZQUM3QyxNQUFNLEVBQUVDLFVBQVUsRUFBRUMsU0FBUyxFQUFFQyxTQUFTLEVBQUVDLGdCQUFnQixFQUFFQyxXQUFXLEVBQUUsR0FBRyxNQUFNVCxRQUFRVSxJQUFJO1lBRTlGLElBQUksQ0FBQ0wsY0FBYyxDQUFDQyxXQUFXO2dCQUM3QixPQUFPZixxREFBWUEsQ0FBQ21CLElBQUksQ0FBQztvQkFBRUMsT0FBTztnQkFBbUMsR0FBRztvQkFBRUMsUUFBUTtnQkFBSTtZQUN4RjtZQUVBLElBQUlMLFdBQVc7Z0JBQ2IsdUJBQXVCO2dCQUN2QixNQUFNLEVBQUVNLE1BQU1DLFlBQVksRUFBRUgsT0FBT0ksV0FBVyxFQUFFLEdBQUcsTUFBTXJCLFNBQ3REc0IsSUFBSSxDQUFDLHNCQUNMQyxNQUFNLENBQUM7b0JBQUM7d0JBQ1BaO3dCQUNBQzt3QkFDQUMsV0FBVzt3QkFDWEMsa0JBQWtCQSxvQkFBb0I7d0JBQ3RDQyxhQUFhQSxlQUFlO3dCQUM1QlMsYUFBYTt3QkFDYkMsWUFBWTtvQkFDZDtpQkFBRSxFQUNEQyxNQUFNLEdBQ05DLE1BQU07Z0JBRVQsSUFBSU4sYUFBYTtvQkFDZk8sUUFBUVgsS0FBSyxDQUFDLDBCQUEwQkk7b0JBQ3hDLE9BQU94QixxREFBWUEsQ0FBQ21CLElBQUksQ0FBQzt3QkFBRUMsT0FBTztvQkFBMEIsR0FBRzt3QkFBRUMsUUFBUTtvQkFBSTtnQkFDL0U7Z0JBRUEsT0FBT3JCLHFEQUFZQSxDQUFDbUIsSUFBSSxDQUFDO29CQUFFYSxRQUFRVDtnQkFBYTtZQUNsRDtZQUVBLGtEQUFrRDtZQUNsRCxPQUFPdkIscURBQVlBLENBQUNtQixJQUFJLENBQUM7Z0JBQUVDLE9BQU87WUFBZ0MsR0FBRztnQkFBRUMsUUFBUTtZQUFJO1FBQ3JGO1FBRUEsbUNBQW1DO1FBQ25DLElBQUlYLGFBQWFHLFNBQVMsd0JBQXdCO1lBQ2hELE1BQU1vQixXQUFXLE1BQU14QixRQUFRd0IsUUFBUTtZQUN2QyxNQUFNQyxPQUFPRCxTQUFTckIsR0FBRyxDQUFDO1lBQzFCLE1BQU11QixZQUFZRixTQUFTckIsR0FBRyxDQUFDLGlCQUFpQnFCLFNBQVNyQixHQUFHLENBQUM7WUFDN0QsTUFBTXdCLGlCQUFpQkgsU0FBU3JCLEdBQUcsQ0FBQztZQUNwQyxNQUFNeUIsV0FBV0osU0FBU3JCLEdBQUcsQ0FBQyxlQUFlO1lBQzdDLE1BQU0wQixjQUFjTCxTQUFTckIsR0FBRyxDQUFDLGtCQUFrQjtZQUNuRCxNQUFNMkIsT0FBT04sU0FBU3JCLEdBQUcsQ0FBQyxVQUFVNEIsS0FBS0MsS0FBSyxDQUFDUixTQUFTckIsR0FBRyxDQUFDLFdBQVcsRUFBRTtZQUV6RSxJQUFJLENBQUNzQixRQUFRLENBQUNDLFdBQVc7Z0JBQ3ZCLE9BQU9uQyxxREFBWUEsQ0FBQ21CLElBQUksQ0FBQztvQkFBRUMsT0FBTztnQkFBa0MsR0FBRztvQkFBRUMsUUFBUTtnQkFBSTtZQUN2RjtZQUVBLHdCQUF3QjtZQUN4QixNQUFNcUIsY0FBY3hDLHFEQUFPQTtZQUMzQixNQUFNeUMsV0FBV0QsWUFBWTlCLEdBQUcsQ0FBQyxhQUFhZ0M7WUFDOUMsTUFBTUMsU0FBU0gsWUFBWTlCLEdBQUcsQ0FBQyxXQUFXZ0M7WUFFMUMsNEJBQTRCO1lBQzVCLE1BQU1FLFlBQVlDLEtBQUtDLEdBQUc7WUFDMUIsTUFBTUMsZ0JBQWdCZixLQUFLZ0IsSUFBSSxDQUFDQyxPQUFPLENBQUMsbUJBQW1CO1lBQzNELE1BQU1DLGNBQWMsQ0FBQyxFQUFFakIsVUFBVSxDQUFDLEVBQUVXLFVBQVUsQ0FBQyxFQUFFRyxjQUFjLENBQUM7WUFFaEUsa0NBQWtDO1lBQ2xDLE1BQU1JLGFBQWEsTUFBTW5CLEtBQUtvQixXQUFXO1lBQ3pDdkIsUUFBUXdCLEdBQUcsQ0FBQyxtQ0FBbUNIO1lBQy9DckIsUUFBUXdCLEdBQUcsQ0FBQyxjQUFjckIsS0FBS3NCLElBQUksRUFBRTtZQUNyQ3pCLFFBQVF3QixHQUFHLENBQUMsY0FBY3JCLEtBQUt1QixJQUFJO1lBRW5DLE1BQU0sRUFBRW5DLE1BQU1vQyxVQUFVLEVBQUV0QyxPQUFPdUMsV0FBVyxFQUFFLEdBQUcsTUFBTXhELFNBQVN5RCxPQUFPLENBQ3BFbkMsSUFBSSxDQUFDLGlCQUNMb0MsTUFBTSxDQUFDVCxhQUFhQyxZQUFZO2dCQUMvQjNDLGFBQWF3QixLQUFLdUIsSUFBSTtnQkFDdEJLLFFBQVE7WUFDVjtZQUVGLElBQUlILGFBQWE7Z0JBQ2Y1QixRQUFRWCxLQUFLLENBQUMsb0NBQW9DdUM7Z0JBQ2xENUIsUUFBUVgsS0FBSyxDQUFDLDJCQUEyQmdDO2dCQUN6Q3JCLFFBQVFYLEtBQUssQ0FBQyxzQkFBc0JvQixLQUFLdUIsU0FBUyxDQUFDSixhQUFhLE1BQU07Z0JBQ3RFLE9BQU8zRCxxREFBWUEsQ0FBQ21CLElBQUksQ0FBQztvQkFBRUMsT0FBTztvQkFBeUI0QyxTQUFTTCxZQUFZTSxPQUFPO2dCQUFDLEdBQUc7b0JBQUU1QyxRQUFRO2dCQUFJO1lBQzNHO1lBRUEscUNBQXFDO1lBQ3JDLElBQUksQ0FBQ3FDLGNBQWMsQ0FBQ0EsV0FBV1EsSUFBSSxFQUFFO2dCQUNuQ25DLFFBQVFYLEtBQUssQ0FBQztnQkFDZCxPQUFPcEIscURBQVlBLENBQUNtQixJQUFJLENBQUM7b0JBQUVDLE9BQU87Z0JBQW1DLEdBQUc7b0JBQUVDLFFBQVE7Z0JBQUk7WUFDeEY7WUFFQVUsUUFBUXdCLEdBQUcsQ0FBQywrQkFBK0JmLEtBQUt1QixTQUFTLENBQUNMLFlBQVksTUFBTTtZQUU1RSw2Q0FBNkM7WUFDN0MsTUFBTSxFQUFFcEMsTUFBTTZDLFVBQVUsRUFBRS9DLE9BQU9nRCxXQUFXLEVBQUUsR0FBRyxNQUFNakUsU0FBU3lELE9BQU8sQ0FDcEVuQyxJQUFJLENBQUMsaUJBQ0w0QyxJQUFJLENBQUNsQyxXQUFXO2dCQUNmbUMsT0FBTztnQkFDUEMsUUFBUXRCO1lBQ1Y7WUFFRmxCLFFBQVF3QixHQUFHLENBQUMsc0JBQXNCWSxhQUFhLGtCQUFrQkEsV0FBV0ssTUFBTSxHQUFHO1lBQ3JGLElBQUlKLGFBQWE7Z0JBQ2ZyQyxRQUFRWCxLQUFLLENBQUMsa0NBQWtDZ0Q7WUFDbEQ7WUFFQSw4QkFBOEI7WUFDOUIsTUFBTSxFQUFFOUMsTUFBTSxFQUFFbUQsU0FBUyxFQUFFLEVBQUUsR0FBR3RFLFNBQVN5RCxPQUFPLENBQzdDbkMsSUFBSSxDQUFDLGlCQUNMaUQsWUFBWSxDQUFDdEI7WUFFaEJyQixRQUFRd0IsR0FBRyxDQUFDLHlCQUF5QmtCO1lBQ3JDMUMsUUFBUXdCLEdBQUcsQ0FBQyxpQkFBaUJIO1lBRTdCLHlCQUF5QjtZQUN6QixNQUFNLEVBQUU5QixNQUFNcUQsVUFBVSxFQUFFdkQsT0FBT3dELE9BQU8sRUFBRSxHQUFHLE1BQU16RSxTQUNoRHNCLElBQUksQ0FBQyxzQkFDTEMsTUFBTSxDQUFDO2dCQUFDO29CQUNQWixZQUFZcUI7b0JBQ1pwQixXQUFXbUIsS0FBS2dCLElBQUk7b0JBQ3BCMkIsV0FBVzNDLEtBQUtzQixJQUFJO29CQUNwQnNCLFdBQVc1QyxLQUFLdUIsSUFBSTtvQkFDcEJzQixjQUFjM0I7b0JBQ2RmLFVBQVVBO29CQUNWMkMsV0FBVztvQkFDWEMsZUFBZTtvQkFDZi9ELGFBQWF5QixZQUFZO29CQUN6QnVDLGdCQUFnQnJDO29CQUNoQlAsYUFBYUE7b0JBQ2JDLE1BQU1BO29CQUNONEMsVUFBVSxDQUFDO29CQUNYQyxLQUFLWDtvQkFDTFksZ0JBQWdCO29CQUNoQnpELFlBQVk7b0JBQ1owRCxXQUFXO29CQUNYdEUsV0FBVztvQkFDWEMsa0JBQWtCbUIsa0JBQWtCO2dCQUN0QzthQUFFLEVBQ0RQLE1BQU0sR0FDTkMsTUFBTTtZQUVULElBQUk4QyxTQUFTO2dCQUNYN0MsUUFBUVgsS0FBSyxDQUFDLCtCQUErQndEO2dCQUM3Qyx5QkFBeUI7Z0JBQ3pCLE1BQU16RSxTQUFTeUQsT0FBTyxDQUFDbkMsSUFBSSxDQUFDLGlCQUFpQjhELE1BQU0sQ0FBQztvQkFBQ25DO2lCQUFZO2dCQUNqRSxPQUFPcEQscURBQVlBLENBQUNtQixJQUFJLENBQUM7b0JBQUVDLE9BQU87Z0JBQStCLEdBQUc7b0JBQUVDLFFBQVE7Z0JBQUk7WUFDcEY7WUFFQSwyQkFBMkI7WUFDM0IsTUFBTWxCLFNBQ0hzQixJQUFJLENBQUMseUJBQ0xDLE1BQU0sQ0FBQztnQkFDTlosWUFBWXFCO2dCQUNacUQsWUFBWTtnQkFDWmxELGFBQWEsQ0FBQyxNQUFNLEVBQUVKLEtBQUtnQixJQUFJLENBQUMsY0FBYyxFQUFFUCxZQUFZLE9BQU8sQ0FBQztnQkFDcEU4QyxTQUFTNUM7Z0JBQ1RzQyxVQUFVO29CQUNSTyxTQUFTZixXQUFXZ0IsRUFBRTtvQkFDdEI1RSxXQUFXbUIsS0FBS2dCLElBQUk7b0JBQ3BCMkIsV0FBVzNDLEtBQUtzQixJQUFJO29CQUNwQm5CLFVBQVVBO2dCQUNaO1lBQ0Y7WUFFRixvREFBb0Q7WUFDcEQsSUFBSU0sYUFBYSxVQUFVO2dCQUN6QixNQUFNeEMsU0FDSHNCLElBQUksQ0FBQyw0QkFDTEMsTUFBTSxDQUFDO29CQUNOWixZQUFZcUI7b0JBQ1p5RCxrQkFBa0I7b0JBQ2xCQyxpQkFBaUJoRCxVQUFVO29CQUMzQnZCLE1BQU07d0JBQ0pQLFdBQVdtQixLQUFLZ0IsSUFBSTt3QkFDcEIyQixXQUFXM0MsS0FBS3NCLElBQUk7d0JBQ3BCbkIsVUFBVUE7d0JBQ1ZxRCxTQUFTZixXQUFXZ0IsRUFBRTtvQkFDeEI7b0JBQ0FHLFlBQVksSUFBSS9DLE9BQU9nRCxXQUFXO29CQUNsQ0MsTUFBTTtnQkFDUjtZQUNKO1lBRUEsT0FBT2hHLHFEQUFZQSxDQUFDbUIsSUFBSSxDQUFDO2dCQUN2QmUsTUFBTXlDO2dCQUNOUyxLQUFLWDtnQkFDTGtCLElBQUloQixXQUFXZ0IsRUFBRTtZQUNuQjtRQUNGO1FBRUEsaURBQWlEO1FBQ2pELE1BQU1NLE9BQU8sTUFBTXhGLFFBQVFVLElBQUk7UUFFL0Isd0JBQXdCO1FBQ3hCLE1BQU11QixjQUFjeEMscURBQU9BO1FBQzNCLE1BQU15QyxXQUFXRCxZQUFZOUIsR0FBRyxDQUFDLGFBQWFnQztRQUM5QyxNQUFNQyxTQUFTSCxZQUFZOUIsR0FBRyxDQUFDLFdBQVdnQztRQUUxQyxNQUFNLEVBQUV0QixNQUFNWSxJQUFJLEVBQUVkLEtBQUssRUFBRSxHQUFHLE1BQU1qQixTQUNqQ3NCLElBQUksQ0FBQyxzQkFDTEMsTUFBTSxDQUFDO1lBQUM7Z0JBQ1BaLFlBQVltRixLQUFLbkYsVUFBVTtnQkFDM0JvRixlQUFlRCxLQUFLQyxhQUFhO2dCQUNqQ0MsV0FBV0YsS0FBS0UsU0FBUztnQkFDekJwRixXQUFXa0YsS0FBS2xGLFNBQVM7Z0JBQ3pCOEQsV0FBV29CLEtBQUtwQixTQUFTO2dCQUN6QkMsV0FBV21CLEtBQUtuQixTQUFTO2dCQUN6QkMsY0FBY2tCLEtBQUtsQixZQUFZO2dCQUMvQjFDLFVBQVU0RCxLQUFLNUQsUUFBUSxJQUFJO2dCQUMzQjJDLFdBQVdpQixLQUFLakIsU0FBUyxJQUFJO2dCQUM3QkMsZUFBZWdCLEtBQUtoQixhQUFhLEtBQUs7Z0JBQ3RDL0QsYUFBYStFLEtBQUsvRSxXQUFXLElBQUl5QixZQUFZO2dCQUM3Q3VDLGdCQUFnQnJDO2dCQUNoQlAsYUFBYTJELEtBQUszRCxXQUFXO2dCQUM3QkMsTUFBTTBELEtBQUsxRCxJQUFJLElBQUksRUFBRTtnQkFDckI0QyxVQUFVYyxLQUFLZCxRQUFRLElBQUksQ0FBQztnQkFDNUJDLEtBQUthLEtBQUtiLEdBQUc7Z0JBQ2JDLGdCQUFnQjtnQkFDaEJ6RCxZQUFZO2dCQUNaMEQsV0FBVztZQUNiO1NBQUUsRUFDRHpELE1BQU0sR0FDTkMsTUFBTTtRQUVULElBQUlWLE9BQU87WUFDVFcsUUFBUVgsS0FBSyxDQUFDLHVDQUF1Q0E7WUFDckQsT0FBT3BCLHFEQUFZQSxDQUFDbUIsSUFBSSxDQUFDO2dCQUFFQyxPQUFPO1lBQStCLEdBQUc7Z0JBQUVDLFFBQVE7WUFBSTtRQUNwRjtRQUVBLDJCQUEyQjtRQUMzQixNQUFNbEIsU0FDSHNCLElBQUksQ0FBQyx5QkFDTEMsTUFBTSxDQUFDO1lBQ05aLFlBQVltRixLQUFLbkYsVUFBVTtZQUMzQjBFLFlBQVk7WUFDWmxELGFBQWEsQ0FBQyxNQUFNLEVBQUUyRCxLQUFLbEYsU0FBUyxDQUFDLGNBQWMsRUFBRWtGLEtBQUsvRSxXQUFXLElBQUl5QixZQUFZLE9BQU8sQ0FBQztZQUM3RjhDLFNBQVM1QztZQUNUc0MsVUFBVTtnQkFDUk8sU0FBU3hELEtBQUt5RCxFQUFFO2dCQUNoQjVFLFdBQVdrRixLQUFLbEYsU0FBUztnQkFDekI4RCxXQUFXb0IsS0FBS3BCLFNBQVM7Z0JBQ3pCeEMsVUFBVTRELEtBQUs1RCxRQUFRO1lBQ3pCO1FBQ0Y7UUFFRixvREFBb0Q7UUFDcEQsSUFBSTRELEtBQUsvRSxXQUFXLEtBQUssWUFBWXlCLGFBQWEsVUFBVTtZQUMxRCxNQUFNeEMsU0FDSHNCLElBQUksQ0FBQyw0QkFDTEMsTUFBTSxDQUFDO2dCQUNOWixZQUFZbUYsS0FBS25GLFVBQVU7Z0JBQzNCOEUsa0JBQWtCO2dCQUNsQkMsaUJBQWlCaEQsVUFBVTtnQkFDM0J2QixNQUFNO29CQUNKUCxXQUFXa0YsS0FBS2xGLFNBQVM7b0JBQ3pCOEQsV0FBV29CLEtBQUtwQixTQUFTO29CQUN6QnhDLFVBQVU0RCxLQUFLNUQsUUFBUTtvQkFDdkJxRCxTQUFTeEQsS0FBS3lELEVBQUU7Z0JBQ2xCO2dCQUNBRyxZQUFZLElBQUkvQyxPQUFPZ0QsV0FBVztnQkFDbENDLE1BQU07WUFDUjtRQUNKO1FBRUEsT0FBT2hHLHFEQUFZQSxDQUFDbUIsSUFBSSxDQUFDO1lBQUVlO1FBQUs7SUFDbEMsRUFBRSxPQUFPZCxPQUFPO1FBQ2RXLFFBQVFYLEtBQUssQ0FBQyxpQ0FBaUNBO1FBQy9DLE9BQU9wQixxREFBWUEsQ0FBQ21CLElBQUksQ0FBQztZQUFFQyxPQUFPO1FBQXdCLEdBQUc7WUFBRUMsUUFBUTtRQUFJO0lBQzdFO0FBQ0Y7QUFFQSxzQ0FBc0M7QUFDL0IsZUFBZStFLElBQUkzRixPQUFPO0lBQy9CLElBQUk7UUFDRixNQUFNLEVBQUU0RixZQUFZLEVBQUUsR0FBRyxJQUFJQyxJQUFJN0YsUUFBUTJFLEdBQUc7UUFDNUMsTUFBTWpELFlBQVlrRSxhQUFhekYsR0FBRyxDQUFDO1FBQ25DLE1BQU15QixXQUFXZ0UsYUFBYXpGLEdBQUcsQ0FBQztRQUNsQyxNQUFNd0IsaUJBQWlCaUUsYUFBYXpGLEdBQUcsQ0FBQztRQUV4QyxJQUFJMkYsUUFBUXBHLFNBQ1RzQixJQUFJLENBQUMsc0JBQ0xJLE1BQU0sQ0FBQyxLQUNQMkUsRUFBRSxDQUFDLGNBQWMsTUFDakJDLEtBQUssQ0FBQyxlQUFlO1lBQUVDLFdBQVc7UUFBTTtRQUUzQyxJQUFJdkUsV0FBVztZQUNib0UsUUFBUUEsTUFBTUMsRUFBRSxDQUFDLGNBQWNyRTtRQUNqQztRQUVBLElBQUlFLFlBQVlBLGFBQWEsT0FBTztZQUNsQ2tFLFFBQVFBLE1BQU1DLEVBQUUsQ0FBQyxZQUFZbkU7UUFDL0I7UUFFQSwwQkFBMEI7UUFDMUIsSUFBSUQsZ0JBQWdCO1lBQ2xCbUUsUUFBUUEsTUFBTUMsRUFBRSxDQUFDLG9CQUFvQnBFO1FBQ3ZDLE9BQU87WUFDTCx3REFBd0Q7WUFDeERtRSxRQUFRQSxNQUFNSSxFQUFFLENBQUMsb0JBQW9CO1FBQ3ZDO1FBRUEsa0NBQWtDO1FBQ2xDLE1BQU0sRUFBRXJGLE1BQU1zRixLQUFLLEVBQUV4RixLQUFLLEVBQUUsR0FBRyxNQUFNbUYsTUFDbENFLEtBQUssQ0FBQyxhQUFhO1lBQUVDLFdBQVc7UUFBTSxHQUN0Q0QsS0FBSyxDQUFDLGFBQWE7WUFBRUMsV0FBVztRQUFLO1FBRXhDLElBQUl0RixPQUFPO1lBQ1RXLFFBQVFYLEtBQUssQ0FBQyxpQ0FBaUNBO1lBQy9DLE9BQU9wQixxREFBWUEsQ0FBQ21CLElBQUksQ0FBQztnQkFBRUMsT0FBTztZQUF3QixHQUFHO2dCQUFFQyxRQUFRO1lBQUk7UUFDN0U7UUFFQSxPQUFPckIscURBQVlBLENBQUNtQixJQUFJLENBQUN5RixTQUFTLEVBQUU7SUFDdEMsRUFBRSxPQUFPeEYsT0FBTztRQUNkVyxRQUFRWCxLQUFLLENBQUMsaUNBQWlDQTtRQUMvQyxPQUFPcEIscURBQVlBLENBQUNtQixJQUFJLENBQUM7WUFBRUMsT0FBTztRQUF3QixHQUFHO1lBQUVDLFFBQVE7UUFBSTtJQUM3RTtBQUNGO0FBRUEsK0JBQStCO0FBQ3hCLGVBQWV3RixPQUFPcEcsT0FBTztJQUNsQyxJQUFJO1FBQ0YsTUFBTSxFQUFFNEYsWUFBWSxFQUFFLEdBQUcsSUFBSUMsSUFBSTdGLFFBQVEyRSxHQUFHO1FBQzVDLE1BQU0wQixTQUFTVCxhQUFhekYsR0FBRyxDQUFDO1FBQ2hDLE1BQU13QyxjQUFjaUQsYUFBYXpGLEdBQUcsQ0FBQztRQUVyQyxJQUFJLENBQUNrRyxRQUFRO1lBQ1gsT0FBTzlHLHFEQUFZQSxDQUFDbUIsSUFBSSxDQUFDO2dCQUFFQyxPQUFPO1lBQW1CLEdBQUc7Z0JBQUVDLFFBQVE7WUFBSTtRQUN4RTtRQUVBLHlCQUF5QjtRQUN6QixNQUFNLEVBQUVDLE1BQU15RixRQUFRLEVBQUUsR0FBRyxNQUFNNUcsU0FDOUJzQixJQUFJLENBQUMsc0JBQ0xJLE1BQU0sQ0FBQyxLQUNQMkUsRUFBRSxDQUFDLE1BQU1NLFFBQ1RoRixNQUFNO1FBRVQsdUNBQXVDO1FBQ3ZDLE1BQU1rRixlQUFlNUQsZUFBZTJELFVBQVVoQztRQUM5QyxJQUFJaUMsY0FBYztZQUNoQixJQUFJO2dCQUNGLE1BQU0sRUFBRTVGLE9BQU82RixZQUFZLEVBQUUsR0FBRyxNQUFNOUcsU0FBU3lELE9BQU8sQ0FDbkRuQyxJQUFJLENBQUMsaUJBQ0w4RCxNQUFNLENBQUM7b0JBQUN5QjtpQkFBYTtnQkFFeEIsSUFBSUMsY0FBYztvQkFDaEJsRixRQUFRWCxLQUFLLENBQUMsMkJBQTJCNkY7Z0JBQ3pDLCtDQUErQztnQkFDakQ7WUFDRixFQUFFLE9BQU9DLEtBQUs7Z0JBQ1puRixRQUFRWCxLQUFLLENBQUMsNEJBQTRCOEY7WUFDNUM7UUFDRjtRQUVBLHVCQUF1QjtRQUN2QixNQUFNLEVBQUU5RixLQUFLLEVBQUUsR0FBRyxNQUFNakIsU0FDckJzQixJQUFJLENBQUMsc0JBQ0wwRixNQUFNLEdBQ05YLEVBQUUsQ0FBQyxNQUFNTTtRQUVaLElBQUkxRixPQUFPO1lBQ1RXLFFBQVFYLEtBQUssQ0FBQyxnQ0FBZ0NBO1lBQzlDLE9BQU9wQixxREFBWUEsQ0FBQ21CLElBQUksQ0FBQztnQkFBRUMsT0FBTztZQUF3QixHQUFHO2dCQUFFQyxRQUFRO1lBQUk7UUFDN0U7UUFFQSx3QkFBd0I7UUFDeEIsSUFBSTBGLFVBQVU7WUFDWixNQUFNckUsY0FBY3hDLHFEQUFPQTtZQUMzQixNQUFNMkMsU0FBU0gsWUFBWTlCLEdBQUcsQ0FBQyxXQUFXZ0M7WUFFMUMsTUFBTXpDLFNBQ0hzQixJQUFJLENBQUMseUJBQ0xDLE1BQU0sQ0FBQztnQkFDTlosWUFBWWlHLFNBQVNqRyxVQUFVO2dCQUMvQjBFLFlBQVk7Z0JBQ1psRCxhQUFhLENBQUMsTUFBTSxFQUFFeUUsU0FBU2hHLFNBQVMsQ0FBQyxTQUFTLENBQUM7Z0JBQ25EMEUsU0FBUzVDO2dCQUNUc0MsVUFBVTtvQkFDUk8sU0FBU3FCLFNBQVNwQixFQUFFO29CQUNwQjVFLFdBQVdnRyxTQUFTaEcsU0FBUztnQkFDL0I7WUFDRjtRQUNKO1FBRUEsT0FBT2YscURBQVlBLENBQUNtQixJQUFJLENBQUM7WUFBRWlHLFNBQVM7UUFBSztJQUMzQyxFQUFFLE9BQU9oRyxPQUFPO1FBQ2RXLFFBQVFYLEtBQUssQ0FBQyxpQ0FBaUNBO1FBQy9DLE9BQU9wQixxREFBWUEsQ0FBQ21CLElBQUksQ0FBQztZQUFFQyxPQUFPO1FBQXdCLEdBQUc7WUFBRUMsUUFBUTtRQUFJO0lBQzdFO0FBQ0Y7QUFFQSx1REFBdUQ7QUFDaEQsZUFBZWdHLE1BQU01RyxPQUFPO0lBQ2pDLElBQUk7UUFDRixNQUFNd0YsT0FBTyxNQUFNeEYsUUFBUVUsSUFBSTtRQUMvQixNQUFNLEVBQUV3RSxFQUFFLEVBQUUyQixNQUFNLEVBQUUsR0FBR0MsU0FBUyxHQUFHdEI7UUFFbkMsSUFBSSxDQUFDTixJQUFJO1lBQ1AsT0FBTzNGLHFEQUFZQSxDQUFDbUIsSUFBSSxDQUFDO2dCQUFFQyxPQUFPO1lBQW1CLEdBQUc7Z0JBQUVDLFFBQVE7WUFBSTtRQUN4RTtRQUVBLElBQUltRyxhQUFhO1lBQ2ZDLGVBQWUsSUFBSTFFLE9BQU9nRCxXQUFXO1lBQ3JDLEdBQUd3QixPQUFPO1FBQ1o7UUFFQSwyQkFBMkI7UUFDM0IsSUFBSUQsV0FBVyxjQUFjckIsS0FBS3lCLGtCQUFrQixFQUFFO1lBQ3BELDJCQUEyQjtZQUMzQixNQUFNLEVBQUVwRyxNQUFNcUcsV0FBVyxFQUFFLEdBQUcsTUFBTXhILFNBQ2pDc0IsSUFBSSxDQUFDLHNCQUNMSSxNQUFNLENBQUMsa0JBQ1AyRSxFQUFFLENBQUMsTUFBTWIsSUFDVDdELE1BQU07WUFFVDBGLFdBQVduQyxjQUFjLEdBQUcsQ0FBQ3NDLGFBQWF0QyxrQkFBa0IsS0FBSztZQUNqRW1DLFdBQVdJLGtCQUFrQixHQUFHLElBQUk3RSxPQUFPZ0QsV0FBVztRQUN4RDtRQUVBLE1BQU0sRUFBRXpFLE1BQU1ZLElBQUksRUFBRWQsS0FBSyxFQUFFLEdBQUcsTUFBTWpCLFNBQ2pDc0IsSUFBSSxDQUFDLHNCQUNMb0csTUFBTSxDQUFDTCxZQUNQaEIsRUFBRSxDQUFDLE1BQU1iLElBQ1Q5RCxNQUFNLEdBQ05DLE1BQU07UUFFVCxJQUFJVixPQUFPO1lBQ1RXLFFBQVFYLEtBQUssQ0FBQyxnQ0FBZ0NBO1lBQzlDLE9BQU9wQixxREFBWUEsQ0FBQ21CLElBQUksQ0FBQztnQkFBRUMsT0FBTztZQUF3QixHQUFHO2dCQUFFQyxRQUFRO1lBQUk7UUFDN0U7UUFFQSxzQ0FBc0M7UUFDdEMsSUFBSWlHLFdBQVcsY0FBY3JCLEtBQUt5QixrQkFBa0IsRUFBRTtZQUNwRCxNQUFNaEYsY0FBY3hDLHFEQUFPQTtZQUMzQixNQUFNMkMsU0FBU0gsWUFBWTlCLEdBQUcsQ0FBQyxXQUFXZ0M7WUFFMUMsTUFBTXpDLFNBQ0hzQixJQUFJLENBQUMseUJBQ0xDLE1BQU0sQ0FBQztnQkFDTlosWUFBWW9CLEtBQUtwQixVQUFVO2dCQUMzQjBFLFlBQVk7Z0JBQ1psRCxhQUFhLENBQUMsTUFBTSxFQUFFSixLQUFLbkIsU0FBUyxDQUFDLFlBQVksQ0FBQztnQkFDbEQwRSxTQUFTNUM7Z0JBQ1RzQyxVQUFVO29CQUNSTyxTQUFTeEQsS0FBS3lELEVBQUU7b0JBQ2hCNUUsV0FBV21CLEtBQUtuQixTQUFTO2dCQUMzQjtZQUNGO1FBQ0o7UUFFQSxPQUFPZixxREFBWUEsQ0FBQ21CLElBQUksQ0FBQztZQUFFZTtRQUFLO0lBQ2xDLEVBQUUsT0FBT2QsT0FBTztRQUNkVyxRQUFRWCxLQUFLLENBQUMsaUNBQWlDQTtRQUMvQyxPQUFPcEIscURBQVlBLENBQUNtQixJQUFJLENBQUM7WUFBRUMsT0FBTztRQUF3QixHQUFHO1lBQUVDLFFBQVE7UUFBSTtJQUM3RTtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYWxvYS1wcm9qZWN0LW1hbmFnZXIvLi9hcHAvYXBpL3Byb2plY3QtZmlsZXMvcm91dGUuanM/NzA0MyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnO1xuaW1wb3J0IHsgY29va2llcyB9IGZyb20gJ25leHQvaGVhZGVycyc7XG5cbi8vIEluaXRpYWxpemUgU3VwYWJhc2Ugc2VydmljZSBjbGllbnRcbmNvbnN0IHN1cGFiYXNlID0gY3JlYXRlQ2xpZW50KFxuICBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwsXG4gIHByb2Nlc3MuZW52LlNVUEFCQVNFX1NFQ1JFVF9LRVkgLy8gVXNpbmcgc2VydmljZSBrZXkgdG8gYnlwYXNzIFJMU1xuKTtcblxuLy8gUE9TVCAtIENyZWF0ZSBuZXcgcHJvamVjdCBmaWxlIHJlY29yZCwgdXBsb2FkIGZpbGUsIG9yIGNyZWF0ZSBmb2xkZXJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBjb250ZW50VHlwZSA9IHJlcXVlc3QuaGVhZGVycy5nZXQoJ2NvbnRlbnQtdHlwZScpO1xuXG4gICAgLy8gSGFuZGxlIGZvbGRlciBjcmVhdGlvbiB3aXRoIEpTT05cbiAgICBpZiAoY29udGVudFR5cGU/LmluY2x1ZGVzKCdhcHBsaWNhdGlvbi9qc29uJykpIHtcbiAgICAgIGNvbnN0IHsgcHJvamVjdF9pZCwgZmlsZV9uYW1lLCBpc19mb2xkZXIsIHBhcmVudF9mb2xkZXJfaWQsIHVwbG9hZGVkX2J5IH0gPSBhd2FpdCByZXF1ZXN0Lmpzb24oKTtcblxuICAgICAgaWYgKCFwcm9qZWN0X2lkIHx8ICFmaWxlX25hbWUpIHtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdQcm9qZWN0IElEIGFuZCBuYW1lIGFyZSByZXF1aXJlZCcgfSwgeyBzdGF0dXM6IDQwMCB9KTtcbiAgICAgIH1cblxuICAgICAgaWYgKGlzX2ZvbGRlcikge1xuICAgICAgICAvLyBDcmVhdGUgZm9sZGVyIHJlY29yZFxuICAgICAgICBjb25zdCB7IGRhdGE6IGZvbGRlclJlY29yZCwgZXJyb3I6IGZvbGRlckVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAgIC5mcm9tKCdhbG9hX3Byb2plY3RfZmlsZXMnKVxuICAgICAgICAgIC5pbnNlcnQoW3tcbiAgICAgICAgICAgIHByb2plY3RfaWQsXG4gICAgICAgICAgICBmaWxlX25hbWUsXG4gICAgICAgICAgICBpc19mb2xkZXI6IHRydWUsXG4gICAgICAgICAgICBwYXJlbnRfZm9sZGVyX2lkOiBwYXJlbnRfZm9sZGVyX2lkIHx8IG51bGwsXG4gICAgICAgICAgICB1cGxvYWRlZF9ieTogdXBsb2FkZWRfYnkgfHwgJ2FkbWluJyxcbiAgICAgICAgICAgIGZvbGRlcl9wYXRoOiAnLycsXG4gICAgICAgICAgICBpc192aXNpYmxlOiB0cnVlXG4gICAgICAgICAgfV0pXG4gICAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgICAgLnNpbmdsZSgpO1xuXG4gICAgICAgIGlmIChmb2xkZXJFcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nIGZvbGRlcjonLCBmb2xkZXJFcnJvcik7XG4gICAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdGYWlsZWQgdG8gY3JlYXRlIGZvbGRlcicgfSwgeyBzdGF0dXM6IDUwMCB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGZvbGRlcjogZm9sZGVyUmVjb3JkIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBIYW5kbGUgcmVndWxhciBmaWxlIGNyZWF0aW9uIChsZWdhY3kgSlNPTiBwYXRoKVxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdVc2UgRm9ybURhdGEgZm9yIGZpbGUgdXBsb2FkcycgfSwgeyBzdGF0dXM6IDQwMCB9KTtcbiAgICB9XG5cbiAgICAvLyBIYW5kbGUgZmlsZSB1cGxvYWQgd2l0aCBGb3JtRGF0YVxuICAgIGlmIChjb250ZW50VHlwZT8uaW5jbHVkZXMoJ211bHRpcGFydC9mb3JtLWRhdGEnKSkge1xuICAgICAgY29uc3QgZm9ybURhdGEgPSBhd2FpdCByZXF1ZXN0LmZvcm1EYXRhKCk7XG4gICAgICBjb25zdCBmaWxlID0gZm9ybURhdGEuZ2V0KCdmaWxlJyk7XG4gICAgICBjb25zdCBwcm9qZWN0SWQgPSBmb3JtRGF0YS5nZXQoJ3Byb2plY3RfaWQnKSB8fCBmb3JtRGF0YS5nZXQoJ3Byb2plY3RJZCcpO1xuICAgICAgY29uc3QgcGFyZW50Rm9sZGVySWQgPSBmb3JtRGF0YS5nZXQoJ3BhcmVudF9mb2xkZXJfaWQnKTtcbiAgICAgIGNvbnN0IGNhdGVnb3J5ID0gZm9ybURhdGEuZ2V0KCdjYXRlZ29yeScpIHx8ICdnZW5lcmFsJztcbiAgICAgIGNvbnN0IGRlc2NyaXB0aW9uID0gZm9ybURhdGEuZ2V0KCdkZXNjcmlwdGlvbicpIHx8ICcnO1xuICAgICAgY29uc3QgdGFncyA9IGZvcm1EYXRhLmdldCgndGFncycpID8gSlNPTi5wYXJzZShmb3JtRGF0YS5nZXQoJ3RhZ3MnKSkgOiBbXTtcblxuICAgICAgaWYgKCFmaWxlIHx8ICFwcm9qZWN0SWQpIHtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdGaWxlIGFuZCBwcm9qZWN0SWQgYXJlIHJlcXVpcmVkJyB9LCB7IHN0YXR1czogNDAwIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBHZXQgdXNlciBmcm9tIGNvb2tpZXNcbiAgICAgIGNvbnN0IGNvb2tpZVN0b3JlID0gY29va2llcygpO1xuICAgICAgY29uc3QgdXNlclJvbGUgPSBjb29raWVTdG9yZS5nZXQoJ3VzZXJSb2xlJyk/LnZhbHVlO1xuICAgICAgY29uc3QgdXNlcklkID0gY29va2llU3RvcmUuZ2V0KCd1c2VySWQnKT8udmFsdWU7XG5cbiAgICAgIC8vIEdlbmVyYXRlIHVuaXF1ZSBmaWxlIHBhdGhcbiAgICAgIGNvbnN0IHRpbWVzdGFtcCA9IERhdGUubm93KCk7XG4gICAgICBjb25zdCBzYW5pdGl6ZWROYW1lID0gZmlsZS5uYW1lLnJlcGxhY2UoL1teYS16QS1aMC05Li1dL2csICdfJyk7XG4gICAgICBjb25zdCBzdG9yYWdlUGF0aCA9IGAke3Byb2plY3RJZH0vJHt0aW1lc3RhbXB9XyR7c2FuaXRpemVkTmFtZX1gO1xuXG4gICAgICAvLyBVcGxvYWQgZmlsZSB0byBTdXBhYmFzZSBTdG9yYWdlXG4gICAgICBjb25zdCBmaWxlQnVmZmVyID0gYXdhaXQgZmlsZS5hcnJheUJ1ZmZlcigpO1xuICAgICAgY29uc29sZS5sb2coJ1VwbG9hZGluZyBmaWxlIHRvIHN0b3JhZ2UgcGF0aDonLCBzdG9yYWdlUGF0aCk7XG4gICAgICBjb25zb2xlLmxvZygnRmlsZSBzaXplOicsIGZpbGUuc2l6ZSwgJ2J5dGVzJyk7XG4gICAgICBjb25zb2xlLmxvZygnRmlsZSB0eXBlOicsIGZpbGUudHlwZSk7XG5cbiAgICAgIGNvbnN0IHsgZGF0YTogdXBsb2FkRGF0YSwgZXJyb3I6IHVwbG9hZEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5zdG9yYWdlXG4gICAgICAgIC5mcm9tKCdwcm9qZWN0LWZpbGVzJylcbiAgICAgICAgLnVwbG9hZChzdG9yYWdlUGF0aCwgZmlsZUJ1ZmZlciwge1xuICAgICAgICAgIGNvbnRlbnRUeXBlOiBmaWxlLnR5cGUsXG4gICAgICAgICAgdXBzZXJ0OiBmYWxzZVxuICAgICAgICB9KTtcblxuICAgICAgaWYgKHVwbG9hZEVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHVwbG9hZGluZyBmaWxlIHRvIHN0b3JhZ2U6JywgdXBsb2FkRXJyb3IpO1xuICAgICAgICBjb25zb2xlLmVycm9yKCdTdG9yYWdlIHBhdGggYXR0ZW1wdGVkOicsIHN0b3JhZ2VQYXRoKTtcbiAgICAgICAgY29uc29sZS5lcnJvcignRnVsbCBlcnJvciBvYmplY3Q6JywgSlNPTi5zdHJpbmdpZnkodXBsb2FkRXJyb3IsIG51bGwsIDIpKTtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdGYWlsZWQgdG8gdXBsb2FkIGZpbGUnLCBkZXRhaWxzOiB1cGxvYWRFcnJvci5tZXNzYWdlIH0sIHsgc3RhdHVzOiA1MDAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIGlmIHVwbG9hZCBhY3R1YWxseSBzdWNjZWVkZWRcbiAgICAgIGlmICghdXBsb2FkRGF0YSB8fCAhdXBsb2FkRGF0YS5wYXRoKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1VwbG9hZCByZXR1cm5lZCBubyBkYXRhLCBsaWtlbHkgZmFpbGVkIHNpbGVudGx5Jyk7XG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnVXBsb2FkIGZhaWxlZCAtIG5vIGRhdGEgcmV0dXJuZWQnIH0sIHsgc3RhdHVzOiA1MDAgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnNvbGUubG9nKCdGaWxlIHVwbG9hZGVkIHN1Y2Nlc3NmdWxseTonLCBKU09OLnN0cmluZ2lmeSh1cGxvYWREYXRhLCBudWxsLCAyKSk7XG5cbiAgICAgIC8vIFZlcmlmeSB0aGUgZmlsZSBhY3R1YWxseSBleGlzdHMgaW4gc3RvcmFnZVxuICAgICAgY29uc3QgeyBkYXRhOiBleGlzdHNEYXRhLCBlcnJvcjogZXhpc3RzRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLnN0b3JhZ2VcbiAgICAgICAgLmZyb20oJ3Byb2plY3QtZmlsZXMnKVxuICAgICAgICAubGlzdChwcm9qZWN0SWQsIHtcbiAgICAgICAgICBsaW1pdDogMSxcbiAgICAgICAgICBzZWFyY2g6IHNhbml0aXplZE5hbWVcbiAgICAgICAgfSk7XG5cbiAgICAgIGNvbnNvbGUubG9nKCdGaWxlIGV4aXN0cyBjaGVjazonLCBleGlzdHNEYXRhID8gJ0ZpbGVzIGZvdW5kOiAnICsgZXhpc3RzRGF0YS5sZW5ndGggOiAnTm8gZmlsZXMgZm91bmQnKTtcbiAgICAgIGlmIChleGlzdHNFcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjaGVja2luZyBpZiBmaWxlIGV4aXN0czonLCBleGlzdHNFcnJvcik7XG4gICAgICB9XG5cbiAgICAgIC8vIEdldCBwdWJsaWMgVVJMIGZvciB0aGUgZmlsZVxuICAgICAgY29uc3QgeyBkYXRhOiB7IHB1YmxpY1VybCB9IH0gPSBzdXBhYmFzZS5zdG9yYWdlXG4gICAgICAgIC5mcm9tKCdwcm9qZWN0LWZpbGVzJylcbiAgICAgICAgLmdldFB1YmxpY1VybChzdG9yYWdlUGF0aCk7XG5cbiAgICAgIGNvbnNvbGUubG9nKCdHZW5lcmF0ZWQgcHVibGljIFVSTDonLCBwdWJsaWNVcmwpO1xuICAgICAgY29uc29sZS5sb2coJ1N0b3JhZ2UgcGF0aDonLCBzdG9yYWdlUGF0aCk7XG5cbiAgICAgIC8vIENyZWF0ZSBkYXRhYmFzZSByZWNvcmRcbiAgICAgIGNvbnN0IHsgZGF0YTogZmlsZVJlY29yZCwgZXJyb3I6IGRiRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCdhbG9hX3Byb2plY3RfZmlsZXMnKVxuICAgICAgICAuaW5zZXJ0KFt7XG4gICAgICAgICAgcHJvamVjdF9pZDogcHJvamVjdElkLFxuICAgICAgICAgIGZpbGVfbmFtZTogZmlsZS5uYW1lLFxuICAgICAgICAgIGZpbGVfc2l6ZTogZmlsZS5zaXplLFxuICAgICAgICAgIGZpbGVfdHlwZTogZmlsZS50eXBlLFxuICAgICAgICAgIHN0b3JhZ2VfcGF0aDogc3RvcmFnZVBhdGgsXG4gICAgICAgICAgY2F0ZWdvcnk6IGNhdGVnb3J5LFxuICAgICAgICAgIGlzX3B1YmxpYzogZmFsc2UsXG4gICAgICAgICAgcmVxdWlyZXNfYXV0aDogdHJ1ZSxcbiAgICAgICAgICB1cGxvYWRlZF9ieTogdXNlclJvbGUgfHwgJ2FkbWluJyxcbiAgICAgICAgICB1cGxvYWRlZF9ieV9pZDogdXNlcklkLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBkZXNjcmlwdGlvbixcbiAgICAgICAgICB0YWdzOiB0YWdzLFxuICAgICAgICAgIG1ldGFkYXRhOiB7fSxcbiAgICAgICAgICB1cmw6IHB1YmxpY1VybCxcbiAgICAgICAgICBkb3dubG9hZF9jb3VudDogMCxcbiAgICAgICAgICBpc192aXNpYmxlOiB0cnVlLFxuICAgICAgICAgIGlzX2xhdGVzdDogdHJ1ZSxcbiAgICAgICAgICBpc19mb2xkZXI6IGZhbHNlLFxuICAgICAgICAgIHBhcmVudF9mb2xkZXJfaWQ6IHBhcmVudEZvbGRlcklkIHx8IG51bGxcbiAgICAgICAgfV0pXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuc2luZ2xlKCk7XG5cbiAgICAgIGlmIChkYkVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nIGZpbGUgcmVjb3JkOicsIGRiRXJyb3IpO1xuICAgICAgICAvLyBDbGVhbiB1cCB1cGxvYWRlZCBmaWxlXG4gICAgICAgIGF3YWl0IHN1cGFiYXNlLnN0b3JhZ2UuZnJvbSgncHJvamVjdC1maWxlcycpLnJlbW92ZShbc3RvcmFnZVBhdGhdKTtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdGYWlsZWQgdG8gY3JlYXRlIGZpbGUgcmVjb3JkJyB9LCB7IHN0YXR1czogNTAwIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBMb2cgYWN0aXZpdHkgdG8gdGltZWxpbmVcbiAgICAgIGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCdhbG9hX3Byb2plY3RfdGltZWxpbmUnKVxuICAgICAgICAuaW5zZXJ0KHtcbiAgICAgICAgICBwcm9qZWN0X2lkOiBwcm9qZWN0SWQsXG4gICAgICAgICAgZXZlbnRfdHlwZTogJ2ZpbGVfdXBsb2FkJyxcbiAgICAgICAgICBkZXNjcmlwdGlvbjogYEZpbGUgXCIke2ZpbGUubmFtZX1cIiB1cGxvYWRlZCBieSAke3VzZXJSb2xlIHx8ICd1c2VyJ31gLFxuICAgICAgICAgIHVzZXJfaWQ6IHVzZXJJZCxcbiAgICAgICAgICBtZXRhZGF0YToge1xuICAgICAgICAgICAgZmlsZV9pZDogZmlsZVJlY29yZC5pZCxcbiAgICAgICAgICAgIGZpbGVfbmFtZTogZmlsZS5uYW1lLFxuICAgICAgICAgICAgZmlsZV9zaXplOiBmaWxlLnNpemUsXG4gICAgICAgICAgICBjYXRlZ29yeTogY2F0ZWdvcnlcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAvLyBTZW5kIG5vdGlmaWNhdGlvbiB0byBhZG1pbnMgaWYgdXBsb2FkZWQgYnkgY2xpZW50XG4gICAgICBpZiAodXNlclJvbGUgPT09ICdjbGllbnQnKSB7XG4gICAgICAgIGF3YWl0IHN1cGFiYXNlXG4gICAgICAgICAgLmZyb20oJ2Fsb2FfYXBwbGV0X2ludGVyYWN0aW9ucycpXG4gICAgICAgICAgLmluc2VydCh7XG4gICAgICAgICAgICBwcm9qZWN0X2lkOiBwcm9qZWN0SWQsXG4gICAgICAgICAgICBpbnRlcmFjdGlvbl90eXBlOiAnZmlsZV91cGxvYWQnLFxuICAgICAgICAgICAgdXNlcl9pZGVudGlmaWVyOiB1c2VySWQgfHwgJ2Fub255bW91cycsXG4gICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgIGZpbGVfbmFtZTogZmlsZS5uYW1lLFxuICAgICAgICAgICAgICBmaWxlX3NpemU6IGZpbGUuc2l6ZSxcbiAgICAgICAgICAgICAgY2F0ZWdvcnk6IGNhdGVnb3J5LFxuICAgICAgICAgICAgICBmaWxlX2lkOiBmaWxlUmVjb3JkLmlkXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY3JlYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgcmVhZDogZmFsc2VcbiAgICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgZmlsZTogZmlsZVJlY29yZCxcbiAgICAgICAgdXJsOiBwdWJsaWNVcmwsXG4gICAgICAgIGlkOiBmaWxlUmVjb3JkLmlkXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBIYW5kbGUgSlNPTiBib2R5IChmb3IgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkpXG4gICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcXVlc3QuanNvbigpO1xuXG4gICAgLy8gR2V0IHVzZXIgZnJvbSBjb29raWVzXG4gICAgY29uc3QgY29va2llU3RvcmUgPSBjb29raWVzKCk7XG4gICAgY29uc3QgdXNlclJvbGUgPSBjb29raWVTdG9yZS5nZXQoJ3VzZXJSb2xlJyk/LnZhbHVlO1xuICAgIGNvbnN0IHVzZXJJZCA9IGNvb2tpZVN0b3JlLmdldCgndXNlcklkJyk/LnZhbHVlO1xuXG4gICAgY29uc3QgeyBkYXRhOiBmaWxlLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCdhbG9hX3Byb2plY3RfZmlsZXMnKVxuICAgICAgLmluc2VydChbe1xuICAgICAgICBwcm9qZWN0X2lkOiBib2R5LnByb2plY3RfaWQsXG4gICAgICAgIHByb2plY3RsZXRfaWQ6IGJvZHkucHJvamVjdGxldF9pZCxcbiAgICAgICAgYXBwbGV0X2lkOiBib2R5LmFwcGxldF9pZCxcbiAgICAgICAgZmlsZV9uYW1lOiBib2R5LmZpbGVfbmFtZSxcbiAgICAgICAgZmlsZV9zaXplOiBib2R5LmZpbGVfc2l6ZSxcbiAgICAgICAgZmlsZV90eXBlOiBib2R5LmZpbGVfdHlwZSxcbiAgICAgICAgc3RvcmFnZV9wYXRoOiBib2R5LnN0b3JhZ2VfcGF0aCxcbiAgICAgICAgY2F0ZWdvcnk6IGJvZHkuY2F0ZWdvcnkgfHwgJ2dlbmVyYWwnLFxuICAgICAgICBpc19wdWJsaWM6IGJvZHkuaXNfcHVibGljIHx8IGZhbHNlLFxuICAgICAgICByZXF1aXJlc19hdXRoOiBib2R5LnJlcXVpcmVzX2F1dGggIT09IGZhbHNlLFxuICAgICAgICB1cGxvYWRlZF9ieTogYm9keS51cGxvYWRlZF9ieSB8fCB1c2VyUm9sZSB8fCAnYWRtaW4nLFxuICAgICAgICB1cGxvYWRlZF9ieV9pZDogdXNlcklkLFxuICAgICAgICBkZXNjcmlwdGlvbjogYm9keS5kZXNjcmlwdGlvbixcbiAgICAgICAgdGFnczogYm9keS50YWdzIHx8IFtdLFxuICAgICAgICBtZXRhZGF0YTogYm9keS5tZXRhZGF0YSB8fCB7fSxcbiAgICAgICAgdXJsOiBib2R5LnVybCxcbiAgICAgICAgZG93bmxvYWRfY291bnQ6IDAsXG4gICAgICAgIGlzX3Zpc2libGU6IHRydWUsXG4gICAgICAgIGlzX2xhdGVzdDogdHJ1ZVxuICAgICAgfV0pXG4gICAgICAuc2VsZWN0KClcbiAgICAgIC5zaW5nbGUoKTtcblxuICAgIGlmIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY3JlYXRpbmcgcHJvamVjdCBmaWxlIHJlY29yZDonLCBlcnJvcik7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ0ZhaWxlZCB0byBjcmVhdGUgZmlsZSByZWNvcmQnIH0sIHsgc3RhdHVzOiA1MDAgfSk7XG4gICAgfVxuXG4gICAgLy8gTG9nIGFjdGl2aXR5IHRvIHRpbWVsaW5lXG4gICAgYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCdhbG9hX3Byb2plY3RfdGltZWxpbmUnKVxuICAgICAgLmluc2VydCh7XG4gICAgICAgIHByb2plY3RfaWQ6IGJvZHkucHJvamVjdF9pZCxcbiAgICAgICAgZXZlbnRfdHlwZTogJ2ZpbGVfdXBsb2FkJyxcbiAgICAgICAgZGVzY3JpcHRpb246IGBGaWxlIFwiJHtib2R5LmZpbGVfbmFtZX1cIiB1cGxvYWRlZCBieSAke2JvZHkudXBsb2FkZWRfYnkgfHwgdXNlclJvbGUgfHwgJ3VzZXInfWAsXG4gICAgICAgIHVzZXJfaWQ6IHVzZXJJZCxcbiAgICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgICBmaWxlX2lkOiBmaWxlLmlkLFxuICAgICAgICAgIGZpbGVfbmFtZTogYm9keS5maWxlX25hbWUsXG4gICAgICAgICAgZmlsZV9zaXplOiBib2R5LmZpbGVfc2l6ZSxcbiAgICAgICAgICBjYXRlZ29yeTogYm9keS5jYXRlZ29yeVxuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgIC8vIFNlbmQgbm90aWZpY2F0aW9uIHRvIGFkbWlucyBpZiB1cGxvYWRlZCBieSBjbGllbnRcbiAgICBpZiAoYm9keS51cGxvYWRlZF9ieSA9PT0gJ2NsaWVudCcgfHwgdXNlclJvbGUgPT09ICdjbGllbnQnKSB7XG4gICAgICBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAuZnJvbSgnYWxvYV9hcHBsZXRfaW50ZXJhY3Rpb25zJylcbiAgICAgICAgLmluc2VydCh7XG4gICAgICAgICAgcHJvamVjdF9pZDogYm9keS5wcm9qZWN0X2lkLFxuICAgICAgICAgIGludGVyYWN0aW9uX3R5cGU6ICdmaWxlX3VwbG9hZCcsXG4gICAgICAgICAgdXNlcl9pZGVudGlmaWVyOiB1c2VySWQgfHwgJ2Fub255bW91cycsXG4gICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgZmlsZV9uYW1lOiBib2R5LmZpbGVfbmFtZSxcbiAgICAgICAgICAgIGZpbGVfc2l6ZTogYm9keS5maWxlX3NpemUsXG4gICAgICAgICAgICBjYXRlZ29yeTogYm9keS5jYXRlZ29yeSxcbiAgICAgICAgICAgIGZpbGVfaWQ6IGZpbGUuaWRcbiAgICAgICAgICB9LFxuICAgICAgICAgIGNyZWF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICByZWFkOiBmYWxzZVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBmaWxlIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIHByb2plY3QgZmlsZXMgcm91dGU6JywgZXJyb3IpO1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyB9LCB7IHN0YXR1czogNTAwIH0pO1xuICB9XG59XG5cbi8vIEdFVCAtIEdldCBwcm9qZWN0IGZpbGVzIGFuZCBmb2xkZXJzXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gR0VUKHJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IHNlYXJjaFBhcmFtcyB9ID0gbmV3IFVSTChyZXF1ZXN0LnVybCk7XG4gICAgY29uc3QgcHJvamVjdElkID0gc2VhcmNoUGFyYW1zLmdldCgncHJvamVjdF9pZCcpO1xuICAgIGNvbnN0IGNhdGVnb3J5ID0gc2VhcmNoUGFyYW1zLmdldCgnY2F0ZWdvcnknKTtcbiAgICBjb25zdCBwYXJlbnRGb2xkZXJJZCA9IHNlYXJjaFBhcmFtcy5nZXQoJ3BhcmVudF9mb2xkZXJfaWQnKTtcblxuICAgIGxldCBxdWVyeSA9IHN1cGFiYXNlXG4gICAgICAuZnJvbSgnYWxvYV9wcm9qZWN0X2ZpbGVzJylcbiAgICAgIC5zZWxlY3QoJyonKVxuICAgICAgLmVxKCdpc192aXNpYmxlJywgdHJ1ZSlcbiAgICAgIC5vcmRlcigndXBsb2FkZWRfYXQnLCB7IGFzY2VuZGluZzogZmFsc2UgfSk7XG5cbiAgICBpZiAocHJvamVjdElkKSB7XG4gICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdwcm9qZWN0X2lkJywgcHJvamVjdElkKTtcbiAgICB9XG5cbiAgICBpZiAoY2F0ZWdvcnkgJiYgY2F0ZWdvcnkgIT09ICdhbGwnKSB7XG4gICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdjYXRlZ29yeScsIGNhdGVnb3J5KTtcbiAgICB9XG5cbiAgICAvLyBGaWx0ZXIgYnkgcGFyZW50IGZvbGRlclxuICAgIGlmIChwYXJlbnRGb2xkZXJJZCkge1xuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgncGFyZW50X2ZvbGRlcl9pZCcsIHBhcmVudEZvbGRlcklkKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gSWYgbm8gcGFyZW50X2ZvbGRlcl9pZCBwcm92aWRlZCwgZ2V0IHJvb3QgbGV2ZWwgaXRlbXNcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuaXMoJ3BhcmVudF9mb2xkZXJfaWQnLCBudWxsKTtcbiAgICB9XG5cbiAgICAvLyBPcmRlciBmb2xkZXJzIGZpcnN0LCB0aGVuIGZpbGVzXG4gICAgY29uc3QgeyBkYXRhOiBmaWxlcywgZXJyb3IgfSA9IGF3YWl0IHF1ZXJ5XG4gICAgICAub3JkZXIoJ2lzX2ZvbGRlcicsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KVxuICAgICAgLm9yZGVyKCdmaWxlX25hbWUnLCB7IGFzY2VuZGluZzogdHJ1ZSB9KTtcblxuICAgIGlmIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgcHJvamVjdCBmaWxlczonLCBlcnJvcik7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ0ZhaWxlZCB0byBmZXRjaCBmaWxlcycgfSwgeyBzdGF0dXM6IDUwMCB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oZmlsZXMgfHwgW10pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIHByb2plY3QgZmlsZXMgcm91dGU6JywgZXJyb3IpO1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyB9LCB7IHN0YXR1czogNTAwIH0pO1xuICB9XG59XG5cbi8vIERFTEVURSAtIERlbGV0ZSBwcm9qZWN0IGZpbGVcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBERUxFVEUocmVxdWVzdCkge1xuICB0cnkge1xuICAgIGNvbnN0IHsgc2VhcmNoUGFyYW1zIH0gPSBuZXcgVVJMKHJlcXVlc3QudXJsKTtcbiAgICBjb25zdCBmaWxlSWQgPSBzZWFyY2hQYXJhbXMuZ2V0KCdpZCcpO1xuICAgIGNvbnN0IHN0b3JhZ2VQYXRoID0gc2VhcmNoUGFyYW1zLmdldCgnc3RvcmFnZV9wYXRoJyk7XG5cbiAgICBpZiAoIWZpbGVJZCkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdGaWxlIElEIHJlcXVpcmVkJyB9LCB7IHN0YXR1czogNDAwIH0pO1xuICAgIH1cblxuICAgIC8vIEdldCBmaWxlIGRldGFpbHMgZmlyc3RcbiAgICBjb25zdCB7IGRhdGE6IGZpbGVEYXRhIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ2Fsb2FfcHJvamVjdF9maWxlcycpXG4gICAgICAuc2VsZWN0KCcqJylcbiAgICAgIC5lcSgnaWQnLCBmaWxlSWQpXG4gICAgICAuc2luZ2xlKCk7XG5cbiAgICAvLyBEZWxldGUgZnJvbSBzdG9yYWdlIGlmIHBhdGggcHJvdmlkZWRcbiAgICBjb25zdCBwYXRoVG9EZWxldGUgPSBzdG9yYWdlUGF0aCB8fCBmaWxlRGF0YT8uc3RvcmFnZV9wYXRoO1xuICAgIGlmIChwYXRoVG9EZWxldGUpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHsgZXJyb3I6IHN0b3JhZ2VFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2Uuc3RvcmFnZVxuICAgICAgICAgIC5mcm9tKCdwcm9qZWN0LWZpbGVzJylcbiAgICAgICAgICAucmVtb3ZlKFtwYXRoVG9EZWxldGVdKTtcblxuICAgICAgICBpZiAoc3RvcmFnZUVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcignU3RvcmFnZSBkZWxldGlvbiBlcnJvcjonLCBzdG9yYWdlRXJyb3IpO1xuICAgICAgICAgIC8vIENvbnRpbnVlIGFueXdheSAtIG1heWJlIGZpbGUgaXMgYWxyZWFkeSBnb25lXG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdTdG9yYWdlIGRlbGV0aW9uIGZhaWxlZDonLCBlcnIpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIERlbGV0ZSBmcm9tIGRhdGFiYXNlXG4gICAgY29uc3QgeyBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCdhbG9hX3Byb2plY3RfZmlsZXMnKVxuICAgICAgLmRlbGV0ZSgpXG4gICAgICAuZXEoJ2lkJywgZmlsZUlkKTtcblxuICAgIGlmIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZGVsZXRpbmcgcHJvamVjdCBmaWxlOicsIGVycm9yKTtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnRmFpbGVkIHRvIGRlbGV0ZSBmaWxlJyB9LCB7IHN0YXR1czogNTAwIH0pO1xuICAgIH1cblxuICAgIC8vIExvZyBkZWxldGlvbiBhY3Rpdml0eVxuICAgIGlmIChmaWxlRGF0YSkge1xuICAgICAgY29uc3QgY29va2llU3RvcmUgPSBjb29raWVzKCk7XG4gICAgICBjb25zdCB1c2VySWQgPSBjb29raWVTdG9yZS5nZXQoJ3VzZXJJZCcpPy52YWx1ZTtcblxuICAgICAgYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgLmZyb20oJ2Fsb2FfcHJvamVjdF90aW1lbGluZScpXG4gICAgICAgIC5pbnNlcnQoe1xuICAgICAgICAgIHByb2plY3RfaWQ6IGZpbGVEYXRhLnByb2plY3RfaWQsXG4gICAgICAgICAgZXZlbnRfdHlwZTogJ2ZpbGVfZGVsZXRlJyxcbiAgICAgICAgICBkZXNjcmlwdGlvbjogYEZpbGUgXCIke2ZpbGVEYXRhLmZpbGVfbmFtZX1cIiBkZWxldGVkYCxcbiAgICAgICAgICB1c2VyX2lkOiB1c2VySWQsXG4gICAgICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgICAgIGZpbGVfaWQ6IGZpbGVEYXRhLmlkLFxuICAgICAgICAgICAgZmlsZV9uYW1lOiBmaWxlRGF0YS5maWxlX25hbWVcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IHN1Y2Nlc3M6IHRydWUgfSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gcHJvamVjdCBmaWxlcyByb3V0ZTonLCBlcnJvcik7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InIH0sIHsgc3RhdHVzOiA1MDAgfSk7XG4gIH1cbn1cblxuLy8gUEFUQ0ggLSBVcGRhdGUgZmlsZSBhY2Nlc3MgY291bnQgb3Igb3RoZXIgcHJvcGVydGllc1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBBVENIKHJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxdWVzdC5qc29uKCk7XG4gICAgY29uc3QgeyBpZCwgYWN0aW9uLCAuLi51cGRhdGVzIH0gPSBib2R5O1xuXG4gICAgaWYgKCFpZCkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdGaWxlIElEIHJlcXVpcmVkJyB9LCB7IHN0YXR1czogNDAwIH0pO1xuICAgIH1cblxuICAgIGxldCB1cGRhdGVEYXRhID0ge1xuICAgICAgbGFzdF9hY2Nlc3NlZDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgLi4udXBkYXRlc1xuICAgIH07XG5cbiAgICAvLyBIYW5kbGUgZG93bmxvYWQgdHJhY2tpbmdcbiAgICBpZiAoYWN0aW9uID09PSAnZG93bmxvYWQnIHx8IGJvZHkuaW5jcmVtZW50X2Rvd25sb2FkKSB7XG4gICAgICAvLyBJbmNyZW1lbnQgZG93bmxvYWQgY291bnRcbiAgICAgIGNvbnN0IHsgZGF0YTogY3VycmVudEZpbGUgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCdhbG9hX3Byb2plY3RfZmlsZXMnKVxuICAgICAgICAuc2VsZWN0KCdkb3dubG9hZF9jb3VudCcpXG4gICAgICAgIC5lcSgnaWQnLCBpZClcbiAgICAgICAgLnNpbmdsZSgpO1xuXG4gICAgICB1cGRhdGVEYXRhLmRvd25sb2FkX2NvdW50ID0gKGN1cnJlbnRGaWxlPy5kb3dubG9hZF9jb3VudCB8fCAwKSArIDE7XG4gICAgICB1cGRhdGVEYXRhLmxhc3RfZG93bmxvYWRlZF9hdCA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcbiAgICB9XG5cbiAgICBjb25zdCB7IGRhdGE6IGZpbGUsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ2Fsb2FfcHJvamVjdF9maWxlcycpXG4gICAgICAudXBkYXRlKHVwZGF0ZURhdGEpXG4gICAgICAuZXEoJ2lkJywgaWQpXG4gICAgICAuc2VsZWN0KClcbiAgICAgIC5zaW5nbGUoKTtcblxuICAgIGlmIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBkYXRpbmcgcHJvamVjdCBmaWxlOicsIGVycm9yKTtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnRmFpbGVkIHRvIHVwZGF0ZSBmaWxlJyB9LCB7IHN0YXR1czogNTAwIH0pO1xuICAgIH1cblxuICAgIC8vIExvZyBkb3dubG9hZCBhY3Rpdml0eSBpZiBhcHBsaWNhYmxlXG4gICAgaWYgKGFjdGlvbiA9PT0gJ2Rvd25sb2FkJyB8fCBib2R5LmluY3JlbWVudF9kb3dubG9hZCkge1xuICAgICAgY29uc3QgY29va2llU3RvcmUgPSBjb29raWVzKCk7XG4gICAgICBjb25zdCB1c2VySWQgPSBjb29raWVTdG9yZS5nZXQoJ3VzZXJJZCcpPy52YWx1ZTtcblxuICAgICAgYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgLmZyb20oJ2Fsb2FfcHJvamVjdF90aW1lbGluZScpXG4gICAgICAgIC5pbnNlcnQoe1xuICAgICAgICAgIHByb2plY3RfaWQ6IGZpbGUucHJvamVjdF9pZCxcbiAgICAgICAgICBldmVudF90eXBlOiAnZmlsZV9kb3dubG9hZCcsXG4gICAgICAgICAgZGVzY3JpcHRpb246IGBGaWxlIFwiJHtmaWxlLmZpbGVfbmFtZX1cIiBkb3dubG9hZGVkYCxcbiAgICAgICAgICB1c2VyX2lkOiB1c2VySWQsXG4gICAgICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgICAgIGZpbGVfaWQ6IGZpbGUuaWQsXG4gICAgICAgICAgICBmaWxlX25hbWU6IGZpbGUuZmlsZV9uYW1lXG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBmaWxlIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIHByb2plY3QgZmlsZXMgcm91dGU6JywgZXJyb3IpO1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyB9LCB7IHN0YXR1czogNTAwIH0pO1xuICB9XG59Il0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsImNyZWF0ZUNsaWVudCIsImNvb2tpZXMiLCJzdXBhYmFzZSIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJTVVBBQkFTRV9TRUNSRVRfS0VZIiwiUE9TVCIsInJlcXVlc3QiLCJjb250ZW50VHlwZSIsImhlYWRlcnMiLCJnZXQiLCJpbmNsdWRlcyIsInByb2plY3RfaWQiLCJmaWxlX25hbWUiLCJpc19mb2xkZXIiLCJwYXJlbnRfZm9sZGVyX2lkIiwidXBsb2FkZWRfYnkiLCJqc29uIiwiZXJyb3IiLCJzdGF0dXMiLCJkYXRhIiwiZm9sZGVyUmVjb3JkIiwiZm9sZGVyRXJyb3IiLCJmcm9tIiwiaW5zZXJ0IiwiZm9sZGVyX3BhdGgiLCJpc192aXNpYmxlIiwic2VsZWN0Iiwic2luZ2xlIiwiY29uc29sZSIsImZvbGRlciIsImZvcm1EYXRhIiwiZmlsZSIsInByb2plY3RJZCIsInBhcmVudEZvbGRlcklkIiwiY2F0ZWdvcnkiLCJkZXNjcmlwdGlvbiIsInRhZ3MiLCJKU09OIiwicGFyc2UiLCJjb29raWVTdG9yZSIsInVzZXJSb2xlIiwidmFsdWUiLCJ1c2VySWQiLCJ0aW1lc3RhbXAiLCJEYXRlIiwibm93Iiwic2FuaXRpemVkTmFtZSIsIm5hbWUiLCJyZXBsYWNlIiwic3RvcmFnZVBhdGgiLCJmaWxlQnVmZmVyIiwiYXJyYXlCdWZmZXIiLCJsb2ciLCJzaXplIiwidHlwZSIsInVwbG9hZERhdGEiLCJ1cGxvYWRFcnJvciIsInN0b3JhZ2UiLCJ1cGxvYWQiLCJ1cHNlcnQiLCJzdHJpbmdpZnkiLCJkZXRhaWxzIiwibWVzc2FnZSIsInBhdGgiLCJleGlzdHNEYXRhIiwiZXhpc3RzRXJyb3IiLCJsaXN0IiwibGltaXQiLCJzZWFyY2giLCJsZW5ndGgiLCJwdWJsaWNVcmwiLCJnZXRQdWJsaWNVcmwiLCJmaWxlUmVjb3JkIiwiZGJFcnJvciIsImZpbGVfc2l6ZSIsImZpbGVfdHlwZSIsInN0b3JhZ2VfcGF0aCIsImlzX3B1YmxpYyIsInJlcXVpcmVzX2F1dGgiLCJ1cGxvYWRlZF9ieV9pZCIsIm1ldGFkYXRhIiwidXJsIiwiZG93bmxvYWRfY291bnQiLCJpc19sYXRlc3QiLCJyZW1vdmUiLCJldmVudF90eXBlIiwidXNlcl9pZCIsImZpbGVfaWQiLCJpZCIsImludGVyYWN0aW9uX3R5cGUiLCJ1c2VyX2lkZW50aWZpZXIiLCJjcmVhdGVkX2F0IiwidG9JU09TdHJpbmciLCJyZWFkIiwiYm9keSIsInByb2plY3RsZXRfaWQiLCJhcHBsZXRfaWQiLCJHRVQiLCJzZWFyY2hQYXJhbXMiLCJVUkwiLCJxdWVyeSIsImVxIiwib3JkZXIiLCJhc2NlbmRpbmciLCJpcyIsImZpbGVzIiwiREVMRVRFIiwiZmlsZUlkIiwiZmlsZURhdGEiLCJwYXRoVG9EZWxldGUiLCJzdG9yYWdlRXJyb3IiLCJlcnIiLCJkZWxldGUiLCJzdWNjZXNzIiwiUEFUQ0giLCJhY3Rpb24iLCJ1cGRhdGVzIiwidXBkYXRlRGF0YSIsImxhc3RfYWNjZXNzZWQiLCJpbmNyZW1lbnRfZG93bmxvYWQiLCJjdXJyZW50RmlsZSIsImxhc3RfZG93bmxvYWRlZF9hdCIsInVwZGF0ZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./app/api/project-files/route.js\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/@supabase","vendor-chunks/next"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fproject-files%2Froute&page=%2Fapi%2Fproject-files%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fproject-files%2Froute.js&appDir=%2FUsers%2Frosspalmer%2FRoss%20GitHub%20Projects%2Faloa-web-design-project-manager%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Frosspalmer%2FRoss%20GitHub%20Projects%2Faloa-web-design-project-manager&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();