"use strict";(()=>{var t={};t.id=477,t.ids=[477],t.modules={517:t=>{t.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3685:t=>{t.exports=require("http")},5687:t=>{t.exports=require("https")},5477:t=>{t.exports=require("punycode")},2781:t=>{t.exports=require("stream")},7310:t=>{t.exports=require("url")},9796:t=>{t.exports=require("zlib")},1915:(t,e,r)=>{r.r(e),r.d(e,{headerHooks:()=>h,originalPathname:()=>b,patchFetch:()=>v,requestAsyncStorage:()=>c,routeModule:()=>p,serverHooks:()=>f,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>g});var i={};r.r(i),r.d(i,{POST:()=>d});var o=r(5419),s=r(9108),n=r(9678),a=r(8070),l=r(4102),u=r(3721);async function d(t){try{let e=(await t.formData()).get("markdown");if(!e)return a.Z.json({error:"No file uploaded"},{status:400});let r=await e.text();try{let t=function(t){if(!t||"string"!=typeof t)throw Error("Invalid input: markdown must be a non-empty string");let e=t.split("\n"),r={title:"",description:"",fields:[]},i=null,o=!1,s=null,n=0;for(;n<e.length;){let t=e[n].trim();if(t.startsWith("# ")){r.title=t.substring(2).trim(),o=!0,n++;continue}if(o&&""===t){o=!1,n++;continue}if(o&&!t.startsWith("## ")){r.description+=(r.description?" ":"")+t,n++;continue}if(t.startsWith("## Section:")){i&&(r.fields.push(i),i=null),s=t.substring(11).trim(),n++;continue}if(t.startsWith("- ")){i&&r.fields.push(i);let o=t.substring(2).trim().split("|").map(t=>t.trim());if(o.length>=3){let t=o[0],r=t.includes("*"),a=t.replace("*","").trim().toLowerCase(),l=o[1],u=o[2],d=o[3]||void 0,p="multiline"===a?"textarea":a;if(i={label:u,name:l,type:p,required:r,placeholder:d,section:s||"General Information"},["select","radio","checkbox"].includes(p)){i.options=[];let t=n+1;for(;t<e.length;){let r=e[t];if(r.startsWith("  - "))i.options.push(r.substring(4).trim()),t++;else if(""===r.trim())t++;else break}n=t-1}}n++;continue}if(t.startsWith("## ")&&!t.startsWith("## Section:")){i&&r.fields.push(i);let e=t.substring(3).trim(),o=e.match(/^(.*?)\s*\*\s*$/),a=o?o[1].trim():e,l=!!o;i={label:a,name:a.toLowerCase().replace(/[^a-z0-9]+/g,"_"),required:l,type:"text",section:s||"General Information"},n++;continue}if(i&&t.startsWith("Type: ")){let r=t.substring(6).trim().toLowerCase(),o="multiline"===r?"textarea":r;if(i.type=o,["select","radio","checkbox"].includes(o)){i.options=[];let t=n+1;for(;t<e.length;){let r=e[t];if(r.startsWith("  - "))i.options.push(r.substring(4).trim()),t++;else if(""===r.trim())t++;else break}n=t-1}n++;continue}if(i&&t.startsWith("Placeholder: ")){i.placeholder=t.substring(13).trim(),n++;continue}if(i&&t.startsWith("Min: ")){i.validation||(i.validation={});let e=t.substring(5).trim();"number"===i.type?i.validation.min=parseInt(e):i.validation.minLength=parseInt(e),n++;continue}if(i&&t.startsWith("Max: ")){i.validation||(i.validation={});let e=t.substring(5).trim();"number"===i.type?i.validation.max=parseInt(e):i.validation.maxLength=parseInt(e),n++;continue}if(i&&t.startsWith("Pattern: ")){i.validation||(i.validation={}),i.validation.pattern=t.substring(9).trim(),n++;continue}n++}if(i&&r.fields.push(i),!r.title||0===r.fields.length)throw Error("Invalid form structure");return r}(r),e={title:t.title,description:t.description,url_id:(0,u.x0)(10),markdown_content:r},{data:i,error:o}=await l.O.from("forms").insert([e]).select().single();if(o)throw o;if(t.fields&&t.fields.length>0){let e=t.fields.map((t,e)=>({form_id:i.id,field_label:t.label,field_name:t.name,field_type:t.type,required:t.required||!1,placeholder:t.placeholder||null,options:t.options||null,validation:{...t.validation,section:t.section||"General Information"},field_order:e})),{error:r}=await l.O.from("form_fields").insert(e);if(r)throw await l.O.from("forms").delete().eq("id",i.id),r}return a.Z.json({_id:i.id,urlId:i.url_id,title:i.title})}catch(t){return console.error("Parsing error:",t),a.Z.json({error:t.message||"Invalid markdown format"},{status:400})}}catch(t){return console.error("Error processing upload:",t),a.Z.json({error:"Failed to process upload"},{status:500})}}let p=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/forms/upload/route",pathname:"/api/forms/upload",filename:"route",bundlePath:"app/api/forms/upload/route"},resolvedPagePath:"/Users/rosspalmer/Ross GitHub Projects/custom-forms/app/api/forms/upload/route.js",nextConfigOutput:"",userland:i}),{requestAsyncStorage:c,staticGenerationAsyncStorage:m,serverHooks:f,headerHooks:h,staticGenerationBailout:g}=p,b="/api/forms/upload/route";function v(){return(0,n.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:m})}},4102:(t,e,r)=>{r.d(e,{O:()=>n});var i=r(2409);let o="https://eycgzjqwowrdmjlzqqyg.supabase.co",s="sb_publishable_eG0lH_ACpyOjqG44mN_5PA_1-oFLr5n",n=null;o&&s?n=(0,i.eI)(o,s):console.error("Warning: Supabase environment variables are missing")},3721:(t,e,r)=>{let i,o;r.d(e,{x0:()=>n});let s=require("node:crypto");function n(t=21){var e;e=t|=0,!i||i.length<e?(i=Buffer.allocUnsafe(128*e),s.webcrypto.getRandomValues(i),o=0):o+e>i.length&&(s.webcrypto.getRandomValues(i),o=0),o+=e;let r="";for(let e=o-t;e<o;e++)r+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&i[e]];return r}}};var e=require("../../../../webpack-runtime.js");e.C(t);var r=t=>e(e.s=t),i=e.X(0,[638,409,206],()=>r(1915));module.exports=i})();