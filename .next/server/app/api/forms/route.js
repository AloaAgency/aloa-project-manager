"use strict";(()=>{var e={};e.id=4284,e.ids=[4284],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},71568:e=>{e.exports=require("zlib")},22628:(e,r,o)=>{o.r(r),o.d(r,{originalPathname:()=>h,patchFetch:()=>g,requestAsyncStorage:()=>f,routeModule:()=>c,serverHooks:()=>_,staticGenerationAsyncStorage:()=>m});var t={};o.r(t),o.d(t,{GET:()=>p,POST:()=>u});var a=o(49303),i=o(88716),l=o(60670),n=o(87070),s=o(76995),d=o(40259);async function p(e){try{let{searchParams:r}=new URL(e.url),o=r.get("project"),t=s.O.from("aloa_forms").select(`
        *,
        aloa_form_fields (
          id,
          field_label,
          field_name,
          field_type,
          required,
          placeholder,
          options,
          validation,
          field_order
        ),
        aloa_form_responses(count),
        aloa_projects (
          id,
          name
        )
      `);o&&(t=t.eq("project_id",o));let{data:a,error:i}=await t.order("created_at",{ascending:!1});if(i)throw i;let l=a.map(e=>({...e,_id:e.id,urlId:e.url_id,createdAt:e.created_at,projectId:e.project_id,projectName:e.aloa_projects?.name,fields:e.aloa_form_fields?.sort((e,r)=>(e.field_order||0)-(r.field_order||0)).map(e=>({_id:e.id,label:e.field_label,name:e.field_name,type:e.field_type,position:e.field_order,section:e.validation?.section||"General Information",required:e.required,placeholder:e.placeholder,options:e.options,validation:e.validation}))||[],responseCount:e.aloa_form_responses?.[0]?.count||0}));return n.NextResponse.json(l)}catch(e){return console.error("Error fetching forms:",e),n.NextResponse.json({error:"Failed to fetch forms"},{status:500})}}async function u(e){try{let r=await e.json(),o={title:r.title,description:r.description,url_id:r.urlId||(0,d.x0)(10),markdown_content:r.markdownContent||"",project_id:r.projectId||null},{data:t,error:a}=await s.O.from("aloa_forms").insert([o]).select().single();if(a)throw a;if(r.fields&&r.fields.length>0){let e=r.fields.map((e,r)=>({form_id:t.id,field_label:e.label,field_name:e.name,field_type:e.type,required:e.required||!1,placeholder:e.placeholder||null,options:e.options||null,validation:e.validation||null,field_order:r})),{error:o}=await s.O.from("aloa_form_fields").insert(e);if(o)throw await s.O.from("aloa_forms").delete().eq("id",t.id),o}return n.NextResponse.json({...t,_id:t.id,urlId:t.url_id})}catch(e){return console.error("Error creating form:",e),n.NextResponse.json({error:"Failed to create form"},{status:500})}}let c=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/forms/route",pathname:"/api/forms",filename:"route",bundlePath:"app/api/forms/route"},resolvedPagePath:"/Users/rosspalmer/Ross GitHub Projects/aloa-web-design-project-manager/app/api/forms/route.js",nextConfigOutput:"",userland:t}),{requestAsyncStorage:f,staticGenerationAsyncStorage:m,serverHooks:_}=c,h="/api/forms/route";function g(){return(0,l.patchFetch)({serverHooks:_,staticGenerationAsyncStorage:m})}},76995:(e,r,o)=>{o.d(r,{O:()=>l});var t=o(69498);let a="https://eycgzjqwowrdmjlzqqyg.supabase.co",i="sb_publishable_eG0lH_ACpyOjqG44mN_5PA_1-oFLr5n",l=null;a&&i?l=(0,t.eI)(a,i):console.error("Warning: Supabase environment variables are missing")},40259:(e,r,o)=>{let t,a;o.d(r,{x0:()=>l});let i=require("node:crypto");function l(e=21){var r;r=e|=0,!t||t.length<r?(t=Buffer.allocUnsafe(128*r),i.webcrypto.getRandomValues(t),a=0):a+r>t.length&&(i.webcrypto.getRandomValues(t),a=0),a+=r;let o="";for(let r=a-e;r<a;r++)o+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&t[r]];return o}}};var r=require("../../../webpack-runtime.js");r.C(e);var o=e=>r(r.s=e),t=r.X(0,[9276,5972,9498],()=>o(22628));module.exports=t})();