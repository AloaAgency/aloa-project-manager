"use strict";(()=>{var e={};e.id=284,e.ids=[284],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},5477:e=>{e.exports=require("punycode")},2781:e=>{e.exports=require("stream")},7310:e=>{e.exports=require("url")},9796:e=>{e.exports=require("zlib")},8795:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>h,originalPathname:()=>g,patchFetch:()=>v,requestAsyncStorage:()=>c,routeModule:()=>f,serverHooks:()=>_,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>q});var o={};t.r(o),t.d(o,{GET:()=>u,POST:()=>p});var i=t(5419),a=t(9108),l=t(9678),n=t(8070),s=t(4102),d=t(3721);async function u(){try{let{data:e,error:r}=await s.O.from("forms").select(`
        *,
        form_fields (
          id,
          field_label,
          field_name,
          field_type,
          required,
          placeholder,
          options,
          validation,
          field_order
        ),
        form_responses(count)
      `).order("created_at",{ascending:!1});if(r)throw r;let t=e.map(e=>({...e,_id:e.id,urlId:e.url_id,createdAt:e.created_at,fields:e.form_fields?.sort((e,r)=>(e.field_order||0)-(r.field_order||0)).map(e=>({_id:e.id,label:e.field_label,name:e.field_name,type:e.field_type,position:e.field_order,section:e.validation?.section||"General Information",required:e.required,placeholder:e.placeholder,options:e.options,validation:e.validation}))||[],responseCount:e.form_responses?.[0]?.count||0}));return n.Z.json(t)}catch(e){return console.error("Error fetching forms:",e),n.Z.json({error:"Failed to fetch forms"},{status:500})}}async function p(e){try{let r=await e.json(),t={title:r.title,description:r.description,url_id:r.urlId||(0,d.x0)(10),markdown_content:r.markdownContent||""},{data:o,error:i}=await s.O.from("forms").insert([t]).select().single();if(i)throw i;if(r.fields&&r.fields.length>0){let e=r.fields.map((e,r)=>({form_id:o.id,field_label:e.label,field_name:e.name,field_type:e.type,required:e.required||!1,placeholder:e.placeholder||null,options:e.options||null,validation:e.validation||null,field_order:r})),{error:t}=await s.O.from("form_fields").insert(e);if(t)throw await s.O.from("forms").delete().eq("id",o.id),t}return n.Z.json({...o,_id:o.id,urlId:o.url_id})}catch(e){return console.error("Error creating form:",e),n.Z.json({error:"Failed to create form"},{status:500})}}let f=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/forms/route",pathname:"/api/forms",filename:"route",bundlePath:"app/api/forms/route"},resolvedPagePath:"/Users/rosspalmer/Ross GitHub Projects/custom-forms/app/api/forms/route.js",nextConfigOutput:"",userland:o}),{requestAsyncStorage:c,staticGenerationAsyncStorage:m,serverHooks:_,headerHooks:h,staticGenerationBailout:q}=f,g="/api/forms/route";function v(){return(0,l.patchFetch)({serverHooks:_,staticGenerationAsyncStorage:m})}},4102:(e,r,t)=>{t.d(r,{O:()=>l});var o=t(2409);let i="https://eycgzjqwowrdmjlzqqyg.supabase.co",a="sb_publishable_eG0lH_ACpyOjqG44mN_5PA_1-oFLr5n",l=null;i&&a?l=(0,o.eI)(i,a):console.error("Warning: Supabase environment variables are missing")},3721:(e,r,t)=>{let o,i;t.d(r,{x0:()=>l});let a=require("node:crypto");function l(e=21){var r;r=e|=0,!o||o.length<r?(o=Buffer.allocUnsafe(128*r),a.webcrypto.getRandomValues(o),i=0):i+r>o.length&&(a.webcrypto.getRandomValues(o),i=0),i+=r;let t="";for(let r=i-e;r<i;r++)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&o[r]];return t}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[638,409,206],()=>t(8795));module.exports=o})();