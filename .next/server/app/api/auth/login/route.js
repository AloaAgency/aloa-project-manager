"use strict";(()=>{var e={};e.id=8873,e.ids=[8873],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},71568:e=>{e.exports=require("zlib")},54411:(e,r,s)=>{s.r(r),s.d(r,{originalPathname:()=>x,patchFetch:()=>j,requestAsyncStorage:()=>d,routeModule:()=>c,serverHooks:()=>m,staticGenerationAsyncStorage:()=>g});var o={};s.r(o),s.d(o,{POST:()=>p});var t=s(49303),n=s(88716),a=s(60670),i=s(87070),l=s(71615),u=s(67721);async function p(e){try{let{email:r,password:s}=await e.json();if(!r||!s)return i.NextResponse.json({error:"Email and password are required"},{status:400});console.log("Server-side login attempt for:",r);let o=(0,l.cookies)(),t=(0,u.createServerClient)("https://eycgzjqwowrdmjlzqqyg.supabase.co","sb_publishable_eG0lH_ACpyOjqG44mN_5PA_1-oFLr5n",{cookies:{get:e=>o.get(e)?.value,set(e,r,s){o.set({name:e,value:r,...s})},remove(e,r){o.set({name:e,value:"",...r})}}}),{data:n,error:a}=await t.auth.signInWithPassword({email:r,password:s});if(console.log("Server-side login result:",{hasUser:!!n?.user,hasSession:!!n?.session,error:a?.message}),a)return console.error("Login error:",a),i.NextResponse.json({error:a.message},{status:401});if(!n?.user||!n?.session)return console.error("No user or session returned from login"),i.NextResponse.json({error:"Login failed - please try again"},{status:401});let{data:p,error:c}=await t.from("aloa_user_profiles").select("*").eq("id",n.user.id).single();c&&console.error("Error fetching user profile:",c);let d=p?.role||"client";console.log("User role:",d);let g=null;if("client"===d){let{data:e}=await t.from("aloa_project_members").select(`
          project_id,
          aloa_projects (
            id,
            project_name,
            status
          )
        `).eq("user_id",n.user.id).single();e?.aloa_projects&&(g=e.aloa_projects,console.log("Client project found:",g))}return console.log("Login successful for:",r,"with role:",d),i.NextResponse.json({success:!0,user:{id:n.user.id,email:n.user.email,role:d,profile:p},clientProject:g})}catch(e){return console.error("Server error during login:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}let c=new t.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"/Users/rosspalmer/Ross GitHub Projects/aloa-web-design-project-manager/app/api/auth/login/route.js",nextConfigOutput:"",userland:o}),{requestAsyncStorage:d,staticGenerationAsyncStorage:g,serverHooks:m}=c,x="/api/auth/login/route";function j(){return(0,a.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:g})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),o=r.X(0,[9276,5972,9498,9702],()=>s(54411));module.exports=o})();