"use strict";(()=>{var e={};e.id=3935,e.ids=[3935],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},71568:e=>{e.exports=require("zlib")},96119:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>_,patchFetch:()=>f,requestAsyncStorage:()=>d,routeModule:()=>u,serverHooks:()=>j,staticGenerationAsyncStorage:()=>m});var a={};r.r(a),r.d(a,{GET:()=>c,POST:()=>l});var o=r(49303),i=r(88716),n=r(60670),s=r(87070),p=r(76995);async function c(e,{params:t}){try{let{projectId:e}=t,{data:r,error:a}=await p.O.from("aloa_applet_interactions").select(`
        *,
        applet:aloa_applets(
          id,
          name,
          type,
          requires_approval,
          projectlet:aloa_projectlets(
            id,
            name
          )
        )
      `).eq("project_id",e).in("interaction_type",["submission","approval_request","start"]).order("created_at",{ascending:!1}).limit(50);if(a)return console.error("Error fetching interactions:",a),s.NextResponse.json({error:"Failed to fetch notifications"},{status:500});let o=r?.map(e=>{let t,r,a;switch(e.interaction_type){case"submission":t="Task Completed",r=`Client completed "${e.applet?.name}" in ${e.applet?.projectlet?.name}`,a="applet_completed";break;case"approval_request":t="Approval Needed",r=`"${e.applet?.name}" requires your approval`,a="needs_approval";break;case"start":t="Task Started",r=`Client started working on "${e.applet?.name}"`,a="applet_started";break;default:t="Project Update",r=`Activity on "${e.applet?.name}"`,a="general"}return{id:e.id,title:t,message:r,type:a,created_at:e.created_at,read:e.read||!1,applet_id:e.applet_id,data:e.data}})||[];return s.NextResponse.json({notifications:o})}catch(e){return console.error("Error in notifications route:",e),s.NextResponse.json({error:"Internal server error"},{status:500})}}async function l(e,{params:t}){try{let{projectId:r}=t,{appletId:a,type:o,title:i,message:n,data:c}=await e.json(),{data:l,error:u}=await p.O.from("aloa_applet_interactions").insert([{applet_id:a,project_id:r,interaction_type:o,user_role:"system",data:{notification_title:i,notification_message:n,...c}}]).select().single();if(u)return console.error("Error creating notification:",u),s.NextResponse.json({error:"Failed to create notification"},{status:500});return s.NextResponse.json({success:!0,notification:l})}catch(e){return console.error("Error in notification creation:",e),s.NextResponse.json({error:"Internal server error"},{status:500})}}let u=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/aloa-projects/[projectId]/notifications/route",pathname:"/api/aloa-projects/[projectId]/notifications",filename:"route",bundlePath:"app/api/aloa-projects/[projectId]/notifications/route"},resolvedPagePath:"/Users/rosspalmer/Ross GitHub Projects/aloa-web-design-project-manager/app/api/aloa-projects/[projectId]/notifications/route.js",nextConfigOutput:"",userland:a}),{requestAsyncStorage:d,staticGenerationAsyncStorage:m,serverHooks:j}=u,_="/api/aloa-projects/[projectId]/notifications/route";function f(){return(0,n.patchFetch)({serverHooks:j,staticGenerationAsyncStorage:m})}},76995:(e,t,r)=>{r.d(t,{O:()=>n});var a=r(69498);let o="https://eycgzjqwowrdmjlzqqyg.supabase.co",i="sb_publishable_eG0lH_ACpyOjqG44mN_5PA_1-oFLr5n",n=null;o&&i?n=(0,a.eI)(o,i):console.error("Warning: Supabase environment variables are missing")}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[9276,5972,9498],()=>r(96119));module.exports=a})();