"use strict";(()=>{var e={};e.id=8406,e.ids=[8406],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},71568:e=>{e.exports=require("zlib")},8917:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>k,patchFetch:()=>v,requestAsyncStorage:()=>m,routeModule:()=>_,serverHooks:()=>j,staticGenerationAsyncStorage:()=>h});var o={};t.r(o),t.d(o,{DELETE:()=>u,GET:()=>p,PATCH:()=>c,POST:()=>d});var a=t(49303),s=t(88716),i=t(60670),n=t(87070),l=t(76995);async function p(e,{params:r}){try{let{projectId:e}=r,{data:t,error:o}=await l.O.from("aloa_client_stakeholders").select("*").eq("project_id",e).order("importance",{ascending:!1}).order("is_primary",{ascending:!1}).order("name",{ascending:!0});if(o)return console.error("Error fetching stakeholders:",o),n.NextResponse.json({error:"Failed to fetch stakeholders"},{status:500});return n.NextResponse.json({stakeholders:t||[],count:t?.length||0})}catch(e){return console.error("Error in stakeholders GET:",e),n.NextResponse.json({error:"Internal server error"},{status:500})}}async function d(e,{params:r}){try{let{projectId:t}=r,o=await e.json(),a={project_id:t,name:o.name,title:o.title||null,role:o.role||null,email:o.email||null,phone:o.phone||null,bio:o.bio||null,responsibilities:o.responsibilities||null,preferences:o.preferences||null,avatar_url:o.avatar_url||null,linkedin_url:o.linkedin_url||null,importance:o.importance||5,is_primary:o.is_primary||!1,metadata:o.metadata||{},created_by:o.created_by||"admin"};a.is_primary&&await l.O.from("aloa_client_stakeholders").update({is_primary:!1}).eq("project_id",t).eq("is_primary",!0);let{data:s,error:i}=await l.O.from("aloa_client_stakeholders").insert([a]).select().single();if(i)return console.error("Error creating stakeholder:",i),n.NextResponse.json({error:"Failed to create stakeholder"},{status:500});return await l.O.rpc("update_project_ai_context",{p_project_id:t}),n.NextResponse.json({success:!0,stakeholder:s})}catch(e){return console.error("Error in stakeholder POST:",e),n.NextResponse.json({error:"Internal server error"},{status:500})}}async function c(e,{params:r}){try{let{projectId:t}=r,{searchParams:o}=new URL(e.url),a=o.get("stakeholderId");if(!a)return n.NextResponse.json({error:"Stakeholder ID required"},{status:400});let s=await e.json(),i={};void 0!==s.name&&(i.name=s.name),void 0!==s.title&&(i.title=s.title),void 0!==s.role&&(i.role=s.role),void 0!==s.email&&(i.email=s.email),void 0!==s.phone&&(i.phone=s.phone),void 0!==s.bio&&(i.bio=s.bio),void 0!==s.responsibilities&&(i.responsibilities=s.responsibilities),void 0!==s.preferences&&(i.preferences=s.preferences),void 0!==s.avatar_url&&(i.avatar_url=s.avatar_url),void 0!==s.linkedin_url&&(i.linkedin_url=s.linkedin_url),void 0!==s.importance&&(i.importance=s.importance),void 0!==s.is_primary&&(i.is_primary=s.is_primary),void 0!==s.metadata&&(i.metadata=s.metadata),!0===i.is_primary&&await l.O.from("aloa_client_stakeholders").update({is_primary:!1}).eq("project_id",t).eq("is_primary",!0).neq("id",a);let{data:p,error:d}=await l.O.from("aloa_client_stakeholders").update(i).eq("id",a).eq("project_id",t).select().single();if(d)return console.error("Error updating stakeholder:",d),n.NextResponse.json({error:"Failed to update stakeholder"},{status:500});return await l.O.rpc("update_project_ai_context",{p_project_id:t}),n.NextResponse.json({success:!0,stakeholder:p})}catch(e){return console.error("Error in stakeholder PATCH:",e),n.NextResponse.json({error:"Internal server error"},{status:500})}}async function u(e,{params:r}){try{let{projectId:t}=r,{searchParams:o}=new URL(e.url),a=o.get("stakeholderId");if(!a)return n.NextResponse.json({error:"Stakeholder ID required"},{status:400});let{error:s}=await l.O.from("aloa_client_stakeholders").delete().eq("id",a).eq("project_id",t);if(s)return console.error("Error deleting stakeholder:",s),n.NextResponse.json({error:"Failed to delete stakeholder"},{status:500});return await l.O.rpc("update_project_ai_context",{p_project_id:t}),n.NextResponse.json({success:!0,message:"Stakeholder deleted successfully"})}catch(e){return console.error("Error in stakeholder DELETE:",e),n.NextResponse.json({error:"Internal server error"},{status:500})}}let _=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/aloa-projects/[projectId]/stakeholders/route",pathname:"/api/aloa-projects/[projectId]/stakeholders",filename:"route",bundlePath:"app/api/aloa-projects/[projectId]/stakeholders/route"},resolvedPagePath:"/Users/rosspalmer/Ross GitHub Projects/aloa-web-design-project-manager/app/api/aloa-projects/[projectId]/stakeholders/route.js",nextConfigOutput:"",userland:o}),{requestAsyncStorage:m,staticGenerationAsyncStorage:h,serverHooks:j}=_,k="/api/aloa-projects/[projectId]/stakeholders/route";function v(){return(0,i.patchFetch)({serverHooks:j,staticGenerationAsyncStorage:h})}},76995:(e,r,t)=>{t.d(r,{O:()=>i});var o=t(69498);let a="https://eycgzjqwowrdmjlzqqyg.supabase.co",s="sb_publishable_eG0lH_ACpyOjqG44mN_5PA_1-oFLr5n",i=null;a&&s?i=(0,o.eI)(a,s):console.error("Warning: Supabase environment variables are missing")}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[9276,5972,9498],()=>t(8917));module.exports=o})();